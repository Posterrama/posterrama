<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Posterrama â€“ Live Preview</title>
    <meta name="robots" content="noindex,nofollow" />
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Load main app styles so screensaver/wallart preview render correctly -->
    <link rel="stylesheet" href="/style.css?v={{ASSET_VERSION}}" />
    <!-- Cinema preview assets are loaded dynamically only when needed -->
    <link id="preview-cinema-css" rel="stylesheet" href="/preview-cinema.css?v={{ASSET_VERSION}}" disabled />
    <style>
      html, body { height: 100%; margin: 0; padding: 0; }
      body { background:#000; color:#fff; overflow:hidden; }
      /* Hide on-screen controls/branding in preview to keep it clean */
      #controls-container, #branding-container, #promo-box { display: none !important; }
      /* Hide cinema overlay elements by default; cinema preview will enable/show them */
      #cinema-ambilight, #cinema-header, #cinema-footer-specs, #cinema-footer-marquee { display: none; }
    </style>
  </head>
  <body>
    <!-- Minimal DOM identical to main display so script.js can run normally -->
    <div id="layer-a" class="screensaver-layer"></div>
    <div id="layer-b" class="screensaver-layer"></div>

    <!-- Preview-only Cinema overlays (safe: not present in main runtime) -->
    <div id="cinema-ambilight" aria-hidden="true"></div>
    <div id="cinema-header" aria-live="polite"></div>
    <div id="cinema-footer-specs"></div>
    <div id="cinema-footer-marquee"><span></span></div>

    <div id="clock-widget-container">
      <div id="time-widget">
        <span id="time-hours">00</span>
        <span id="time-separator">:</span>
        <span id="time-minutes">00</span>
      </div>
    </div>

    <div id="clearlogo-container">
      <img id="clearlogo" src="" alt="ClearLogo" />
    </div>

    <div id="info-container">
      <div id="poster-wrapper">
        <a id="poster-link" href="#" target="_blank" rel="noopener noreferrer">
          <div id="poster-a" class="poster-layer"></div>
          <div id="poster-b" class="poster-layer"></div>
          <div id="poster"></div>
        </a>
      </div>
      <div id="text-wrapper">
        <h1 id="title"></h1>
        <p id="tagline"></p>
        <div id="meta-info">
          <span id="year"></span>
          <span id="rating"></span>
        </div>
      </div>
    </div>

    <div id="controls-container"></div>
    <div id="branding-container"></div>

    
  <script>
    (function () {
      function loadCinemaAssets() {
        // Enable preview-cinema.css
        var previewCss = document.getElementById('preview-cinema-css');
        if (previewCss) previewCss.disabled = false;
        // Load standalone cinema CSS (no conflicts with style.css)
        if (!document.getElementById('cinema-display-css')) {
          var c = document.createElement('link');
          c.id = 'cinema-display-css';
          c.rel = 'stylesheet';
          c.href = '/cinema/cinema-display.css?v={{ASSET_VERSION}}';
          document.head.appendChild(c);
        }
        if (!document.getElementById('preview-cinema-js')) {
          var s = document.createElement('script');
          s.id = 'preview-cinema-js';
          s.src = '/preview-cinema.js?v={{ASSET_VERSION}}';
          document.head.appendChild(s);
        }
      }
      function unloadCinemaAssets() {
        var css = document.getElementById('preview-cinema-css');
        if (css) css.disabled = true;
        var ccss = document.getElementById('cinema-display-css');
        if (ccss && ccss.parentNode) ccss.parentNode.removeChild(ccss);
        var js = document.getElementById('preview-cinema-js');
        if (js && js.parentNode) js.parentNode.removeChild(js);
        // Also remove cinema-mode class from body if present
        try { document.body.classList.remove('cinema-mode'); } catch (e) {}
        // And ensure overlay nodes stay hidden by default
        try {
          ['cinema-ambilight','cinema-header','cinema-footer-specs','cinema-footer-marquee'].forEach(function(id){
            var el = document.getElementById(id); if (el) el.style.display = 'none';
          });
        } catch(e) {}
      }
      try {
        var params = new URLSearchParams(location.search);
        var mode = params.get('mode');
        if (mode === 'cinema') loadCinemaAssets();
        else unloadCinemaAssets();
      } catch (e) { /* ignore */ }

      // Dynamically react to admin preview updates
      window.addEventListener('message', function (ev) {
        try {
          if (ev.origin !== window.location.origin) return;
          var d = ev.data || {};
          if (d.type === 'posterrama.preview.update' && d.payload) {
            if (d.payload.cinemaMode === true) loadCinemaAssets();
            else unloadCinemaAssets();
          }
        } catch (e) {
          // ignore malformed messages
        }
      });
    })();
  </script>
  </body>
</html>
