<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <title>Posterrama Admin — Dashboard</title>
  <!-- PWA: basic meta + manifest so admin2 independently registers the Service Worker -->
  <meta name="theme-color" content="#1a1d29" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="mobile-web-app-capable" content="yes" />
  <link rel="manifest" href="/manifest.json" />
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/icon-16x16.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/icon-32x32.png" />
  <link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="/theme-demo.css" />
  <style>
  /* Themed dropdowns */
  select { 
    background: var(--color-bg-card);
    color: var(--color-text-primary);
    border: 1px solid var(--color-border);
    border-radius: 10px; 
    padding: 8px 36px 8px 10px; 
    outline: none; 
    font: inherit; 
    width: 100%;
    appearance: none; 
    -webkit-appearance: none; 
    -moz-appearance: none;
  }
  select:hover { border-color: var(--color-border-light); }
  select:focus { border-color: var(--color-info); box-shadow: 0 0 0 3px rgba(102,126,234,0.25); }
  /* Add chevron to non-multiple selects */
  select:not([multiple]) {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='%23A3AED0' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 10px center;
    background-size: 14px;
  }
  /* Wrapper to support leading icon for special selects */
  .select-wrap { position: relative; }
  .select-wrap .select-icon { position: absolute; left: 10px; top: 50%; transform: translateY(-50%); pointer-events: none; opacity: .9; }
  .select-wrap .select-icon i { color: var(--color-text-muted); }
  .select-wrap select { padding-left: 34px; }
  /* Custom select (for icon-in-list support) */
  .select-wrap.has-custom-select { position: relative; }
  .select-wrap.has-custom-select .select-icon { display: none; }
  .select-wrap select.enhanced { position: absolute; opacity: 0; pointer-events: none; width: 0; height: 0; }
  .custom-select { position: relative; width: 100%; }
  .custom-select-trigger { width: 100%; display: flex; align-items: center; justify-content: space-between; gap: 8px; padding: 8px 36px 8px 10px; border-radius: 10px; background: var(--color-bg-card); color: var(--color-text-primary); border: 1px solid var(--color-border); cursor: pointer; font: inherit; }
  .custom-select-trigger:hover { border-color: var(--color-border-light); }
  .custom-select-trigger:focus { outline: none; border-color: var(--color-info); box-shadow: 0 0 0 3px rgba(102,126,234,0.25); }
  .custom-select-trigger .left { display: inline-flex; align-items: center; gap: 8px; }
  .custom-select-trigger .caret { color: var(--color-text-muted); }
  .custom-options { position: fixed; z-index: 3002; margin-top: 0; background: var(--color-bg-card); border: 1px solid var(--color-border); border-radius: 10px; box-shadow: var(--shadow-lg); max-height: 260px; overflow: auto; padding: 6px; display: none; }
  /* visibility toggled via inline styles/js when appended to body */
  .custom-option { display: flex; align-items: center; gap: 10px; padding: 8px 10px; border-radius: 8px; cursor: pointer; }
  .custom-option:hover { background: var(--color-bg-tertiary); }
  .custom-option[aria-selected="true"] { background: var(--color-bg-tertiary); box-shadow: inset 3px 0 0 var(--color-info); }
  .custom-option i { color: var(--color-text-muted); }
  /* Custom select optgroup header */
  .custom-optgroup { position: sticky; top: 0; background: var(--color-bg-card); color: var(--color-text-muted); font-size: 0.78rem; letter-spacing: .02em; text-transform: none; padding: 6px 10px; margin: 4px 0 2px; opacity: .9; }
  @media (prefers-reduced-motion: no-preference) {
    .custom-options { transition: opacity .12s ease, transform .12s ease; }
    .custom-select.open .custom-options { opacity: 1; transform: translateY(0); }
  }
    /* Status tiles styling */
    .status-tiles { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 10px; }
    .status-tile { display: flex; align-items: center; justify-content: space-between; padding: 10px 12px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.03); }
    .status-tile .tile-left { display: flex; align-items: center; gap: 10px; }
    .status-tile .tile-title { font-weight: 600; opacity: 0.95; display: flex; align-items: center; gap: 8px; }
    .status-tile .tile-badge { font-size: 0.75rem; padding: 4px 10px; border-radius: 999px; background: rgba(255,255,255,0.08); text-transform: capitalize; }
    .tile-badge.status-success { background: rgba(34,197,94,0.15); color: #86efac; }
    .tile-badge.status-warning { background: rgba(245,158,11,0.15); color: #fcd34d; }
    .tile-badge.status-error { background: rgba(239,68,68,0.15); color: #fca5a5; }
  /* Theme alignment for dropdown links */
  .dropdown-menu a.dropdown-item { text-decoration: none; color: var(--color-text-primary); }
  .dropdown-menu a.dropdown-item:hover,
    .dropdown-menu a.dropdown-item:focus { text-decoration: none; }
  .dropdown-menu .dropdown-divider { height:1px; background: rgba(255,255,255,0.08); margin:6px 0; }
    /* Toasts – theme alignment, bottom-right placement */
  .toast-container { position: fixed; right: 16px; bottom: 16px; display: flex; flex-direction: column; gap: 8px; z-index: 3001; }
    .toast { display: flex; align-items: flex-start; gap: 10px; min-width: 260px; max-width: 360px; padding: 10px 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.08); background: rgba(20,20,28,0.95); color: var(--color-text-primary, #E5E7EB); box-shadow: 0 10px 30px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.05); opacity: 0; transform: translateY(8px); transition: opacity .18s ease, transform .18s ease; }
    .toast.show { opacity: 1; transform: translateY(0); }
    .toast .toast-icon { font-size: 1rem; line-height: 1.2; }
    .toast .toast-content { flex: 1; }
    .toast .toast-title { display:block; margin-bottom: 2px; font-weight: 600; opacity: .95; }
    .toast .toast-message { font-size: .9rem; opacity: .9; }
    .toast .toast-close { background: transparent; border: none; color: inherit; font-size: 1.1rem; cursor: pointer; opacity: .7; }
    .toast .toast-close:hover { opacity: 1; }
    .toast-info { border-left: 4px solid #60a5fa; }
    .toast-success { border-left: 4px solid #34d399; }
    .toast-warning { border-left: 4px solid #f59e0b; }
    .toast-error { border-left: 4px solid #ef4444; }
    /* Button loading spinner */
    @keyframes spin { to { transform: rotate(360deg); } }
    .spinner { display:inline-block; width:14px; height:14px; border:2px solid rgba(255,255,255,0.25); border-top-color:#60a5fa; border-radius:50%; animation:spin .8s linear infinite; margin-right:6px; vertical-align:-2px; }
    .btn .spinner { display:none; }
    .btn.btn-loading .spinner { display:inline-block; }
    .btn.btn-loading i { display:none; }
    /* Prevent header shift when icon buttons show spinner */
    .panel-actions .btn.btn-icon.btn-sm {
      width: 32px;
      min-width: 32px;
      height: 32px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    .panel-actions .btn.btn-icon .spinner { margin-right: 0; }
    .btn[aria-busy="true"] { cursor: progress; opacity: .85; }

  /* System Performance redesign (scoped) */
  #panel-perf-dashboard .perf-layout { display: grid; grid-template-columns: repeat(4, minmax(220px, 1fr)); gap: 16px; align-items: start; }
  @media (max-width: 1280px) { #panel-perf-dashboard .perf-layout { grid-template-columns: repeat(2, minmax(220px, 1fr)); } }
  @media (max-width: 700px) { #panel-perf-dashboard .perf-layout { grid-template-columns: 1fr; } }
  /* New unified three-column layout */
  #panel-perf-dashboard .perf-columns { display: grid; grid-template-columns: 1.25fr 1fr 1fr; gap: 16px; align-items: start; }
  @media (max-width: 1280px) { #panel-perf-dashboard .perf-columns { grid-template-columns: 1fr; } }
  @media (min-width: 1281px) and (max-width: 1500px) { #panel-perf-dashboard .perf-columns { grid-template-columns: 1.1fr 1fr 1fr; } }
  #panel-perf-dashboard .perf-card { position: relative; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08); border-radius: 14px; padding: 12px 14px; box-shadow: 0 6px 20px rgba(0,0,0,0.15), inset 0 1px 0 rgba(255,255,255,0.04); }
  #panel-perf-dashboard .perf-card h3 { margin: 0 0 10px 0; font-size: 0.95rem; opacity: 0.85; display: flex; align-items: center; gap: 8px; }
  #panel-perf-dashboard .perf-card .subtle { opacity: 0.7; font-size: 0.8rem; }
  #panel-perf-dashboard .metric-row { display: flex; flex-direction: column; gap: 10px; }
  #panel-perf-dashboard .metric-line { display: flex; justify-content: space-between; align-items: center; gap: 8px; }
  #panel-perf-dashboard .metric-label { opacity: 0.9; }
  #panel-perf-dashboard .metric-value { font-weight: 600; }
  #panel-perf-dashboard .meter { width: 100%; height: 6px; border-radius: 4px; background: rgba(255,255,255,0.06); overflow: hidden; margin-top: 6px; }
  #panel-perf-dashboard .meter > div { height: 100%; width: 0; }
  #panel-perf-dashboard .chip-list { display: grid; grid-template-columns: 1fr; gap: 10px; }
  #panel-perf-dashboard .chip { display: flex; align-items: center; justify-content: space-between; padding: 10px 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.02); box-shadow: inset 0 1px 0 rgba(255,255,255,0.04); }
  #panel-perf-dashboard .chip .left { display: flex; align-items: center; gap: 10px; }
  #panel-perf-dashboard .chip .title { font-weight: 600; opacity: 0.95; display: flex; align-items: center; gap: 8px; }
  #panel-perf-dashboard .perf-badge { font-size: 0.75rem; padding: 4px 10px; border-radius: 999px; background: rgba(255,255,255,0.08); text-transform: capitalize; }
  #panel-perf-dashboard .perf-badge.status-success { background: rgba(34,197,94,0.15); color: #86efac; }
  #panel-perf-dashboard .perf-badge.status-warning { background: rgba(245,158,11,0.15); color: #fcd34d; }
  #panel-perf-dashboard .perf-badge.status-error { background: rgba(239,68,68,0.15); color: #fca5a5; }
  #panel-perf-dashboard .status-dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; }
  #panel-perf-dashboard .status-success { background: #22c55e; }
  #panel-perf-dashboard .status-warning { background: #f59e0b; }
  #panel-perf-dashboard .status-error { background: #ef4444; }
  #panel-perf-dashboard .kpi-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
  #panel-perf-dashboard .kpi { position: relative; padding: 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.08); background: rgba(0,0,0,0.15); box-shadow: inset 0 1px 0 rgba(255,255,255,0.04); }
  #panel-perf-dashboard .kpi .kpi-title { display: flex; justify-content: space-between; align-items: center; gap: 6px; }
  #panel-perf-dashboard .kpi small { opacity: 0.7; }
  #panel-perf-dashboard .accent-left { position: absolute; left: 0; top: 0; bottom: 0; width: 4px; border-radius: 12px 0 0 12px; opacity: 0.8; }
  #panel-perf-dashboard .accent-blue { background: linear-gradient(180deg, #60a5fa, #1e40af); }
  #panel-perf-dashboard .accent-green { background: linear-gradient(180deg, #34d399, #047857); }
  #panel-perf-dashboard .accent-amber { background: linear-gradient(180deg, #fbbf24, #b45309); }
  #panel-perf-dashboard .accent-cyan { background: linear-gradient(180deg, #22d3ee, #0e7490); }
  #panel-perf-dashboard .actions { display: flex; flex-wrap: wrap; gap: 8px; align-items: center; }
  /* Sections: visible by default; hide only when [hidden] is set */
  .app-section { display: block; }
  .app-section[hidden] { display: none !important; }
  /* Safety: ensure Plex panel content is visible */
  #panel-plex .panel-content { display: block !important; visibility: visible !important; }
  /* Operations panel polish (align with theme-demo) */
  .operations-panel .actions { display:flex; flex-wrap:wrap; gap:8px; align-items:center; }
  .operations-panel .main-actions { margin-top: 8px; }
  .operations-panel .sub-actions { margin-top: 8px; }
  .operations-panel .input-row { display:flex; gap:8px; align-items:center; }
  .operations-panel .status-pill { font-size: 0.8rem; padding: 4px 10px; border-radius: 999px; background: rgba(255,255,255,0.08); }
  .operations-panel .status-pill.status-success { background: rgba(34,197,94,0.15); color: #86efac; }
  /* Operations layout */
  .operations-panel .content-grid { display: grid; grid-template-columns: 1.2fr 1fr; gap: 12px; align-items: start; }
  @media (max-width: 1200px) { .operations-panel .content-grid { grid-template-columns: 1fr; } }
  .operations-panel .ops-col { display: flex; flex-direction: column; gap: 12px; }
  /* URL chip and status line */
  .operations-panel .status-line { display:flex; align-items:center; gap:8px; margin-top:6px; }
  .operations-panel .url-chip { display:inline-flex; align-items:center; gap:6px; padding:4px 10px; border-radius:999px; border:1px solid rgba(255,255,255,0.12); background: rgba(255,255,255,0.04); color: inherit; text-decoration: none; }
  .operations-panel .url-chip:hover { border-color: rgba(96,165,250,0.45); box-shadow: inset 0 1px 0 rgba(255,255,255,0.06); }
  /* Operations cards (theme aligned) */
  .operations-panel .perf-card { position: relative; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08); border-radius: 14px; padding: 12px 14px; box-shadow: 0 6px 20px rgba(0,0,0,0.15), inset 0 1px 0 rgba(255,255,255,0.04); }
  .operations-panel .perf-card h3 { margin: 0 0 10px 0; font-size: 0.95rem; opacity: 0.9; display: flex; align-items: center; gap: 8px; }
  .operations-panel .metric-row { display: flex; flex-direction: column; gap: 10px; }
  /* Update progress bar */
  #update-progress { height: 8px; border-radius: 999px; background: rgba(255,255,255,0.06); overflow: hidden; }
  #update-progress > div { height: 100%; width: 0; background: linear-gradient(90deg, #60a5fa, #2563eb); transition: width .2s ease; }
  /* Backups list styling */
  #backups-display { border-top: 1px dashed rgba(255,255,255,0.08); padding-top: 10px; }
  #backups-content { display: grid; gap: 8px; }
  #backups-content .backup-item { display:flex; justify-content:space-between; align-items:center; padding:8px 10px; border:1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.02); border-radius:10px; }
  /* Security panel polish */
  .security-panel .perf-card { background: linear-gradient(180deg, rgba(255,255,255,0.035), rgba(255,255,255,0.02)); border: 1px solid rgba(255,255,255,0.08); border-radius: 14px; padding: var(--space-lg); }
  .security-panel .perf-card h3 { margin: 0 0 12px 0; font-weight: 700; opacity: .92; display:flex; align-items:center; gap:8px; }
  .security-panel .metric-row { gap: 12px; }
  .security-panel .actions { display:flex; flex-wrap:wrap; gap:10px; align-items:center; }
  .security-panel .subtle { opacity: .8; }
  .security-panel .input-row { display:flex; gap:8px; align-items:center; }
  .security-panel .input-row .btn.btn-icon { min-width: 36px; height: 36px; display:flex; align-items:center; justify-content:center; }
  .security-panel .input-row input { flex: 1; min-width: 0; }
  .security-panel .note { font-size:.85rem; opacity:.75; }
  .security-panel .perf-columns { display:grid; grid-template-columns: 1fr 1fr; gap: var(--space-md, 12px); }
  .security-panel .perf-card + .perf-card { margin-top: 0; }
  .security-panel .perf-card { margin-bottom: 0; }
  @media (max-width: 900px) {
    .security-panel .perf-columns { grid-template-columns: 1fr !important; }
  }
  /* Single-column grid helper for stacked fields */
  .security-panel .form-grid.form-single-col { grid-template-columns: 1fr; gap: var(--space-md, 12px); }
  /* Utility */
  .is-hidden { display: none !important; }

  /* Subheader inside panels (e.g., Streaming Releases under TMDB) */
  .panel-header.panel-sub {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
    padding: 8px 0;
    margin: 8px 0;
    border-top: 1px dashed rgba(255,255,255,0.08);
    border-bottom: 1px dashed rgba(255,255,255,0.08);
  }
  .panel-header.panel-sub h3 {
    margin: 0;
    font-size: 1rem;
    font-weight: 600;
    opacity: .92;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  /* (clean) visibility uses [hidden] default styles in theme */
  /* Panel loading overlay (prevents default-value flash) */
  .panel .panel-content { position: relative; }
  /* Subpanel styling (used inside TMDB for Streaming Releases) */
  .subpanel { border: 1px solid rgba(255,255,255,0.08); border-radius: 12px; padding: 10px 12px; background: rgba(255,255,255,0.02); box-shadow: inset 0 1px 0 rgba(255,255,255,0.04); }
  .subpanel + .subpanel { margin-top: 10px; }
  .subpanel-header { display:flex; align-items:center; justify-content:space-between; gap:10px; margin: -2px 0 8px; }
  .subpanel-header h3 { margin:0; font-size: 1rem; display:flex; align-items:center; gap:8px; opacity:.95; }
  .subpanel-body .subtle { opacity:.8; margin-bottom: 8px; }
  .loading-overlay { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; z-index: 2; opacity: 0; pointer-events: none; transition: opacity .18s ease; }
  .loading-overlay .glass { position: absolute; inset: 0; background: transparent; backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px); border-radius: 12px; }
  .loading-overlay .loader { position: relative; display: flex; align-items: center; justify-content: center; padding: 0; border: 0; background: transparent; box-shadow: none; color: var(--color-text-primary); }
  .loading-overlay .loader .spinner { margin: 0; width: 20px; height: 20px; border-width: 2px; filter: drop-shadow(0 0 10px rgba(96,165,250,0.35)); }
  .panel.is-loading .loading-overlay { opacity: 1; pointer-events: auto; }
  /* Blur/dim content while loading, then fade to sharp */
  .panel .panel-content > *:not(.loading-overlay) { opacity: 1; transform: none; filter: none; transition: opacity .18s ease, transform .18s ease, filter .18s ease; }
  .panel.is-loading .panel-content > *:not(.loading-overlay) { opacity: 1; filter: blur(4px); }
  @media (prefers-reduced-motion: reduce) {
    .loading-overlay,
    .panel .panel-content > *:not(.loading-overlay) {
      transition: none !important;
    }
  }
  
  </style>
</head>
<body>
  <!-- Top navbar -->
  <nav class="navbar">
    <div class="nav-brand">
      <button class="btn btn-icon mobile-only" id="mobile-nav-toggle" aria-label="Toggle navigation" aria-expanded="false">
        <i class="fas fa-bars"></i>
      </button>
      <span>Posterrama</span>
  <span class="version" id="app-version" title="Current version" style="margin-left:8px;">—</span>
  <span class="nav-badge" id="update-available-pill" hidden title="" style="margin-left:6px;">Update available</span>
    </div>
    <div class="nav-actions">
      <button class="btn btn-icon" id="notif-btn" title="Notifications">
        <i class="fas fa-bell"></i>
        <span class="badge" id="notif-count" hidden>0</span>
      </button>
      <div class="dropdown" id="settings-dropdown">
        <button class="btn btn-icon dropdown-toggle" id="settings-btn" title="Settings" aria-haspopup="true" aria-expanded="false" aria-controls="settings-menu">
          <i class="fas fa-cog"></i>
        </button>
        <div class="dropdown-menu" id="settings-menu" role="menu" aria-hidden="true">
          <div class="dropdown-heading">Quick links</div>
          <a class="dropdown-item" href="/" target="_blank" rel="noopener" title="Open Posterrama in a new tab">
            <i class="fas fa-external-link-alt"></i>
            <span>View Posterrama</span>
          </a>
          <a class="dropdown-item" href="https://github.com/Posterrama/posterrama#readme" target="_blank" rel="noopener">
            <i class="fas fa-circle-question"></i>
              <select id="plex.movies" multiple style="display:none"></select>
              <div class="multiselect" id="plex-ms-movies">
                <div class="ms-control" role="combobox" aria-expanded="false" aria-haspopup="listbox">
                  <div class="ms-chips" id="plex-ms-movies-chips"></div>
                  <button class="ms-clear" id="plex-ms-movies-clear" title="Clear selection"><i class="fas fa-xmark"></i></button>
                  <i class="fas fa-chevron-down ms-caret" aria-hidden="true"></i>
                </div>
                <div class="ms-menu" id="plex-ms-movies-menu" role="listbox">
                  <div class="ms-search">
                    <i class="fas fa-search"></i>
                    <input id="plex-ms-movies-search" type="text" placeholder="Search libraries…">
                  </div>
                  <div class="ms-actions">
                    <button class="btn btn-outline btn-sm" id="plex-ms-movies-select-all"><i class="fas fa-square-check"></i> Select all</button>
                    <button class="btn btn-outline btn-sm" id="plex-ms-movies-clear-all"><i class="fas fa-eraser"></i> Clear</button>
                  </div>
                  <div class="ms-options" id="plex-ms-movies-options"></div>
                </div>
              </div>
          </a>
          <a class="dropdown-item" href="/api-docs" target="_blank" rel="noopener">
            <i class="fas fa-book"></i>
              <select id="plex.shows" multiple style="display:none"></select>
              <div class="multiselect" id="plex-ms-shows">
                <div class="ms-control" role="combobox" aria-expanded="false" aria-haspopup="listbox">
                  <div class="ms-chips" id="plex-ms-shows-chips"></div>
                  <button class="ms-clear" id="plex-ms-shows-clear" title="Clear selection"><i class="fas fa-xmark"></i></button>
                  <i class="fas fa-chevron-down ms-caret" aria-hidden="true"></i>
                </div>
                <div class="ms-menu" id="plex-ms-shows-menu" role="listbox">
                  <div class="ms-search">
                    <i class="fas fa-search"></i>
                    <input id="plex-ms-shows-search" type="text" placeholder="Search libraries…">
                  </div>
                  <div class="ms-actions">
                    <button class="btn btn-outline btn-sm" id="plex-ms-shows-select-all"><i class="fas fa-square-check"></i> Select all</button>
                    <button class="btn btn-outline btn-sm" id="plex-ms-shows-clear-all"><i class="fas fa-eraser"></i> Clear</button>
                  </div>
                  <div class="ms-options" id="plex-ms-shows-options"></div>
                </div>
              </div>
          </a>
          <a class="dropdown-item" href="https://github.com/Posterrama/posterrama" target="_blank" rel="noopener">
            <i class="fab fa-github"></i>
            <span>GitHub Repository</span>
          </a>
          <a class="dropdown-item" href="https://github.com/Posterrama/posterrama/issues/new/choose" target="_blank" rel="noopener">
            <i class="fas fa-bug"></i>
              <select id="jf.movies" multiple style="display:none"></select>
              <div class="multiselect" id="jf-ms-movies">
                <div class="ms-control" role="combobox" aria-expanded="false" aria-haspopup="listbox">
                  <div class="ms-chips" id="jf-ms-movies-chips"></div>
                  <button class="ms-clear" id="jf-ms-movies-clear" title="Clear selection"><i class="fas fa-xmark"></i></button>
                  <i class="fas fa-chevron-down ms-caret" aria-hidden="true"></i>
                </div>
                <div class="ms-menu" id="jf-ms-movies-menu" role="listbox">
                  <div class="ms-search">
                    <i class="fas fa-search"></i>
                    <input id="jf-ms-movies-search" type="text" placeholder="Search libraries…">
                  </div>
                  <div class="ms-actions">
                    <button class="btn btn-outline btn-sm" id="jf-ms-movies-select-all"><i class="fas fa-square-check"></i> Select all</button>
                    <button class="btn btn-outline btn-sm" id="jf-ms-movies-clear-all"><i class="fas fa-eraser"></i> Clear</button>
                  </div>
                  <div class="ms-options" id="jf-ms-movies-options"></div>
                </div>
              </div>
          </a>
          <div class="dropdown-divider"></div>
          <div class="dropdown-heading">Server</div>
              <select id="jf.shows" multiple style="display:none"></select>
              <div class="multiselect" id="jf-ms-shows">
                <div class="ms-control" role="combobox" aria-expanded="false" aria-haspopup="listbox">
                  <div class="ms-chips" id="jf-ms-shows-chips"></div>
                  <button class="ms-clear" id="jf-ms-shows-clear" title="Clear selection"><i class="fas fa-xmark"></i></button>
                  <i class="fas fa-chevron-down ms-caret" aria-hidden="true"></i>
                </div>
                <div class="ms-menu" id="jf-ms-shows-menu" role="listbox">
                  <div class="ms-search">
                    <i class="fas fa-search"></i>
                    <input id="jf-ms-shows-search" type="text" placeholder="Search libraries…">
                  </div>
                  <div class="ms-actions">
                    <button class="btn btn-outline btn-sm" id="jf-ms-shows-select-all"><i class="fas fa-square-check"></i> Select all</button>
                    <button class="btn btn-outline btn-sm" id="jf-ms-shows-clear-all"><i class="fas fa-eraser"></i> Clear</button>
                  </div>
                  <div class="ms-options" id="jf-ms-shows-options"></div>
                </div>
              </div>
            <i class="fas fa-rotate"></i>
            <span>Restart Posterrama</span>
          </a>
        </div>
      </div>
      <div class="nav-user">
        <i class="fas fa-user-circle"></i>
        <span>Admin</span>
      </div>
    </div>
  </nav>

  <!-- Sidebar -->
  <aside class="sidebar">
    <nav class="sidebar-nav">
      <a href="#" class="nav-item active" data-nav="dashboard">
        <i class="fas fa-tachometer-alt"></i>
        <span>Dashboard</span>
      </a>
      <a href="#" class="nav-item" data-nav="display">
        <i class="fas fa-desktop"></i>
        <span>Display Settings</span>
      </a>
      <div class="nav-group open">
        <a href="#" class="nav-item nav-toggle">
          <i class="fas fa-server"></i>
          <span>Media Sources</span>
          <i class="fas fa-chevron-down nav-arrow"></i>
        </a>
        <div class="nav-submenu">
          <a href="#" class="nav-subitem" data-sub="plex"><i class="fas fa-film"></i><span>Plex</span></a>
          <a href="#" class="nav-subitem" data-sub="jellyfin"><i class="fas fa-play"></i><span>Jellyfin</span></a>
          <a href="#" class="nav-subitem" data-sub="tmdb"><i class="fas fa-database"></i><span>TMDB</span></a>
          <a href="#" class="nav-subitem" data-sub="tvdb"><i class="fas fa-tv"></i><span>TVDB</span></a>
        </div>
      </div>
      <a href="#" class="nav-item" data-nav="devices">
        <i class="fas fa-laptop"></i>
        <span class="nav-text-with-badge">
          Device Management
          <span class="nav-badge">BETA</span>
        </span>
      </a>
      <a href="#" class="nav-item" data-nav="security"><i class="fas fa-shield-alt"></i><span>Security</span></a>
      <a href="#" class="nav-item" data-nav="operations"><i class="fas fa-screwdriver-wrench"></i><span>Operations</span></a>
    </nav>
  <div class="sidebar-footer"></div>
  </aside>

  <div class="sidebar-overlay" id="sidebar-overlay" hidden></div>

  <!-- Main content -->
  <main class="main-content">
    <header class="page-header">
      <div class="page-title">
        <h1><i class="fas fa-gauge-high"></i> Dashboard</h1>
        <p>Overview of devices, media and system health</p>
      </div>
      
    </header>

  <!-- Dashboard Section -->
  <section id="section-dashboard" class="app-section active">
  <!-- KPI cards -->
  <section class="card-grid" id="kpi-cards">
      <div class="status-card status-success" title="Devices that are Online or Live">
        <div class="card-icon"><i class="fas fa-check-circle"></i></div>
        <div class="card-content">
          <h3>Active Devices</h3>
          <span class="metric" id="metric-active-devices">—</span>
          <span class="trend" id="metric-active-trend"></span>
        </div>
      </div>
      <div class="status-card status-info" title="Total media items across connected sources">
        <div class="card-icon"><i class="fas fa-images"></i></div>
        <div class="card-content">
          <h3>Media Items</h3>
          <span class="metric" id="metric-media-items">—</span>
          <span class="trend" id="metric-media-sub">from sources</span>
        </div>
      </div>
      <div class="status-card status-warning" title="Open warnings and recent errors">
        <div class="card-icon"><i class="fas fa-exclamation-triangle"></i></div>
        <div class="card-content">
          <h3>Warnings</h3>
          <span class="metric" id="metric-warnings">—</span>
          <span class="trend" id="metric-warn-sub"></span>
        </div>
      </div>
      <div class="status-card status-error" title="Devices currently Offline">
        <div class="card-icon"><i class="fas fa-times-circle"></i></div>
        <div class="card-content">
          <h3>Offline Devices</h3>
          <span class="metric" id="metric-offline-devices">—</span>
          <span class="trend negative" id="metric-offline-sub">needs attention</span>
        </div>
      </div>
    </section>

    
    

  <section class="content-grid" style="margin-top: 16px;">
      <!-- Unified System Performance Dashboard -->
      <section class="panel" id="panel-perf-dashboard">
        <header class="panel-header">
          <h2><i class="fas fa-gauge-high"></i> System Performance</h2>
          <div class="panel-actions">
            <button class="btn btn-icon btn-sm" id="btn-perf-refresh" title="Refresh performance"><i class="fas fa-rotate"></i></button>
          </div>
        </header>
        <div class="panel-content">
          <div class="perf-columns">
            <!-- Column 1: Status + Resources unified -->
            <section class="perf-card" aria-label="System Status and Resources">
              <h3><i class="fas fa-heartbeat"></i> Status</h3>
              <div class="chip-list">
                <div class="chip" id="chip-app">
                  <div class="left">
                    <span class="status-dot status-success" id="chip-app-dot"></span>
                    <span class="title"><i class="fas fa-rocket"></i> App</span>
                  </div>
                  <span class="perf-badge" id="perf-app-status">—</span>
                </div>
                <div class="chip" id="chip-db">
                  <div class="left">
                    <span class="status-dot status-warning" id="chip-db-dot"></span>
                    <span class="title"><i class="fas fa-database"></i> Database</span>
                  </div>
                  <span class="perf-badge" id="perf-db-status">—</span>
                </div>
                <div class="chip" id="chip-cache">
                  <div class="left">
                    <span class="status-dot status-warning" id="chip-cache-dot"></span>
                    <span class="title"><i class="fas fa-bolt"></i> Cache</span>
                  </div>
                  <span class="perf-badge" id="perf-cache-status">—</span>
                </div>
              </div>
              <div style="height:8px;"></div>
              <h3><i class="fas fa-microchip"></i> Resources</h3>
              <div class="metric-row">
                <div>
                  <div class="metric-line"><span class="metric-label">CPU</span><span class="metric-value" id="perf-cpu">—</span></div>
                  <div class="meter"><div id="meter-cpu"></div></div>
                </div>
                <div>
                  <div class="metric-line"><span class="metric-label" title="System memory (OS) — same as legacy Admin > Management > Performance Monitor">System Memory</span><span class="metric-value" id="perf-mem">—</span></div>
                  <div class="meter"><div id="meter-mem"></div></div>
                </div>
                <div class="metric-line"><span class="metric-label">Disk</span><span class="metric-value" id="perf-disk">—</span></div>
                <div class="metric-line"><span class="metric-label">Uptime</span><span class="metric-value" id="perf-uptime">—</span></div>
              </div>
            </section>

            <!-- Column 2: Traffic & Reliability -->
            <section class="perf-card" aria-label="Traffic and Reliability">
              <h3><i class="fas fa-wave-square"></i> Traffic & Reliability</h3>
              <div class="kpi-grid">
                <div class="kpi" title="Requests handled by Posterrama per minute (server-wide, last 60s)">
                  <span class="accent-left accent-blue"></span>
                  <div class="kpi-title"><span>Requests</span><span id="perf-rps">—</span></div>
                  <small>per minute</small>
                </div>
                <div class="kpi" title="Average HTTP response time of Posterrama API (last hour)">
                  <span class="accent-left accent-cyan"></span>
                  <div class="kpi-title"><span>Resp. Time</span><span id="perf-rt">—</span></div>
                  <small>average</small>
                </div>
                <div class="kpi" title="Percentage van requests met HTTP status >=400 (laatste uur)">
                  <span class="accent-left accent-amber"></span>
                  <div class="kpi-title"><span>Error Rate</span><span id="perf-error-rate">—</span></div>
                  <small>last hour</small>
                </div>
                <div class="kpi" title="Cache hit rate (gemiddeld) van Posterrama responses)">
                  <span class="accent-left accent-green"></span>
                  <div class="kpi-title"><span>Cache Hit</span><span id="perf-cache-hit">—</span></div>
                  <small>overall</small>
                </div>
              </div>
            </section>

            <!-- Column 3: Cache Management -->
            <section class="perf-card" aria-label="Cache Management">
              <h3><i class="fas fa-database"></i> Cache Management</h3>
              <div class="metric-row" style="margin-bottom:8px;">
                <div>
                  <div class="metric-line"><span class="metric-label"><i class="fas fa-hdd"></i> Cache Storage</span></div>
                  <div id="cache-disk-usage" class="subtle" style="margin-top:6px;">Loading…</div>
                  <div class="meter" title="Image cache usage against max configured size" style="margin-top:8px;">
                    <div id="meter-image-cache"></div>
                  </div>
                </div>
                <div>
                  <div class="metric-line"><span class="metric-label"><i class="fas fa-memory"></i> Memory Cache</span></div>
                  <div id="cache-item-count" class="subtle" style="margin-top:6px;">Loading…</div>
                </div>
              </div>
              <div class="actions">
                <button type="button" id="cleanup-cache-button" class="btn btn-secondary btn-sm" title="Run cache cleanup">
                  <i class="fas fa-compress-alt"></i><span>Run Cleanup</span>
                </button>
                <button type="button" id="clear-cache-button" class="btn btn-primary btn-sm" title="Clear image cache from disk">
                  <i class="fas fa-broom"></i><span>Clear Cache</span>
                </button>
              </div>
            </section>
          </div>
        </div>
      </section>
    </section>
    </section> <!-- /section-dashboard -->

    <!-- Media Sources Section (top-level sibling, not nested under dashboard) -->
    <section id="section-media-sources" class="app-section" hidden>
      <section class="panel" id="panel-sources-overview">
        <header class="panel-header">
          <h2><i class="fas fa-database"></i> Media Sources</h2>
          <div class="panel-actions"></div>
        </header>
        <div class="panel-content">
          <div class="subtle">This section explains how Media Sources work. Use the submenu (Plex, Jellyfin, TMDB, TVDB) to configure each source. You can test connections, select libraries, and apply filters within each specific source panel.</div>
        </div>
      </section>

      <!-- Plex Panel -->
      <section class="panel" id="panel-plex">
        <header class="panel-header">
          <h2><i class="fas fa-film"></i> Plex</h2>
          <div class="panel-actions">
            <button class="btn btn-icon btn-sm" id="btn-plex-test" title="Test connection"><i class="fas fa-vial"></i></button>
            <button class="btn btn-icon btn-sm" id="btn-plex-libraries" title="Fetch libraries"><i class="fas fa-list"></i></button>
            <button class="btn btn-primary btn-sm" id="btn-save-plex" title="Save Plex settings"><i class="fas fa-save"></i><span>Save Settings</span></button>
          </div>
        </header>
        <div class="panel-content">
          <div class="loading-overlay" aria-hidden="true">
            <div class="glass"></div>
            <div class="loader"><span class="spinner"></span></div>
          </div>
          <div class="status-line" id="plex-status-line" aria-live="polite" style="margin-bottom:8px; display:flex; align-items:center; gap:8px;">
            <span class="status-pill" id="plex-status-pill">Not tested</span>
            <a href="#" class="url-chip" id="plex-url-chip" hidden target="_blank" rel="noopener">
              <i class="fas fa-link"></i>
              <span id="plex-url-text"></span>
            </a>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label class="checkbox"><input type="checkbox" id="plex.enabled"><span class="checkmark"></span><span>Enabled</span></label>
            </div>
            <div class="form-group">
              <label for="plex.hostname">Hostname</label>
              <input type="text" id="plex.hostname" placeholder="e.g. 192.168.1.10">
            </div>
            <div class="form-group">
              <label for="plex.port">Port</label>
              <input type="number" id="plex.port" min="1" max="65535" placeholder="32400">
            </div>
            <div class="form-group">
              <label for="plex.token">Token</label>
              <input type="password" id="plex.token" placeholder="X-Plex-Token">
              <small class="form-help">Stored in environment. Not shown after save.</small>
            </div>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label for="plex.movies">Movie Libraries</label>
              <select id="plex.movies" multiple></select>
            </div>
            <div class="form-group">
              <label for="plex.shows">Show Libraries</label>
              <select id="plex.shows" multiple></select>
            </div>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label class="checkbox"><input type="checkbox" id="plex.recentOnly"><span class="checkmark"></span><span>Recently added only</span></label>
            </div>
            <div class="form-group">
              <label for="plex.recentDays">Recently added days</label>
              <input type="number" id="plex.recentDays" min="1" max="365" placeholder="30">
            </div>
            <div class="form-group">
              <label for="plex.ratingFilter">Rating filter</label>
              <input type="text" id="plex.ratingFilter" placeholder="e.g. PG-13, R">
            </div>
            <div class="form-group">
              <label for="plex.qualityFilter">Quality filter</label>
              <select id="plex.qualityFilter">
                <option value="">Any</option>
                <option value="SD">SD</option>
                <option value="720p">720p</option>
                <option value="1080p">1080p</option>
                <option value="4K">4K</option>
              </select>
            </div>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label for="plex.yearFilter">Release Years</label>
              <input type="text" id="plex.yearFilter" inputmode="numeric" placeholder="e.g. 1995, 1998, 2015-2025">
            </div>
          </div>
            <div class="form-grid">
              <div class="form-group" style="grid-column: 1 / -1;">
                <label>Genre filter</label>
                <input type="hidden" id="plex.genreFilter-hidden" value="">
                <div class="multiselect" id="plex-ms-genres">
                  <div class="ms-control" role="combobox" aria-expanded="false" aria-haspopup="listbox">
                    <div class="ms-chips" id="plex-ms-genres-chips"></div>
                    <button class="ms-clear" id="plex-ms-genres-clear" title="Clear selection"><i class="fas fa-xmark"></i></button>
                    <i class="fas fa-chevron-down ms-caret" aria-hidden="true"></i>
                  </div>
                  <div class="ms-menu" id="plex-ms-genres-menu" role="listbox">
                    <div class="ms-search">
                      <i class="fas fa-search"></i>
                      <input id="plex-ms-genres-search" type="text" placeholder="Search genres…">
                    </div>
                    <div class="ms-actions">
                      <button class="btn btn-outline btn-sm" id="plex-ms-genres-select-all"><i class="fas fa-square-check"></i> Select all</button>
                      <button class="btn btn-outline btn-sm" id="plex-ms-genres-clear-all"><i class="fas fa-eraser"></i> Clear</button>
                    </div>
                    <div class="ms-options" id="plex-ms-genres-options"></div>
                  </div>
                </div>
                <small id="plex-genre-help" class="form-help">Select one or more genres. Populated from Plex.</small>
              </div>
            </div>
        </div>
      </section>

      <!-- Jellyfin Panel -->
      <section class="panel" id="panel-jellyfin" hidden>
        <header class="panel-header">
          <h2><i class="fas fa-play"></i> Jellyfin</h2>
          <div class="panel-actions">
            <button class="btn btn-icon btn-sm" id="btn-jf-test" title="Test connection"><i class="fas fa-vial"></i></button>
            <button class="btn btn-icon btn-sm" id="btn-jf-libraries" title="Fetch libraries"><i class="fas fa-list"></i></button>
            <button class="btn btn-primary btn-sm" id="btn-save-jellyfin" title="Save Jellyfin settings"><i class="fas fa-save"></i><span>Save Settings</span></button>
          </div>
        </header>
        <div class="panel-content">
          <div class="loading-overlay" aria-hidden="true">
            <div class="glass"></div>
            <div class="loader"><span class="spinner"></span></div>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label class="checkbox"><input type="checkbox" id="jf.enabled"><span class="checkmark"></span><span>Enabled</span></label>
            </div>
            <div class="form-group">
              <label for="jf.hostname">Hostname</label>
              <input type="text" id="jf.hostname" placeholder="e.g. 192.168.1.20">
            </div>
            <div class="form-group">
              <label for="jf.port">Port</label>
              <input type="number" id="jf.port" min="1" max="65535" placeholder="8096">
            </div>
            <div class="form-group">
              <label for="jf.apikey">API Key</label>
              <input type="password" id="jf.apikey" placeholder="Jellyfin API Key">
              <small class="form-help">Stored in environment. Not shown after save.</small>
            </div>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label for="jf.movies">Movie Libraries</label>
              <select id="jf.movies" multiple></select>
            </div>
            <div class="form-group">
              <label for="jf.shows">Show Libraries</label>
              <select id="jf.shows" multiple></select>
            </div>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label class="checkbox"><input type="checkbox" id="jf.recentOnly"><span class="checkmark"></span><span>Recently added only</span></label>
            </div>
            <div class="form-group">
              <label for="jf.recentDays">Recently added days</label>
              <input type="number" id="jf.recentDays" min="1" max="365" placeholder="30">
            </div>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label for="jf.yearFilter">Release Years</label>
              <input type="text" id="jf.yearFilter" inputmode="numeric" placeholder="e.g. 1995, 1998, 2015-2025">
            </div>
          </div>
        </div>
      </section>

      <!-- TMDB Panel -->
      <section class="panel" id="panel-tmdb">
        <header class="panel-header">
          <h2><i class="fas fa-database"></i> TMDB</h2>
          <div class="panel-actions">
            <button class="btn btn-icon btn-sm" id="btn-tmdb-test" title="Test connection"><i class="fas fa-vial"></i></button>
            <button class="btn btn-primary btn-sm" id="btn-save-tmdb" title="Save TMDB settings"><i class="fas fa-save"></i><span>Save Settings</span></button>
          </div>
        </header>
        <div class="panel-content">
          <div class="loading-overlay" aria-hidden="true">
            <div class="glass"></div>
            <div class="loader"><span class="spinner"></span></div>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label class="checkbox"><input type="checkbox" id="tmdb.enabled"><span class="checkmark"></span><span>Enabled</span></label>
            </div>
            <div class="form-group">
              <label for="tmdb.apikey">API Key</label>
              <input type="password" id="tmdb.apikey" placeholder="TMDB API Key">
            </div>
            <div class="form-group">
              <label for="tmdb.category">Category</label>
              <div class="select-wrap">
                <span class="select-icon" id="tmdb-category-icon"><i class="fas fa-fire"></i></span>
                <select id="tmdb.category">
                  <optgroup label="Movies">
                    <option value="popular">Popular Movies</option>
                    <option value="top_rated">Top Rated Movies</option>
                    <option value="now_playing">Now Playing</option>
                    <option value="upcoming">Upcoming Movies</option>
                    <option value="latest">Latest Movies</option>
                  </optgroup>
                  <optgroup label="TV Shows">
                    <option value="tv_popular">Popular TV Shows</option>
                    <option value="tv_top_rated">Top Rated TV Shows</option>
                    <option value="tv_on_the_air">Currently Airing</option>
                    <option value="tv_airing_today">Airing Today</option>
                    <option value="tv_latest">Latest TV Shows</option>
                  </optgroup>
                  <optgroup label="Trending">
                    <option value="trending_all_day">Trending Today (All)</option>
                    <option value="trending_movie_day">Trending Movies (Day)</option>
                    <option value="trending_tv_day">Trending TV (Day)</option>
                    <option value="trending_all_week">Trending Week (All)</option>
                    <option value="trending_movie_week">Trending Movies (Week)</option>
                    <option value="trending_tv_week">Trending TV (Week)</option>
                  </optgroup>
                  <optgroup label="Collections">
                    <option value="discover_movie">Discover Movies</option>
                    <option value="discover_tv">Discover TV Shows</option>
                  </optgroup>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label for="tmdb.minRating">Min Rating</label>
              <input type="number" id="tmdb.minRating" min="0" max="10" step="0.1" placeholder="0">
            </div>
            <div class="form-group">
              <label for="tmdb.yearFilter">Release Years</label>
              <input type="text" id="tmdb.yearFilter" inputmode="numeric" placeholder="e.g. 1995, 1998, 2015-2025">
              
            </div>
          </div>
            <div class="form-grid">
              <div class="form-group" style="grid-column: 1 / -1;">
                <label>Genre filter</label>
                <input type="hidden" id="tmdb.genreFilter-hidden" value="">
                <div class="multiselect" id="tmdb-ms-genres">
                  <div class="ms-control" role="combobox" aria-expanded="false" aria-haspopup="listbox">
                    <div class="ms-chips" id="tmdb-ms-genres-chips"></div>
                    <button class="ms-clear" id="tmdb-ms-genres-clear" title="Clear selection"><i class="fas fa-xmark"></i></button>
                    <i class="fas fa-chevron-down ms-caret" aria-hidden="true"></i>
                  </div>
                  <div class="ms-menu" id="tmdb-ms-genres-menu" role="listbox">
                    <div class="ms-search">
                      <i class="fas fa-search"></i>
                      <input id="tmdb-ms-genres-search" type="text" placeholder="Search genres…">
                    </div>
                    <div class="ms-actions">
                      <button class="btn btn-outline btn-sm" id="tmdb-ms-genres-select-all"><i class="fas fa-square-check"></i> Select all</button>
                      <button class="btn btn-outline btn-sm" id="tmdb-ms-genres-clear-all"><i class="fas fa-eraser"></i> Clear</button>
                    </div>
                    <div class="ms-options" id="tmdb-ms-genres-options"></div>
                  </div>
                </div>
                <small id="tmdb-genre-help" class="form-help">Select one or more genres. Populated from TMDB.</small>
              </div>
            </div>

          <!-- Streaming Releases (TMDB-based) -->
          <div class="form-divider" aria-hidden="true"></div>
          <section class="subpanel" id="subpanel-streaming">
            <header class="subpanel-header">
              <h3>
                <i class="fas fa-stream" aria-hidden="true"></i>
                <span>Streaming Releases</span>
              </h3>
              <div class="panel-actions">
                <button class="btn btn-icon btn-sm" id="test-streaming-button" title="Test Streaming"><i class="fas fa-vial"></i></button>
              </div>
            </header>
            <div class="subpanel-body">
              <div class="subtle">Add latest releases from popular streaming platforms using TMDB's provider data.</div>
              <small id="streaming-connection-status" class="form-help"></small>
          <div class="form-grid">
            <div class="form-group">
              <label class="checkbox"><input type="checkbox" id="streamingSources.enabled"><span class="checkmark"></span><span>Enabled</span></label>
            </div>
          </div>
          <div class="form-grid">
            <div class="form-group" style="grid-column: 1 / -1;">
              <label>Streaming Providers</label>
              <select id="streaming.providers" multiple style="display:none"></select>
              <div class="multiselect" id="streaming-ms-providers">
                <div class="ms-control" role="combobox" aria-expanded="false" aria-haspopup="listbox">
                  <div class="ms-chips" id="streaming-ms-providers-chips"></div>
                  <div class="placeholder">Select streaming providers</div>
                  <i class="fas fa-chevron-down ms-caret" aria-hidden="true"></i>
                </div>
                <div class="ms-menu" id="streaming-ms-providers-menu" role="listbox">
                  <div class="ms-actions">
                    <input type="text" id="streaming-ms-providers-search" placeholder="Search providers" aria-label="Search providers">
                    <div class="ms-actions-buttons">
                      <button class="btn btn-outline btn-sm" id="streaming-ms-providers-select-all"><i class="fas fa-plus"></i> Select all</button>
                      <button class="btn btn-outline btn-sm" id="streaming-ms-providers-clear-all"><i class="fas fa-eraser"></i> Clear</button>
                    </div>
                  </div>
                  <div class="ms-options" id="streaming-ms-providers-options"></div>
                </div>
              </div>
            </div>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label class="checkbox"><input type="checkbox" id="streamingSources.newReleases"><span class="checkmark"></span><span>New Releases (Selected)</span></label>
            </div>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label for="streamingSources.region">Region</label>
              <select id="streamingSources.region">
                <option value="US">🇺🇸 United States</option>
                <option value="NL">🇳🇱 Netherlands</option>
                <option value="GB">🇬🇧 United Kingdom</option>
                <option value="DE">🇩🇪 Germany</option>
                <option value="FR">🇫🇷 France</option>
                <option value="CA">🇨🇦 Canada</option>
                <option value="AU">🇦🇺 Australia</option>
                <option value="ES">🇪🇸 Spain</option>
                <option value="IT">🇮🇹 Italy</option>
                <option value="BR">🇧🇷 Brazil</option>
                <option value="MX">🇲🇽 Mexico</option>
                <option value="AR">🇦🇷 Argentina</option>
                <option value="JP">🇯🇵 Japan</option>
                <option value="KR">🇰🇷 South Korea</option>
                <option value="IN">🇮🇳 India</option>
                <option value="CN">🇨🇳 China</option>
                <option value="RU">🇷🇺 Russia</option>
                <option value="BE">🇧🇪 Belgium</option>
                <option value="AT">🇦🇹 Austria</option>
                <option value="CH">🇨🇭 Switzerland</option>
                <option value="SE">🇸🇪 Sweden</option>
                <option value="NO">🇳🇴 Norway</option>
                <option value="DK">🇩🇰 Denmark</option>
                <option value="FI">🇫🇮 Finland</option>
                <option value="PL">🇵🇱 Poland</option>
                <option value="CZ">🇨🇿 Czech Republic</option>
                <option value="HU">🇭🇺 Hungary</option>
                <option value="PT">🇵🇹 Portugal</option>
                <option value="GR">🇬🇷 Greece</option>
                <option value="TR">🇹🇷 Turkey</option>
                <option value="IL">🇮🇱 Israel</option>
                <option value="ZA">🇿🇦 South Africa</option>
                <option value="EG">🇪🇬 Egypt</option>
                <option value="SA">🇸🇦 Saudi Arabia</option>
                <option value="AE">🇦🇪 United Arab Emirates</option>
                <option value="TH">🇹🇭 Thailand</option>
                <option value="SG">🇸🇬 Singapore</option>
                <option value="MY">🇲🇾 Malaysia</option>
                <option value="ID">🇮🇩 Indonesia</option>
                <option value="PH">🇵🇭 Philippines</option>
                <option value="VN">🇻🇳 Vietnam</option>
                <option value="TW">🇹🇼 Taiwan</option>
                <option value="HK">🇭🇰 Hong Kong</option>
                <option value="NZ">🇳🇿 New Zealand</option>
                <option value="CL">🇨🇱 Chile</option>
                <option value="CO">🇨🇴 Colombia</option>
                <option value="PE">🇵🇪 Peru</option>
                <option value="VE">🇻🇪 Venezuela</option>
                <option value="UY">🇺🇾 Uruguay</option>
                <option value="EC">🇪🇨 Ecuador</option>
                <option value="BO">🇧🇴 Bolivia</option>
                <option value="PY">🇵🇾 Paraguay</option>
              </select>
            </div>
          </div>
          
          <div class="form-grid">
            <div class="form-group">
              <label for="streamingSources.minRating">Minimum Rating (0-10)</label>
              <input type="number" id="streamingSources.minRating" min="0" max="10" step="0.1" placeholder="6.0">
            </div>
          </div>
            </div>
          </section>
        </div>
      </section>

      <!-- TVDB Panel -->
      <section class="panel" id="panel-tvdb">
        <header class="panel-header">
          <h2><i class="fas fa-tv"></i> TVDB</h2>
          <div class="panel-actions">
            <button class="btn btn-icon btn-sm" id="btn-tvdb-test" title="Test connection"><i class="fas fa-vial"></i></button>
            <button class="btn btn-primary btn-sm" id="btn-save-tvdb" title="Save TVDB settings"><i class="fas fa-save"></i><span>Save Settings</span></button>
          </div>
        </header>
        <div class="panel-content">
          <div class="loading-overlay" aria-hidden="true">
            <div class="glass"></div>
            <div class="loader"><span class="spinner"></span></div>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label class="checkbox"><input type="checkbox" id="tvdb.enabled"><span class="checkmark"></span><span>Enabled</span></label>
            </div>
            <div class="form-group">
              <label for="tvdb.category">Category</label>
              <div class="select-wrap">
                <span class="select-icon" id="tvdb-category-icon"><i class="fas fa-fire"></i></span>
                <select id="tvdb.category">
                <optgroup label="By Rating & Popularity">
                  <option value="top_rated">Top Rated</option>
                  <option value="popular">Most Popular</option>
                </optgroup>
                <optgroup label="By Date">
                  <option value="recently_updated">Recently Updated</option>
                  <option value="newest">Newest Releases</option>
                  <option value="oldest">Classic Content</option>
                </optgroup>
                <optgroup label="By Activity">
                  <option value="trending">Trending Now</option>
                  <option value="recently_added">Recently Added to TVDB</option>
                </optgroup>
                <optgroup label="Alphabetical">
                  <option value="alphabetical">A-Z Order</option>
                </optgroup>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label for="tvdb.minRating">Min Rating</label>
              <input type="number" id="tvdb.minRating" min="0" max="10" step="0.1" placeholder="e.g. 7.0">
            </div>
            <div class="form-group">
              <label for="tvdb.yearFilter">Release Years</label>
              <input type="text" id="tvdb.yearFilter" inputmode="numeric" placeholder="e.g. 1995, 1998, 2015-2025">
              
            </div>
          </div>
        </div>
      </section>
    </section>

    <!-- Operations Section (top-level sibling) -->
  <section id="section-operations" class="app-section" hidden>
    <section class="panel operations-panel">
        <header class="panel-header">
          <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; width:100%;">
            <h2 style="margin:0; display:flex; align-items:center; gap:10px;"><i class="fas fa-screwdriver-wrench"></i> Operations</h2>
            <div class="subtle" style="opacity:.8;">Maintenance, updates, and server settings</div>
          </div>
        </header>
        <div class="panel-content">
      <div class="content-grid" style="gap:12px;">
        <div class="ops-col">
            <!-- Media Operations -->
            <section class="perf-card" aria-label="Media Operations">
              <h3><i class="fas fa-sync-alt"></i> Media</h3>
              <div class="metric-row">
                <div class="subtle">Manually refresh media from configured sources.</div>
              </div>
        <div class="actions main-actions">
                <button type="button" id="btn-refresh-media" class="btn btn-success btn-sm">
                  <i class="fas fa-sync-alt"></i><span>Refresh Media</span>
                </button>
              </div>
            </section>
            <!-- Server Settings -->
            <section class="perf-card" aria-label="Server Settings">
              <h3><i class="fas fa-gear"></i> Server Settings</h3>
              <div class="metric-row">
                <div class="form-group">
                  <label for="SERVER_PORT">Port</label>
                  <input type="number" id="SERVER_PORT" min="1024" max="65535" step="1" style="width:120px;" />
                  <div class="subtle">Application port (default 4000). Changing this requires a restart.</div>
                </div>
                <div class="form-group checkbox-group">
                  <label class="checkbox" for="DEBUG">
                    <input type="checkbox" id="DEBUG" />
                    <span class="checkmark"></span>
                    <span>Enable Debug Mode</span>
                  </label>
                </div>
                <div class="subtle">Debug mode increases logging detail. Use temporarily for troubleshooting.</div>
              </div>
              <div class="actions" style="margin-top:8px;">
                <button type="button" id="btn-save-server-settings" class="btn btn-primary btn-sm">
                  <i class="fas fa-save"></i><span>Save Settings</span>
                </button>
              </div>
            </section>
        </div>
        <div class="ops-col">
            <!-- Auto-Update Operations -->
            <section class="perf-card" aria-label="Automatic Updates">
              <h3><i class="fas fa-download"></i> Automatic Updates</h3>
              <div id="ops-update-status" class="status-display">
                <div id="update-idle-state">
                  <div class="subtle">Status: <span class="status-pill status-success">Ready for Updates</span></div>
                </div>
                <div id="update-progress-state" style="display:none; margin-top:8px;">
                  <div class="update-progress-header" style="display:flex;justify-content:space-between;align-items:center;gap:8px;">
                    <span id="update-phase-text">Checking for updates…</span>
                    <span id="update-progress-percent">0%</span>
                  </div>
                  <div class="meter" style="margin-top:6px;">
                    <div id="update-progress-bar" style="width:0%; background: linear-gradient(90deg,#60a5fa,#1e40af);"></div>
                  </div>
                  <div id="update-message" class="subtle" style="margin-top:6px;">Preparing…</div>
                </div>
              </div>
              <div class="actions main-actions">
                <button type="button" id="btn-start-update" class="btn btn-success btn-sm"><i class="fas fa-download"></i><span>Start Auto-Update</span></button>
                <button type="button" id="btn-rollback-update" class="btn btn-secondary btn-sm"><i class="fas fa-undo"></i><span>Rollback</span></button>
                <button type="button" id="btn-list-backups" class="btn btn-secondary btn-sm"><i class="fas fa-archive"></i><span>View Backups</span></button>
              </div>
              <div class="actions sub-actions">
                <div class="input-row">
                  <div class="form-group" style="margin:0;">
                    <input type="number" id="input-keep-backups" min="1" max="20" value="5" style="width:90px;" />
                  </div>
                  <button type="button" id="btn-cleanup-backups" class="btn btn-secondary btn-sm"><i class="fas fa-trash"></i><span>Cleanup Old</span></button>
                </div>
              </div>
              <div id="backups-display" class="status-display" style="display:none; margin-top:10px;">
                <div class="subtle" style="display:flex; align-items:center; gap:8px;"><i class="fas fa-archive"></i> Available Backups</div>
                <div id="backups-content" class="metric-row" style="margin-top:6px;">
                  <div class="subtle">Loading…</div>
                </div>
              </div>
      </section>
      <!-- Debug & Logging -->
            <section class="perf-card" aria-label="Debug & Logging">
              <h3><i class="fas fa-bug"></i> Debug & Logging</h3>
              <div class="metric-row">
                <div class="subtle">View recent logs and monitor server activity.</div>
              </div>
              <div class="actions" style="margin-top:8px;">
                <a href="/logs.html" target="_blank" rel="noopener" class="btn btn-secondary btn-sm"><i class="fas fa-scroll"></i><span>Open Logs</span></a>
              </div>
            </section>
      <!-- Promobox Site -->
            <section class="perf-card" aria-label="Promobox Site">
              <h3><i class="fas fa-bullhorn"></i> Promobox Site</h3>
              <div class="metric-row">
                <div class="form-group checkbox-group">
                  <label class="checkbox" for="siteServer.enabled">
                    <input type="checkbox" id="siteServer.enabled" />
                    <span class="checkmark"></span>
                    <span>Enable Promobox Site</span>
                  </label>
                </div>
                <div class="form-group" id="siteServerPortGroup" style="display:none;">
                  <label for="siteServer.port">Port</label>
                  <input type="number" id="siteServer.port" min="1024" max="65535" value="4001" style="width:110px;" />
                </div>
                <div id="siteServerStatus" class="subtle" style="display:none;"></div>
              </div>
              <div class="actions" style="margin-top:8px;">
                <button type="button" id="btn-save-promobox" class="btn btn-primary btn-sm">
                  <i class="fas fa-save"></i><span>Save Promobox</span>
                </button>
              </div>
            </section>
    </div>
          </div>
        </div>
      </section>
    </section>

  <!-- Security Section -->
  <section id="section-security" class="app-section" hidden>
      <section class="panel security-panel">
        <header class="panel-header">
          <h2><i class="fas fa-shield-alt"></i> Security</h2>
        </header>
        <div class="panel-content">
          <div class="perf-columns" style="grid-template-columns: 1fr 1fr;">
            <!-- Password Management -->
            <section class="perf-card" aria-label="Password Management" style="margin-bottom: var(--space-md, 12px);">
              <h3><i class="fas fa-key"></i> Password Management</h3>
              <div class="form-grid form-single-col">
                <div class="form-group">
                  <label for="sec-current-pw">Current Password</label>
                  <input type="password" id="sec-current-pw" autocomplete="current-password" />
                </div>
                <div class="form-group">
                  <label for="sec-new-pw">New Password</label>
                  <input type="password" id="sec-new-pw" autocomplete="new-password" minlength="8" />
                </div>
                <div class="form-group">
                  <label for="sec-confirm-pw">Confirm New Password</label>
                  <input type="password" id="sec-confirm-pw" autocomplete="new-password" />
                </div>
              </div>
              <div class="actions" style="margin-top:8px;">
                <button type="button" id="btn-change-password" class="btn btn-success btn-sm">
                  <i class="fas fa-lock"></i><span>Change Password</span>
                </button>
              </div>
            </section>

            

            <!-- Two-Factor Authentication -->
            <section class="perf-card" aria-label="Two-Factor Authentication" style="margin-bottom: var(--space-md, 12px);">
              <h3><i class="fas fa-mobile-alt"></i> Two-Factor Authentication</h3>
              <div id="sec-2fa-status" class="subtle">Loading…</div>
              <div class="actions" style="margin-top:8px;">
                <button type="button" id="btn-2fa-enable" class="btn btn-secondary btn-sm"><i class="fas fa-qrcode"></i><span>Enable 2FA</span></button>
                <button type="button" id="btn-2fa-disable" class="btn btn-error btn-sm" disabled><i class="fas fa-user-lock"></i><span>Disable 2FA</span></button>
              </div>
            </section>

            <!-- API Access -->
            <section class="perf-card" aria-label="API Access Management" style="grid-column: 1 / -1;">
              <h3><i class="fas fa-code"></i> API Access</h3>
              <div class="metric-row">
                <div id="api-key-status" class="subtle">Status: <span id="api-key-status-text">Loading…</span></div>
                <div id="api-key-display" class="is-hidden">
                  <div class="form-group">
                    <label for="api-key-input">Current API Key</label>
          <div class="input-row">
                      <input id="api-key-input" type="password" readonly />
                      <button id="toggle-api-key-visibility-button" type="button" class="btn btn-icon btn-sm" title="Show/hide key"><i class="fas fa-eye"></i></button>
                      <button id="copy-api-key-button" type="button" class="btn btn-icon btn-sm" title="Copy to clipboard"><i class="fas fa-copy"></i></button>
                    </div>
                  </div>
                </div>
              </div>
              <div class="actions" style="margin-top:8px;">
        <button id="generate-api-key-button" type="button" class="btn btn-success btn-sm">
                  <i class="fas fa-key"></i>
                  <span>Generate New Key</span>
                </button>
        <button id="revoke-api-key-button" type="button" class="btn btn-error btn-sm" disabled>
                  <i class="fas fa-trash-alt"></i>
                  <span>Revoke Key</span>
                </button>
              </div>
            </section>
          </div>
        </div>
      </section>
    </section>
  </main>

  <!-- 2FA Enable Modal (theme-demo structure) -->
  <div class="modal-overlay" id="modal-2fa">
    <div class="modal modal-sm" role="dialog" aria-modal="true" aria-labelledby="modal-2fa-title">
      <div class="modal-header">
        <div class="modal-title" id="modal-2fa-title"><i class="fas fa-qrcode"></i> Enable Two-Factor Authentication</div>
        <button class="modal-close" data-close-modal aria-label="Close"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
        <div>Scan this QR code with your authenticator app, then enter the 6-digit code.</div>
        <div id="qr-code-container" style="display:flex; justify-content:center; margin: 10px 0;">
          <div class="subtle">Loading QR…</div>
        </div>
        <div class="form-group">
          <label for="input-2fa-token">Verification Code</label>
          <input id="input-2fa-token" inputmode="numeric" autocomplete="one-time-code" placeholder="123456" />
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline" data-close-modal>Cancel</button>
        <button type="button" id="btn-2fa-verify" class="btn btn-primary"><i class="fas fa-check"></i><span>Verify & Enable</span></button>
      </div>
    </div>
  </div>

  <!-- 2FA Disable Modal (theme-demo structure) -->
  <div class="modal-overlay" id="modal-2fa-disable">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-2fa-disable-title">
      <div class="modal-header">
        <div class="modal-title" id="modal-2fa-disable-title"><i class="fas fa-user-lock"></i> Disable Two-Factor Authentication</div>
        <button class="modal-close" data-close-modal aria-label="Close"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
        <div>Enter your current password to disable 2FA.</div>
        <div class="form-group">
          <label for="input-2fa-disable-password">Current Password</label>
          <input type="password" id="input-2fa-disable-password" autocomplete="current-password" />
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline" data-close-modal>Cancel</button>
        <button type="button" id="btn-2fa-disable-confirm" class="btn btn-error"><i class="fas fa-unlock"></i><span>Disable 2FA</span></button>
      </div>
    </div>
  </div>

  <!-- Revoke API Key Confirmation Modal (theme-demo structure) -->
  <div class="modal-overlay" id="modal-revoke-api-key">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-revoke-title">
      <div class="modal-header">
        <div class="modal-title" id="modal-revoke-title"><i class="fas fa-trash-alt"></i> Revoke API Key</div>
        <button class="modal-close" data-close-modal aria-label="Close"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to revoke the current API key? Any client using it will stop working immediately.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline" data-close-modal>Cancel</button>
        <button type="button" id="btn-revoke-api-key-confirm" class="btn btn-error"><i class="fas fa-trash-alt"></i><span>Revoke Key</span></button>
      </div>
    </div>
  </div>

  <!-- Update Confirmation Modal (theme-demo structure) -->
  <div class="modal-overlay" id="modal-update">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-update-title">
      <div class="modal-header">
        <div class="modal-title" id="modal-update-title"><i class="fas fa-download"></i> Confirm Auto-Update</div>
        <button class="modal-close" data-close-modal aria-label="Close"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body" id="modal-update-content">
        <div class="subtle">Loading update information…</div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline" data-close-modal>Cancel</button>
        <button type="button" id="btn-update-force" class="btn btn-warning" style="display:none;"><i class="fas fa-hammer"></i><span>Force Update</span></button>
        <button type="button" id="btn-update-confirm" class="btn btn-primary" disabled><i class="fas fa-check"></i><span>Start Update</span></button>
      </div>
    </div>
  </div>

  <script src="/notify.js"></script>
  <script src="/admin2.js"></script>
  <!-- PWA Service Worker Registration (admin2) -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js').catch(() => { /* silent */ });
      });
    }
  </script>
</body>
</html>

