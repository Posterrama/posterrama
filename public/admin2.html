<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <title>Posterrama Admin — Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="/theme-demo.css" />
  <style>
    /* Status tiles styling */
    .status-tiles { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 10px; }
    .status-tile { display: flex; align-items: center; justify-content: space-between; padding: 10px 12px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.03); }
    .status-tile .tile-left { display: flex; align-items: center; gap: 10px; }
    .status-tile .tile-title { font-weight: 600; opacity: 0.95; display: flex; align-items: center; gap: 8px; }
    .status-tile .tile-badge { font-size: 0.75rem; padding: 4px 10px; border-radius: 999px; background: rgba(255,255,255,0.08); text-transform: capitalize; }
    .tile-badge.status-success { background: rgba(34,197,94,0.15); color: #86efac; }
    .tile-badge.status-warning { background: rgba(245,158,11,0.15); color: #fcd34d; }
    .tile-badge.status-error { background: rgba(239,68,68,0.15); color: #fca5a5; }
  /* Theme alignment for dropdown links */
  .dropdown-menu a.dropdown-item { text-decoration: none; color: var(--color-text-primary); }
  .dropdown-menu a.dropdown-item:hover,
    .dropdown-menu a.dropdown-item:focus { text-decoration: none; }
  .dropdown-menu .dropdown-divider { height:1px; background: rgba(255,255,255,0.08); margin:6px 0; }
    /* Toasts – theme alignment, bottom-right placement */
  .toast-container { position: fixed; right: 16px; bottom: 16px; display: flex; flex-direction: column; gap: 8px; z-index: 3001; }
    .toast { display: flex; align-items: flex-start; gap: 10px; min-width: 260px; max-width: 360px; padding: 10px 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.08); background: rgba(20,20,28,0.95); color: var(--color-text-primary, #E5E7EB); box-shadow: 0 10px 30px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.05); opacity: 0; transform: translateY(8px); transition: opacity .18s ease, transform .18s ease; }
    .toast.show { opacity: 1; transform: translateY(0); }
    .toast .toast-icon { font-size: 1rem; line-height: 1.2; }
    .toast .toast-content { flex: 1; }
    .toast .toast-title { display:block; margin-bottom: 2px; font-weight: 600; opacity: .95; }
    .toast .toast-message { font-size: .9rem; opacity: .9; }
    .toast .toast-close { background: transparent; border: none; color: inherit; font-size: 1.1rem; cursor: pointer; opacity: .7; }
    .toast .toast-close:hover { opacity: 1; }
    .toast-info { border-left: 4px solid #60a5fa; }
    .toast-success { border-left: 4px solid #34d399; }
    .toast-warning { border-left: 4px solid #f59e0b; }
    .toast-error { border-left: 4px solid #ef4444; }
    /* Button loading spinner */
    @keyframes spin { to { transform: rotate(360deg); } }
    .spinner { display:inline-block; width:14px; height:14px; border:2px solid rgba(255,255,255,0.25); border-top-color:#60a5fa; border-radius:50%; animation:spin .8s linear infinite; margin-right:6px; vertical-align:-2px; }
    .btn .spinner { display:none; }
    .btn.btn-loading .spinner { display:inline-block; }
    .btn.btn-loading i { display:none; }
    .btn[aria-busy="true"] { cursor: progress; opacity: .85; }

  /* System Performance redesign (scoped) */
  #panel-perf-dashboard .perf-layout { display: grid; grid-template-columns: repeat(4, minmax(220px, 1fr)); gap: 16px; align-items: start; }
  @media (max-width: 1280px) { #panel-perf-dashboard .perf-layout { grid-template-columns: repeat(2, minmax(220px, 1fr)); } }
  @media (max-width: 700px) { #panel-perf-dashboard .perf-layout { grid-template-columns: 1fr; } }
  /* New unified three-column layout */
  #panel-perf-dashboard .perf-columns { display: grid; grid-template-columns: 1.25fr 1fr 1fr; gap: 16px; align-items: start; }
  @media (max-width: 1280px) { #panel-perf-dashboard .perf-columns { grid-template-columns: 1fr; } }
  @media (min-width: 1281px) and (max-width: 1500px) { #panel-perf-dashboard .perf-columns { grid-template-columns: 1.1fr 1fr 1fr; } }
  #panel-perf-dashboard .perf-card { position: relative; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08); border-radius: 14px; padding: 12px 14px; box-shadow: 0 6px 20px rgba(0,0,0,0.15), inset 0 1px 0 rgba(255,255,255,0.04); }
  #panel-perf-dashboard .perf-card h3 { margin: 0 0 10px 0; font-size: 0.95rem; opacity: 0.85; display: flex; align-items: center; gap: 8px; }
  #panel-perf-dashboard .perf-card .subtle { opacity: 0.7; font-size: 0.8rem; }
  #panel-perf-dashboard .metric-row { display: flex; flex-direction: column; gap: 10px; }
  #panel-perf-dashboard .metric-line { display: flex; justify-content: space-between; align-items: center; gap: 8px; }
  #panel-perf-dashboard .metric-label { opacity: 0.9; }
  #panel-perf-dashboard .metric-value { font-weight: 600; }
  #panel-perf-dashboard .meter { width: 100%; height: 6px; border-radius: 4px; background: rgba(255,255,255,0.06); overflow: hidden; margin-top: 6px; }
  #panel-perf-dashboard .meter > div { height: 100%; width: 0; }
  #panel-perf-dashboard .chip-list { display: grid; grid-template-columns: 1fr; gap: 10px; }
  #panel-perf-dashboard .chip { display: flex; align-items: center; justify-content: space-between; padding: 10px 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.02); box-shadow: inset 0 1px 0 rgba(255,255,255,0.04); }
  #panel-perf-dashboard .chip .left { display: flex; align-items: center; gap: 10px; }
  #panel-perf-dashboard .chip .title { font-weight: 600; opacity: 0.95; display: flex; align-items: center; gap: 8px; }
  #panel-perf-dashboard .perf-badge { font-size: 0.75rem; padding: 4px 10px; border-radius: 999px; background: rgba(255,255,255,0.08); text-transform: capitalize; }
  #panel-perf-dashboard .perf-badge.status-success { background: rgba(34,197,94,0.15); color: #86efac; }
  #panel-perf-dashboard .perf-badge.status-warning { background: rgba(245,158,11,0.15); color: #fcd34d; }
  #panel-perf-dashboard .perf-badge.status-error { background: rgba(239,68,68,0.15); color: #fca5a5; }
  #panel-perf-dashboard .status-dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; }
  #panel-perf-dashboard .status-success { background: #22c55e; }
  #panel-perf-dashboard .status-warning { background: #f59e0b; }
  #panel-perf-dashboard .status-error { background: #ef4444; }
  #panel-perf-dashboard .kpi-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
  #panel-perf-dashboard .kpi { position: relative; padding: 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.08); background: rgba(0,0,0,0.15); box-shadow: inset 0 1px 0 rgba(255,255,255,0.04); }
  #panel-perf-dashboard .kpi .kpi-title { display: flex; justify-content: space-between; align-items: center; gap: 6px; }
  #panel-perf-dashboard .kpi small { opacity: 0.7; }
  #panel-perf-dashboard .accent-left { position: absolute; left: 0; top: 0; bottom: 0; width: 4px; border-radius: 12px 0 0 12px; opacity: 0.8; }
  #panel-perf-dashboard .accent-blue { background: linear-gradient(180deg, #60a5fa, #1e40af); }
  #panel-perf-dashboard .accent-green { background: linear-gradient(180deg, #34d399, #047857); }
  #panel-perf-dashboard .accent-amber { background: linear-gradient(180deg, #fbbf24, #b45309); }
  #panel-perf-dashboard .accent-cyan { background: linear-gradient(180deg, #22d3ee, #0e7490); }
  #panel-perf-dashboard .actions { display: flex; flex-wrap: wrap; gap: 8px; align-items: center; }
  /* Sections */
  .app-section { display: none; }
  .app-section.active { display: block; }
  /* Operations panel polish (align with theme-demo) */
  .operations-panel .actions { display:flex; flex-wrap:wrap; gap:8px; align-items:center; }
  .operations-panel .main-actions { margin-top: 8px; }
  .operations-panel .sub-actions { margin-top: 8px; }
  .operations-panel .input-row { display:flex; gap:8px; align-items:center; }
  .operations-panel .status-pill { font-size: 0.8rem; padding: 4px 10px; border-radius: 999px; background: rgba(255,255,255,0.08); }
  .operations-panel .status-pill.status-success { background: rgba(34,197,94,0.15); color: #86efac; }
  /* Operations layout */
  .operations-panel .content-grid { display: grid; grid-template-columns: 1.2fr 1fr; gap: 12px; align-items: start; }
  @media (max-width: 1200px) { .operations-panel .content-grid { grid-template-columns: 1fr; } }
  .operations-panel .ops-col { display: flex; flex-direction: column; gap: 12px; }
  /* URL chip and status line */
  .operations-panel .status-line { display:flex; align-items:center; gap:8px; margin-top:6px; }
  .operations-panel .url-chip { display:inline-flex; align-items:center; gap:6px; padding:4px 10px; border-radius:999px; border:1px solid rgba(255,255,255,0.12); background: rgba(255,255,255,0.04); color: inherit; text-decoration: none; }
  .operations-panel .url-chip:hover { border-color: rgba(96,165,250,0.45); box-shadow: inset 0 1px 0 rgba(255,255,255,0.06); }
  /* Operations cards (theme aligned) */
  .operations-panel .perf-card { position: relative; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08); border-radius: 14px; padding: 12px 14px; box-shadow: 0 6px 20px rgba(0,0,0,0.15), inset 0 1px 0 rgba(255,255,255,0.04); }
  .operations-panel .perf-card h3 { margin: 0 0 10px 0; font-size: 0.95rem; opacity: 0.9; display: flex; align-items: center; gap: 8px; }
  .operations-panel .metric-row { display: flex; flex-direction: column; gap: 10px; }
  /* Update progress bar */
  #update-progress { height: 8px; border-radius: 999px; background: rgba(255,255,255,0.06); overflow: hidden; }
  #update-progress > div { height: 100%; width: 0; background: linear-gradient(90deg, #60a5fa, #2563eb); transition: width .2s ease; }
  /* Backups list styling */
  #backups-display { border-top: 1px dashed rgba(255,255,255,0.08); padding-top: 10px; }
  #backups-content { display: grid; gap: 8px; }
  #backups-content .backup-item { display:flex; justify-content:space-between; align-items:center; padding:8px 10px; border:1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.02); border-radius:10px; }
  /* Security panel polish */
  .security-panel .perf-card { background: linear-gradient(180deg, rgba(255,255,255,0.035), rgba(255,255,255,0.02)); border: 1px solid rgba(255,255,255,0.08); border-radius: 14px; padding: var(--space-lg); }
  .security-panel .perf-card h3 { margin: 0 0 12px 0; font-weight: 700; opacity: .92; display:flex; align-items:center; gap:8px; }
  .security-panel .metric-row { gap: 12px; }
  .security-panel .actions { display:flex; flex-wrap:wrap; gap:10px; align-items:center; }
  .security-panel .subtle { opacity: .8; }
  .security-panel .input-row { display:flex; gap:8px; align-items:center; }
  .security-panel .input-row .btn.btn-icon { min-width: 36px; height: 36px; display:flex; align-items:center; justify-content:center; }
  .security-panel .input-row input { flex: 1; min-width: 0; }
  .security-panel .note { font-size:.85rem; opacity:.75; }
  .security-panel .perf-columns { display:grid; grid-template-columns: 1fr 1fr; gap: var(--space-md, 12px); }
  .security-panel .perf-card + .perf-card { margin-top: 0; }
  .security-panel .perf-card { margin-bottom: 0; }
  @media (max-width: 900px) {
    .security-panel .perf-columns { grid-template-columns: 1fr !important; }
  }
  /* Single-column grid helper for stacked fields */
  .security-panel .form-grid.form-single-col { grid-template-columns: 1fr; gap: var(--space-md, 12px); }
  /* Utility */
  .is-hidden { display: none !important; }

  </style>
</head>
<body>
  <!-- Top navbar -->
  <nav class="navbar">
    <div class="nav-brand">
      <button class="btn btn-icon mobile-only" id="mobile-nav-toggle" aria-label="Toggle navigation" aria-expanded="false">
        <i class="fas fa-bars"></i>
      </button>
      <span>Posterrama</span>
  <span class="version" id="app-version" title="Current version" style="margin-left:8px;">—</span>
  <span class="nav-badge" id="update-available-pill" hidden title="" style="margin-left:6px;">Update available</span>
    </div>
    <div class="nav-actions">
      <button class="btn btn-icon" id="notif-btn" title="Notifications">
        <i class="fas fa-bell"></i>
        <span class="badge" id="notif-count" hidden>0</span>
      </button>
      <div class="dropdown" id="settings-dropdown">
        <button class="btn btn-icon dropdown-toggle" id="settings-btn" title="Settings" aria-haspopup="true" aria-expanded="false" aria-controls="settings-menu">
          <i class="fas fa-cog"></i>
        </button>
        <div class="dropdown-menu" id="settings-menu" role="menu" aria-hidden="true">
          <div class="dropdown-heading">Quick links</div>
          <a class="dropdown-item" href="/" target="_blank" rel="noopener" title="Open Posterrama in a new tab">
            <i class="fas fa-external-link-alt"></i>
            <span>View Posterrama</span>
          </a>
          <a class="dropdown-item" href="https://github.com/Posterrama/posterrama#readme" target="_blank" rel="noopener">
            <i class="fas fa-circle-question"></i>
            <span>Help</span>
          </a>
          <a class="dropdown-item" href="/api-docs" target="_blank" rel="noopener">
            <i class="fas fa-book"></i>
            <span>API Docs</span>
          </a>
          <a class="dropdown-item" href="https://github.com/Posterrama/posterrama" target="_blank" rel="noopener">
            <i class="fab fa-github"></i>
            <span>GitHub Repository</span>
          </a>
          <a class="dropdown-item" href="https://github.com/Posterrama/posterrama/issues/new/choose" target="_blank" rel="noopener">
            <i class="fas fa-bug"></i>
            <span>Report an Issue</span>
          </a>
          <div class="dropdown-divider"></div>
          <div class="dropdown-heading">Server</div>
          <a class="dropdown-item" href="#" id="menu-restart" role="button" title="Restart the Posterrama service">
            <i class="fas fa-rotate"></i>
            <span>Restart Posterrama</span>
          </a>
        </div>
      </div>
      <div class="nav-user">
        <i class="fas fa-user-circle"></i>
        <span>Admin</span>
      </div>
    </div>
  </nav>

  <!-- Sidebar -->
  <aside class="sidebar">
    <nav class="sidebar-nav">
      <a href="#" class="nav-item active" data-nav="dashboard">
        <i class="fas fa-tachometer-alt"></i>
        <span>Dashboard</span>
      </a>
      <a href="#" class="nav-item" data-nav="display">
        <i class="fas fa-desktop"></i>
        <span>Display Settings</span>
      </a>
      <div class="nav-group open">
        <a href="#" class="nav-item nav-toggle">
          <i class="fas fa-server"></i>
          <span>Media Sources</span>
          <i class="fas fa-chevron-down nav-arrow"></i>
        </a>
        <div class="nav-submenu">
          <a href="#" class="nav-subitem"><i class="fas fa-film"></i><span>Plex</span></a>
          <a href="#" class="nav-subitem"><i class="fas fa-play"></i><span>Jellyfin</span></a>
          <a href="#" class="nav-subitem"><i class="fas fa-database"></i><span>TMDB</span></a>
          <a href="#" class="nav-subitem"><i class="fas fa-tv"></i><span>TVDB</span></a>
        </div>
      </div>
      <a href="#" class="nav-item" data-nav="devices">
        <i class="fas fa-laptop"></i>
        <span class="nav-text-with-badge">
          Device Management
          <span class="nav-badge">BETA</span>
        </span>
      </a>
      <a href="#" class="nav-item" data-nav="security"><i class="fas fa-shield-alt"></i><span>Security</span></a>
      <a href="#" class="nav-item" data-nav="operations"><i class="fas fa-screwdriver-wrench"></i><span>Operations</span></a>
    </nav>
  <div class="sidebar-footer"></div>
  </aside>

  <div class="sidebar-overlay" id="sidebar-overlay" hidden></div>

  <!-- Main content -->
  <main class="main-content">
    <header class="page-header">
      <div class="page-title">
        <h1><i class="fas fa-gauge-high"></i> Dashboard</h1>
        <p>Overview of devices, media and system health</p>
      </div>
      
    </header>

  <!-- Dashboard Section -->
  <section id="section-dashboard" class="app-section active">
  <!-- KPI cards -->
  <section class="card-grid" id="kpi-cards">
      <div class="status-card status-success" title="Devices that are Online or Live">
        <div class="card-icon"><i class="fas fa-check-circle"></i></div>
        <div class="card-content">
          <h3>Active Devices</h3>
          <span class="metric" id="metric-active-devices">—</span>
          <span class="trend" id="metric-active-trend"></span>
        </div>
      </div>
      <div class="status-card status-info" title="Total media items across connected sources">
        <div class="card-icon"><i class="fas fa-images"></i></div>
        <div class="card-content">
          <h3>Media Items</h3>
          <span class="metric" id="metric-media-items">—</span>
          <span class="trend" id="metric-media-sub">from sources</span>
        </div>
      </div>
      <div class="status-card status-warning" title="Open warnings and recent errors">
        <div class="card-icon"><i class="fas fa-exclamation-triangle"></i></div>
        <div class="card-content">
          <h3>Warnings</h3>
          <span class="metric" id="metric-warnings">—</span>
          <span class="trend" id="metric-warn-sub"></span>
        </div>
      </div>
      <div class="status-card status-error" title="Devices currently Offline">
        <div class="card-icon"><i class="fas fa-times-circle"></i></div>
        <div class="card-content">
          <h3>Offline Devices</h3>
          <span class="metric" id="metric-offline-devices">—</span>
          <span class="trend negative" id="metric-offline-sub">needs attention</span>
        </div>
      </div>
    </section>

    <!-- Media Sources Section -->
    <section id="section-media-sources" class="app-section" hidden>
      <section class="panel">
        <header class="panel-header">
          <h2><i class="fas fa-database"></i> Media Sources</h2>
          <div class="panel-actions">
            <button type="button" class="btn btn-primary btn-sm" id="btn-save-sources">
              <i class="fas fa-save"></i><span>Save Sources</span>
            </button>
          </div>
        </header>
        <div class="panel-content">
          <div class="subtle">Configure Plex, Jellyfin, TMDB, and TVDB exactly like the current admin. Test connections and select libraries.</div>
        </div>
      </section>

      <!-- Plex Panel -->
      <section class="panel" id="panel-plex">
        <header class="panel-header">
          <h2><i class="fas fa-film"></i> Plex</h2>
          <div class="panel-actions">
            <button class="btn btn-icon btn-sm" id="btn-plex-test" title="Test connection"><i class="fas fa-vial"></i></button>
            <button class="btn btn-icon btn-sm" id="btn-plex-libraries" title="Fetch libraries"><i class="fas fa-list"></i></button>
          </div>
        </header>
        <div class="panel-content">
          <div class="form-grid">
            <div class="form-group">
              <label class="checkbox"><input type="checkbox" id="plex.enabled"><span class="checkmark"></span><span>Enabled</span></label>
            </div>
            <div class="form-group">
              <label for="plex.hostname">Hostname</label>
              <input type="text" id="plex.hostname" placeholder="e.g. 192.168.1.10">
            </div>
            <div class="form-group">
              <label for="plex.port">Port</label>
              <input type="number" id="plex.port" min="1" max="65535" placeholder="32400">
            </div>
            <div class="form-group">
              <label for="plex.token">Token</label>
              <input type="password" id="plex.token" placeholder="X-Plex-Token">
              <small class="form-help">Stored in environment. Not shown after save.</small>
            </div>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label for="plex.movies">Movie Libraries</label>
              <select id="plex.movies" multiple></select>
            </div>
            <div class="form-group">
              <label for="plex.shows">Show Libraries</label>
              <select id="plex.shows" multiple></select>
            </div>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label class="checkbox"><input type="checkbox" id="plex.recentOnly"><span class="checkmark"></span><span>Recently added only</span></label>
            </div>
            <div class="form-group">
              <label for="plex.recentDays">Recently added days</label>
              <input type="number" id="plex.recentDays" min="1" max="365" placeholder="30">
            </div>
            <div class="form-group">
              <label for="plex.ratingFilter">Rating filter</label>
              <input type="text" id="plex.ratingFilter" placeholder="e.g. PG-13, R">
            </div>
          </div>
        </div>
      </section>

      <!-- Jellyfin Panel -->
      <section class="panel" id="panel-jellyfin">
        <header class="panel-header">
          <h2><i class="fas fa-play"></i> Jellyfin</h2>
          <div class="panel-actions">
            <button class="btn btn-icon btn-sm" id="btn-jf-test" title="Test connection"><i class="fas fa-vial"></i></button>
            <button class="btn btn-icon btn-sm" id="btn-jf-libraries" title="Fetch libraries"><i class="fas fa-list"></i></button>
          </div>
        </header>
        <div class="panel-content">
          <div class="form-grid">
            <div class="form-group">
              <label class="checkbox"><input type="checkbox" id="jf.enabled"><span class="checkmark"></span><span>Enabled</span></label>
            </div>
            <div class="form-group">
              <label for="jf.hostname">Hostname</label>
              <input type="text" id="jf.hostname" placeholder="e.g. 192.168.1.20">
            </div>
            <div class="form-group">
              <label for="jf.port">Port</label>
              <input type="number" id="jf.port" min="1" max="65535" placeholder="8096">
            </div>
            <div class="form-group">
              <label for="jf.apikey">API Key</label>
              <input type="password" id="jf.apikey" placeholder="Jellyfin API Key">
              <small class="form-help">Stored in environment. Not shown after save.</small>
            </div>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label for="jf.movies">Movie Libraries</label>
              <select id="jf.movies" multiple></select>
            </div>
            <div class="form-group">
              <label for="jf.shows">Show Libraries</label>
              <select id="jf.shows" multiple></select>
            </div>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label class="checkbox"><input type="checkbox" id="jf.recentOnly"><span class="checkmark"></span><span>Recently added only</span></label>
            </div>
            <div class="form-group">
              <label for="jf.recentDays">Recently added days</label>
              <input type="number" id="jf.recentDays" min="1" max="365" placeholder="30">
            </div>
          </div>
        </div>
      </section>

      <!-- TMDB Panel -->
      <section class="panel" id="panel-tmdb">
        <header class="panel-header">
          <h2><i class="fas fa-database"></i> TMDB</h2>
          <div class="panel-actions">
            <button class="btn btn-icon btn-sm" id="btn-tmdb-test" title="Test connection"><i class="fas fa-vial"></i></button>
          </div>
        </header>
        <div class="panel-content">
          <div class="form-grid">
            <div class="form-group">
              <label class="checkbox"><input type="checkbox" id="tmdb.enabled"><span class="checkmark"></span><span>Enabled</span></label>
            </div>
            <div class="form-group">
              <label for="tmdb.apikey">API Key</label>
              <input type="password" id="tmdb.apikey" placeholder="TMDB API Key">
            </div>
            <div class="form-group">
              <label for="tmdb.category">Category</label>
              <select id="tmdb.category">
                <option value="popular">Popular</option>
                <option value="top_rated">Top Rated</option>
                <option value="trending">Trending</option>
              </select>
            </div>
            <div class="form-group">
              <label for="tmdb.minRating">Min Rating</label>
              <input type="number" id="tmdb.minRating" min="0" max="10" step="0.1" placeholder="0">
            </div>
          </div>
        </div>
      </section>

      <!-- TVDB Panel -->
      <section class="panel" id="panel-tvdb">
        <header class="panel-header">
          <h2><i class="fas fa-tv"></i> TVDB</h2>
          <div class="panel-actions">
            <button class="btn btn-icon btn-sm" id="btn-tvdb-test" title="Test connection"><i class="fas fa-vial"></i></button>
          </div>
        </header>
        <div class="panel-content">
          <div class="form-grid">
            <div class="form-group">
              <label class="checkbox"><input type="checkbox" id="tvdb.enabled"><span class="checkmark"></span><span>Enabled</span></label>
            </div>
            <div class="form-group">
              <label for="tvdb.category">Category</label>
              <select id="tvdb.category">
                <option value="popular">Popular</option>
                <option value="trending">Trending</option>
                <option value="top">Top</option>
              </select>
            </div>
            <div class="form-group">
              <label for="tvdb.minRating">Min Rating</label>
              <input type="number" id="tvdb.minRating" min="0" max="10" step="0.1" placeholder="0">
            </div>
          </div>
        </div>
      </section>
    </section>
    

  <section class="content-grid" style="margin-top: 16px;">
      <!-- Unified System Performance Dashboard -->
      <section class="panel" id="panel-perf-dashboard">
        <header class="panel-header">
          <h2><i class="fas fa-gauge-high"></i> System Performance</h2>
          <div class="panel-actions">
            <button class="btn btn-icon btn-sm" id="btn-perf-refresh" title="Refresh performance"><i class="fas fa-rotate"></i></button>
          </div>
        </header>
        <div class="panel-content">
          <div class="perf-columns">
            <!-- Column 1: Status + Resources unified -->
            <section class="perf-card" aria-label="System Status and Resources">
              <h3><i class="fas fa-heartbeat"></i> Status</h3>
              <div class="chip-list">
                <div class="chip" id="chip-app">
                  <div class="left">
                    <span class="status-dot status-success" id="chip-app-dot"></span>
                    <span class="title"><i class="fas fa-rocket"></i> App</span>
                  </div>
                  <span class="perf-badge" id="perf-app-status">—</span>
                </div>
                <div class="chip" id="chip-db">
                  <div class="left">
                    <span class="status-dot status-warning" id="chip-db-dot"></span>
                    <span class="title"><i class="fas fa-database"></i> Database</span>
                  </div>
                  <span class="perf-badge" id="perf-db-status">—</span>
                </div>
                <div class="chip" id="chip-cache">
                  <div class="left">
                    <span class="status-dot status-warning" id="chip-cache-dot"></span>
                    <span class="title"><i class="fas fa-bolt"></i> Cache</span>
                  </div>
                  <span class="perf-badge" id="perf-cache-status">—</span>
                </div>
              </div>
              <div style="height:8px;"></div>
              <h3><i class="fas fa-microchip"></i> Resources</h3>
              <div class="metric-row">
                <div>
                  <div class="metric-line"><span class="metric-label">CPU</span><span class="metric-value" id="perf-cpu">—</span></div>
                  <div class="meter"><div id="meter-cpu"></div></div>
                </div>
                <div>
                  <div class="metric-line"><span class="metric-label" title="System memory (OS) — same as legacy Admin > Management > Performance Monitor">System Memory</span><span class="metric-value" id="perf-mem">—</span></div>
                  <div class="meter"><div id="meter-mem"></div></div>
                </div>
                <div class="metric-line"><span class="metric-label">Disk</span><span class="metric-value" id="perf-disk">—</span></div>
                <div class="metric-line"><span class="metric-label">Uptime</span><span class="metric-value" id="perf-uptime">—</span></div>
              </div>
            </section>

            <!-- Column 2: Traffic & Reliability -->
            <section class="perf-card" aria-label="Traffic and Reliability">
              <h3><i class="fas fa-wave-square"></i> Traffic & Reliability</h3>
              <div class="kpi-grid">
                <div class="kpi" title="Requests handled by Posterrama per minute (server-wide, last 60s)">
                  <span class="accent-left accent-blue"></span>
                  <div class="kpi-title"><span>Requests</span><span id="perf-rps">—</span></div>
                  <small>per minute</small>
                </div>
                <div class="kpi" title="Average HTTP response time of Posterrama API (last hour)">
                  <span class="accent-left accent-cyan"></span>
                  <div class="kpi-title"><span>Resp. Time</span><span id="perf-rt">—</span></div>
                  <small>average</small>
                </div>
                <div class="kpi" title="Percentage van requests met HTTP status >=400 (laatste uur)">
                  <span class="accent-left accent-amber"></span>
                  <div class="kpi-title"><span>Error Rate</span><span id="perf-error-rate">—</span></div>
                  <small>last hour</small>
                </div>
                <div class="kpi" title="Cache hit rate (gemiddeld) van Posterrama responses)">
                  <span class="accent-left accent-green"></span>
                  <div class="kpi-title"><span>Cache Hit</span><span id="perf-cache-hit">—</span></div>
                  <small>overall</small>
                </div>
              </div>
            </section>

            <!-- Column 3: Cache Management -->
            <section class="perf-card" aria-label="Cache Management">
              <h3><i class="fas fa-database"></i> Cache Management</h3>
              <div class="metric-row" style="margin-bottom:8px;">
                <div>
                  <div class="metric-line"><span class="metric-label"><i class="fas fa-hdd"></i> Cache Storage</span></div>
                  <div id="cache-disk-usage" class="subtle" style="margin-top:6px;">Loading…</div>
                  <div class="meter" title="Image cache usage against max configured size" style="margin-top:8px;">
                    <div id="meter-image-cache"></div>
                  </div>
                </div>
                <div>
                  <div class="metric-line"><span class="metric-label"><i class="fas fa-memory"></i> Memory Cache</span></div>
                  <div id="cache-item-count" class="subtle" style="margin-top:6px;">Loading…</div>
                </div>
              </div>
              <div class="actions">
                <button type="button" id="cleanup-cache-button" class="btn btn-secondary btn-sm" title="Run cache cleanup">
                  <i class="fas fa-compress-alt"></i><span>Run Cleanup</span>
                </button>
                <button type="button" id="clear-cache-button" class="btn btn-primary btn-sm" title="Clear image cache from disk">
                  <i class="fas fa-broom"></i><span>Clear Cache</span>
                </button>
              </div>
            </section>
          </div>
        </div>
      </section>
    </section>
    </section> <!-- /section-dashboard -->

    <!-- Operations Section (top-level sibling) -->
  <section id="section-operations" class="app-section">
    <section class="panel operations-panel">
        <header class="panel-header">
          <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; width:100%;">
            <h2 style="margin:0; display:flex; align-items:center; gap:10px;"><i class="fas fa-screwdriver-wrench"></i> Operations</h2>
            <div class="subtle" style="opacity:.8;">Maintenance, updates, and server settings</div>
          </div>
        </header>
        <div class="panel-content">
      <div class="content-grid" style="gap:12px;">
        <div class="ops-col">
            <!-- Media Operations -->
            <section class="perf-card" aria-label="Media Operations">
              <h3><i class="fas fa-sync-alt"></i> Media</h3>
              <div class="metric-row">
                <div class="subtle">Manually refresh media from configured sources.</div>
              </div>
        <div class="actions main-actions">
                <button type="button" id="btn-refresh-media" class="btn btn-success btn-sm">
                  <i class="fas fa-sync-alt"></i><span>Refresh Media</span>
                </button>
              </div>
            </section>
            <!-- Server Settings -->
            <section class="perf-card" aria-label="Server Settings">
              <h3><i class="fas fa-gear"></i> Server Settings</h3>
              <div class="metric-row">
                <div class="form-group">
                  <label for="SERVER_PORT">Port</label>
                  <input type="number" id="SERVER_PORT" min="1024" max="65535" step="1" style="width:120px;" />
                  <div class="subtle">Application port (default 4000). Changing this requires a restart.</div>
                </div>
                <div class="form-group checkbox-group">
                  <label class="checkbox" for="DEBUG">
                    <input type="checkbox" id="DEBUG" />
                    <span class="checkmark"></span>
                    <span>Enable Debug Mode</span>
                  </label>
                </div>
                <div class="subtle">Debug mode increases logging detail. Use temporarily for troubleshooting.</div>
              </div>
              <div class="actions" style="margin-top:8px;">
                <button type="button" id="btn-save-server-settings" class="btn btn-primary btn-sm">
                  <i class="fas fa-save"></i><span>Save Settings</span>
                </button>
              </div>
            </section>
        </div>
        <div class="ops-col">
            <!-- Auto-Update Operations -->
            <section class="perf-card" aria-label="Automatic Updates">
              <h3><i class="fas fa-download"></i> Automatic Updates</h3>
              <div id="ops-update-status" class="status-display">
                <div id="update-idle-state">
                  <div class="subtle">Status: <span class="status-pill status-success">Ready for Updates</span></div>
                </div>
                <div id="update-progress-state" style="display:none; margin-top:8px;">
                  <div class="update-progress-header" style="display:flex;justify-content:space-between;align-items:center;gap:8px;">
                    <span id="update-phase-text">Checking for updates…</span>
                    <span id="update-progress-percent">0%</span>
                  </div>
                  <div class="meter" style="margin-top:6px;">
                    <div id="update-progress-bar" style="width:0%; background: linear-gradient(90deg,#60a5fa,#1e40af);"></div>
                  </div>
                  <div id="update-message" class="subtle" style="margin-top:6px;">Preparing…</div>
                </div>
              </div>
              <div class="actions main-actions">
                <button type="button" id="btn-start-update" class="btn btn-success btn-sm"><i class="fas fa-download"></i><span>Start Auto-Update</span></button>
                <button type="button" id="btn-rollback-update" class="btn btn-secondary btn-sm"><i class="fas fa-undo"></i><span>Rollback</span></button>
                <button type="button" id="btn-list-backups" class="btn btn-secondary btn-sm"><i class="fas fa-archive"></i><span>View Backups</span></button>
              </div>
              <div class="actions sub-actions">
                <div class="input-row">
                  <div class="form-group" style="margin:0;">
                    <input type="number" id="input-keep-backups" min="1" max="20" value="5" style="width:90px;" />
                  </div>
                  <button type="button" id="btn-cleanup-backups" class="btn btn-secondary btn-sm"><i class="fas fa-trash"></i><span>Cleanup Old</span></button>
                </div>
              </div>
              <div id="backups-display" class="status-display" style="display:none; margin-top:10px;">
                <div class="subtle" style="display:flex; align-items:center; gap:8px;"><i class="fas fa-archive"></i> Available Backups</div>
                <div id="backups-content" class="metric-row" style="margin-top:6px;">
                  <div class="subtle">Loading…</div>
                </div>
              </div>
      </section>
      <!-- Debug & Logging -->
            <section class="perf-card" aria-label="Debug & Logging">
              <h3><i class="fas fa-bug"></i> Debug & Logging</h3>
              <div class="metric-row">
                <div class="subtle">View recent logs and monitor server activity.</div>
              </div>
              <div class="actions" style="margin-top:8px;">
                <a href="/logs.html" target="_blank" rel="noopener" class="btn btn-secondary btn-sm"><i class="fas fa-scroll"></i><span>Open Logs</span></a>
              </div>
            </section>
      <!-- Promobox Site -->
            <section class="perf-card" aria-label="Promobox Site">
              <h3><i class="fas fa-bullhorn"></i> Promobox Site</h3>
              <div class="metric-row">
                <div class="form-group checkbox-group">
                  <label class="checkbox" for="siteServer.enabled">
                    <input type="checkbox" id="siteServer.enabled" />
                    <span class="checkmark"></span>
                    <span>Enable Promobox Site</span>
                  </label>
                </div>
                <div class="form-group" id="siteServerPortGroup" style="display:none;">
                  <label for="siteServer.port">Port</label>
                  <input type="number" id="siteServer.port" min="1024" max="65535" value="4001" style="width:110px;" />
                </div>
                <div id="siteServerStatus" class="subtle" style="display:none;"></div>
              </div>
              <div class="actions" style="margin-top:8px;">
                <button type="button" id="btn-save-promobox" class="btn btn-primary btn-sm">
                  <i class="fas fa-save"></i><span>Save Promobox</span>
                </button>
              </div>
            </section>
    </div>
          </div>
        </div>
      </section>
    </section>

    <!-- Security Section -->
    <section id="section-security" class="app-section">
      <section class="panel security-panel">
        <header class="panel-header">
          <h2><i class="fas fa-shield-alt"></i> Security</h2>
        </header>
        <div class="panel-content">
          <div class="perf-columns" style="grid-template-columns: 1fr 1fr;">
            <!-- Password Management -->
            <section class="perf-card" aria-label="Password Management" style="margin-bottom: var(--space-md, 12px);">
              <h3><i class="fas fa-key"></i> Password Management</h3>
              <div class="form-grid form-single-col">
                <div class="form-group">
                  <label for="sec-current-pw">Current Password</label>
                  <input type="password" id="sec-current-pw" autocomplete="current-password" />
                </div>
                <div class="form-group">
                  <label for="sec-new-pw">New Password</label>
                  <input type="password" id="sec-new-pw" autocomplete="new-password" minlength="8" />
                </div>
                <div class="form-group">
                  <label for="sec-confirm-pw">Confirm New Password</label>
                  <input type="password" id="sec-confirm-pw" autocomplete="new-password" />
                </div>
              </div>
              <div class="actions" style="margin-top:8px;">
                <button type="button" id="btn-change-password" class="btn btn-success btn-sm">
                  <i class="fas fa-lock"></i><span>Change Password</span>
                </button>
              </div>
            </section>

            

            <!-- Two-Factor Authentication -->
            <section class="perf-card" aria-label="Two-Factor Authentication" style="margin-bottom: var(--space-md, 12px);">
              <h3><i class="fas fa-mobile-alt"></i> Two-Factor Authentication</h3>
              <div id="sec-2fa-status" class="subtle">Loading…</div>
              <div class="actions" style="margin-top:8px;">
                <button type="button" id="btn-2fa-enable" class="btn btn-secondary btn-sm"><i class="fas fa-qrcode"></i><span>Enable 2FA</span></button>
                <button type="button" id="btn-2fa-disable" class="btn btn-error btn-sm" disabled><i class="fas fa-user-lock"></i><span>Disable 2FA</span></button>
              </div>
            </section>

            <!-- API Access -->
            <section class="perf-card" aria-label="API Access Management" style="grid-column: 1 / -1;">
              <h3><i class="fas fa-code"></i> API Access</h3>
              <div class="metric-row">
                <div id="api-key-status" class="subtle">Status: <span id="api-key-status-text">Loading…</span></div>
                <div id="api-key-display" class="is-hidden">
                  <div class="form-group">
                    <label for="api-key-input">Current API Key</label>
          <div class="input-row">
                      <input id="api-key-input" type="password" readonly />
                      <button id="toggle-api-key-visibility-button" type="button" class="btn btn-icon btn-sm" title="Show/hide key"><i class="fas fa-eye"></i></button>
                      <button id="copy-api-key-button" type="button" class="btn btn-icon btn-sm" title="Copy to clipboard"><i class="fas fa-copy"></i></button>
                    </div>
                  </div>
                </div>
              </div>
              <div class="actions" style="margin-top:8px;">
        <button id="generate-api-key-button" type="button" class="btn btn-success btn-sm">
                  <i class="fas fa-key"></i>
                  <span>Generate New Key</span>
                </button>
        <button id="revoke-api-key-button" type="button" class="btn btn-error btn-sm" disabled>
                  <i class="fas fa-trash-alt"></i>
                  <span>Revoke Key</span>
                </button>
              </div>
            </section>
          </div>
        </div>
      </section>
    </section>
  </main>

  <!-- 2FA Enable Modal (theme-demo structure) -->
  <div class="modal-overlay" id="modal-2fa">
    <div class="modal modal-sm" role="dialog" aria-modal="true" aria-labelledby="modal-2fa-title">
      <div class="modal-header">
        <div class="modal-title" id="modal-2fa-title"><i class="fas fa-qrcode"></i> Enable Two-Factor Authentication</div>
        <button class="modal-close" data-close-modal aria-label="Close"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
        <div>Scan this QR code with your authenticator app, then enter the 6-digit code.</div>
        <div id="qr-code-container" style="display:flex; justify-content:center; margin: 10px 0;">
          <div class="subtle">Loading QR…</div>
        </div>
        <div class="form-group">
          <label for="input-2fa-token">Verification Code</label>
          <input id="input-2fa-token" inputmode="numeric" autocomplete="one-time-code" placeholder="123456" />
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline" data-close-modal>Cancel</button>
        <button type="button" id="btn-2fa-verify" class="btn btn-primary"><i class="fas fa-check"></i><span>Verify & Enable</span></button>
      </div>
    </div>
  </div>

  <!-- 2FA Disable Modal (theme-demo structure) -->
  <div class="modal-overlay" id="modal-2fa-disable">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-2fa-disable-title">
      <div class="modal-header">
        <div class="modal-title" id="modal-2fa-disable-title"><i class="fas fa-user-lock"></i> Disable Two-Factor Authentication</div>
        <button class="modal-close" data-close-modal aria-label="Close"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
        <div>Enter your current password to disable 2FA.</div>
        <div class="form-group">
          <label for="input-2fa-disable-password">Current Password</label>
          <input type="password" id="input-2fa-disable-password" autocomplete="current-password" />
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline" data-close-modal>Cancel</button>
        <button type="button" id="btn-2fa-disable-confirm" class="btn btn-error"><i class="fas fa-unlock"></i><span>Disable 2FA</span></button>
      </div>
    </div>
  </div>

  <!-- Revoke API Key Confirmation Modal (theme-demo structure) -->
  <div class="modal-overlay" id="modal-revoke-api-key">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-revoke-title">
      <div class="modal-header">
        <div class="modal-title" id="modal-revoke-title"><i class="fas fa-trash-alt"></i> Revoke API Key</div>
        <button class="modal-close" data-close-modal aria-label="Close"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to revoke the current API key? Any client using it will stop working immediately.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline" data-close-modal>Cancel</button>
        <button type="button" id="btn-revoke-api-key-confirm" class="btn btn-error"><i class="fas fa-trash-alt"></i><span>Revoke Key</span></button>
      </div>
    </div>
  </div>

  <!-- Update Confirmation Modal (theme-demo structure) -->
  <div class="modal-overlay" id="modal-update">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-update-title">
      <div class="modal-header">
        <div class="modal-title" id="modal-update-title"><i class="fas fa-download"></i> Confirm Auto-Update</div>
        <button class="modal-close" data-close-modal aria-label="Close"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body" id="modal-update-content">
        <div class="subtle">Loading update information…</div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline" data-close-modal>Cancel</button>
        <button type="button" id="btn-update-force" class="btn btn-warning" style="display:none;"><i class="fas fa-hammer"></i><span>Force Update</span></button>
        <button type="button" id="btn-update-confirm" class="btn btn-primary" disabled><i class="fas fa-check"></i><span>Start Update</span></button>
      </div>
    </div>
  </div>

  <script src="/notify.js"></script>
  <script src="/admin2.js"></script>
</body>
</html>

