<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <title>Posterrama Admin — Dashboard</title>
  <!-- PWA: basic meta + manifest so admin2 independently registers the Service Worker -->
  <meta name="theme-color" content="#1a1d29" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="mobile-web-app-capable" content="yes" />
  <link rel="manifest" href="/manifest.json" />
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/icon-16x16.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/icon-32x32.png" />
  <link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png" />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />
  <link rel="stylesheet" href="/theme-demo.css?v=20250913-1" />
  <style>
  /* Themed dropdowns */
  select { 
    background: var(--color-bg-card);
    color: var(--color-text-primary);
    border: 1px solid var(--color-border);
    border-radius: 10px; 
    padding: 8px 36px 8px 10px; 
    outline: none; 
    font: inherit; 
    width: 100%;
    appearance: none; 
    -webkit-appearance: none; 
    -moz-appearance: none;
  }
  select:hover { border-color: var(--color-border-light); }
  select:focus { border-color: var(--color-info); box-shadow: 0 0 0 3px rgba(102,126,234,0.25); }
  /* Add chevron to non-multiple selects */
  select:not([multiple]) {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='%23A3AED0' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 10px center;
    background-size: 14px;
  }
  /* Wrapper to support leading icon for special selects */
  .select-wrap { position: relative; }
  .select-wrap .select-icon { position: absolute; left: 10px; top: 50%; transform: translateY(-50%); pointer-events: none; opacity: .9; }
  .select-wrap .select-icon i { color: var(--color-text-muted); }
  .select-wrap select { padding-left: 34px; }
  
  /* Cache edit button hover */
  .cache-edit-btn:hover {
    background: var(--color-bg-secondary) !important;
    border-color: var(--color-warning) !important;
    color: var(--color-warning) !important;
  }
  
  /* Subtle dropdown item hover */
  .dropdown-item:hover {
    background: rgba(255, 255, 255, 0.03) !important;
    border: none !important;
    box-shadow: none !important;
    transition: all 0.2s ease;
  }
  /* Custom select (for icon-in-list support) */
  .select-wrap.has-custom-select { position: relative; }
  .select-wrap.has-custom-select .select-icon { display: none; }
  .select-wrap select.enhanced { position: absolute; opacity: 0; pointer-events: none; width: 0; height: 0; }
  .custom-select { position: relative; width: 100%; }
  .custom-select-trigger { width: 100%; display: flex; align-items: center; justify-content: space-between; gap: 8px; padding: 8px 36px 8px 10px; border-radius: 10px; background: var(--color-bg-card); color: var(--color-text-primary); border: 1px solid var(--color-border); cursor: pointer; font: inherit; }
  .custom-select-trigger:hover { border-color: var(--color-border-light); }
  .custom-select-trigger:focus { outline: none; border-color: var(--color-info); box-shadow: 0 0 0 3px rgba(102,126,234,0.25); }
  .custom-select-trigger .left { display: inline-flex; align-items: center; gap: 8px; }
  .custom-select-trigger .caret { color: var(--color-text-muted); }
  .custom-options { position: fixed; z-index: 3002; margin-top: 0; background: var(--color-bg-card); border: 1px solid var(--color-border); border-radius: 10px; box-shadow: var(--shadow-lg); max-height: 260px; overflow: auto; padding: 6px; display: none; }
  /* visibility toggled via inline styles/js when appended to body */
  .custom-option { display: flex; align-items: center; gap: 10px; padding: 8px 10px; border-radius: 8px; cursor: pointer; }
  .custom-option:hover { background: var(--color-bg-tertiary); }
  .custom-option[aria-selected="true"] { background: var(--color-bg-tertiary); box-shadow: inset 3px 0 0 var(--color-info); }
  .custom-option i { color: var(--color-text-muted); }
  /* Sidebar nav badge error variant */
  .nav-badge.nav-badge-error {
    background: linear-gradient(135deg, var(--color-error), #f87171);
    color: #fff;
    border-color: rgba(239, 68, 68, 0.3) !important;
  }
  /* Custom select optgroup header */
  .custom-optgroup { position: sticky; top: 0; background: var(--color-bg-card); color: var(--color-text-muted); font-size: 0.78rem; letter-spacing: .02em; text-transform: none; padding: 6px 10px; margin: 4px 0 2px; opacity: .9; }
  @media (prefers-reduced-motion: no-preference) {
    .custom-options { transition: opacity .12s ease, transform .12s ease; }
    .custom-select.open .custom-options { opacity: 1; transform: translateY(0); }
  }
  /* Pairing modal layout */
  #modal-pairing .modal-body { padding-top: 12px; }
  /* Pairing modal fade-out and success state */
  #modal-pairing.fade-out { opacity: 0; transition: opacity 600ms ease; }
  .pairing-success { display:flex; align-items:center; justify-content:center; gap:10px; font-weight:700; color: var(--color-success, #22c55e); padding: 24px 8px; }
  .pairing-success i { color: var(--color-success, #22c55e); font-size: 20px; }
  .pairing-success span { font-size: 1rem; }
  /* Name bar shown at top of modal content when a single device is paired */
  .pairing-namebar { display:flex; align-items:center; gap:10px; padding:10px 12px; border:1px solid var(--color-border); background: rgba(255,255,255,0.03); border-radius: 12px; font-weight: 700; margin-bottom: 10px; }
  .pairing-namebar i { color: var(--color-text-muted); }
  .pairing-item { display: flex; align-items: center; justify-content: space-between; gap: 16px; padding: 12px 14px; border-radius: 14px; border: 1px solid var(--color-border); background: rgba(255,255,255,0.03); }
  .pairing-meta { flex: 1; min-width: 0; }
  /* Header: device name + pills on one line (wraps gracefully) */
  .pairing-header { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; margin-bottom: 8px; }
  .pairing-name { font-weight: 800; font-size: 1.05rem; letter-spacing: .01em; }
  .pairing-row { display: flex; align-items: center; gap: 10px; margin: 6px 0; }
  .pairing-label { width: 96px; color: var(--color-text-muted); flex: 0 0 auto; }
  .pairing-copy { display: flex; align-items: center; gap: 8px; flex: 1; min-width: 0; }
  /* Align values and copy buttons to a clean right edge */
  .pairing-copy .btn { margin-left: auto; min-width: 84px; }
  .pairing-code, .pairing-input { height: 36px; display: flex; align-items: center; }
  .pairing-code { flex: 1; background: rgba(255,255,255,0.06); padding: 4px 8px; border-radius: 8px; border: 1px solid var(--color-border); font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-weight: 600; font-size: .9rem; letter-spacing: .02em; user-select: none; -webkit-user-select: none; }
  .pairing-code.pairing-url { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; cursor: default; font-family: var(--font-sans, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"); font-weight: 500; letter-spacing: 0; font-size: .9rem; }
  .pairing-input { flex: 1; width: 100%; padding: 6px 8px; border-radius: 8px; border: 1px solid var(--color-border); background: rgba(255,255,255,0.06); color: var(--color-text-primary); }
  .pairing-input:focus { outline: none; border-color: var(--color-info); box-shadow: 0 0 0 3px rgba(102,126,234,0.25); }
  .pairing-exp { margin-top: 6px; opacity: .85; }
  /* QR removed per UX: keep modal focused on code + claim URL */
  .pill { display:inline-flex; align-items:center; gap:6px; padding:4px 10px; border-radius:999px; border:1px solid var(--color-border); background: rgba(255,255,255,0.04); font-size: .85rem; }
  .pill i { color: var(--color-text-muted); }
  /* Footer layout: expiry left, Close right */
  .pairing-footer { display:flex; align-items:center; justify-content: space-between; }
    /* Status tiles styling */
    .status-tiles { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 10px; }
    .status-tile { display: flex; align-items: center; justify-content: space-between; padding: 10px 12px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.03); }
    .status-tile .tile-left { display: flex; align-items: center; gap: 10px; }
    .status-tile .tile-title { font-weight: 600; opacity: 0.95; display: flex; align-items: center; gap: 8px; }
    .status-tile .tile-badge { font-size: 0.75rem; padding: 4px 10px; border-radius: 999px; background: rgba(255,255,255,0.08); text-transform: capitalize; }
    .tile-badge.status-success { background: rgba(34,197,94,0.15); color: #86efac; }
    .tile-badge.status-warning { background: rgba(245,158,11,0.15); color: #fcd34d; }
    .tile-badge.status-error { background: rgba(239,68,68,0.15); color: #fca5a5; }
  /* Theme alignment for dropdown links */
  .dropdown-menu a.dropdown-item { text-decoration: none; color: var(--color-text-primary); }
  .dropdown-menu a.dropdown-item:hover,
    .dropdown-menu a.dropdown-item:focus { text-decoration: none; }
  .dropdown-menu .dropdown-divider { height:1px; background: rgba(255,255,255,0.08); margin:6px 0; }
  
  /* Modern Dropdown Menu Styling */
  .dropdown-menu {
    position: absolute !important;
    top: calc(100% + 4px) !important; /* Default gap; navbar menus override below */
    min-width: 240px !important;
    max-width: 280px !important;
    padding: 8px !important;
    margin: 0 !important;
    z-index: 2000 !important;
    display: block !important; /* Override any display: none */
    
    /* Modern glassmorphism design using theme colors */
    background: linear-gradient(135deg, 
      var(--color-bg-card) 0%,
      var(--color-bg-tertiary) 50%,
      var(--color-bg-card) 100%) !important;
    backdrop-filter: blur(20px) !important;
    -webkit-backdrop-filter: blur(20px) !important;
    
    border: 1px solid var(--color-border) !important;
    border-radius: var(--border-radius-lg) !important;
    
    box-shadow: var(--shadow-lg) !important;
    
    /* Animation */
    opacity: 0 !important;
    transform: translateY(-8px) scale(0.98) !important;
    transition: all 0.2s cubic-bezier(0.16, 1, 0.3, 1) !important;
    pointer-events: none !important;
  }
  /* Disable hover bridges; menus are click-open, JS-managed */
  #settings-menu::before,
  #user-menu::before { content: none !important; }
  /* Remove arrow/anchor notch above dropdowns */
  #settings-menu::after, #user-menu::after,
  .dropdown.dropdown-left .dropdown-menu::after,
  .dropdown.dropdown-right .dropdown-menu::after {
    content: none !important;
  }
  
  .dropdown-menu.show {
    opacity: 1 !important;
    transform: translateY(0) scale(1) !important;
    pointer-events: auto !important;
  }
  /* Device toolbar dropdowns: toggle visibility via parent .open */
  #section-devices .dropdown.open > .dropdown-menu {
    opacity: 1 !important;
    transform: translateY(0) scale(1) !important;
    pointer-events: auto !important;
  }
  /* Anchor toolbar dropdown menus to their trigger container */
  #section-devices .device-toolbar .dropdown { position: relative; }
  /* Active state for selected filter items */
  #section-devices .dropdown-menu .dropdown-item.active {
    background: rgba(0,0,0,0.18) !important;
    border-color: rgba(0,0,0,0.7) !important;
  }
  /* Device Management: responsive card grid and header text */
  #section-devices .device-grid { grid-template-columns: repeat(auto-fit, minmax(340px, 1fr)); gap: var(--space-lg); }
  #section-devices .device-card-header { grid-template-columns: auto 1fr auto; align-items: center; gap: var(--space-md); }
  #section-devices .device-title { min-width: 0; }
  #section-devices .device-title .name-row { min-width: 0; }
  #section-devices .device-title .name { display: inline-block; max-width: 100%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
  #section-devices .device-title .meta { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
  /* Device tools: allow wrapping to avoid clipping; JS still collapses to kebab only when truly needed */
  #section-devices .device-tools { display: flex; align-items: center; gap: 8px; padding: 8px var(--space-lg) 0 var(--space-lg); flex-wrap: wrap; overflow: visible; row-gap: 6px; }
  @media (max-width: 600px) { #section-devices .device-tools .card-more { order: 99; margin-left: 0; } }
  #section-devices .device-tools .btn { flex: 0 0 auto; min-width: 32px; }
  #section-devices .device-tools .card-more { margin-left: auto; }
  @media (max-width: 1400px) {
    #section-devices .device-tools { gap: 6px; }
  }
  /* No CSS hover-open; JS controls visibility */

  /* KPI cards: only the metric number is interactive (not the whole card) */
  #kpi-cards .status-card { cursor: default; }
  #kpi-cards .status-card .metric {
    display: inline-block; /* click target shrinks to number width */
    cursor: pointer;
    pointer-events: auto;
    margin-bottom: var(--space-xs);
  }
  /* Disable clicks on other parts of the KPI card */
  #kpi-cards .status-card .card-icon,
  #kpi-cards .status-card h3,
  #kpi-cards .status-card .trend {
    pointer-events: none;
  }
  /* Ensure the subtext (trend) stays below the number */
  #kpi-cards .status-card .trend { display: block; }

  /* Trigger buttons: modern hover/active visuals */
  .nav-actions .dropdown .btn.btn-icon {
    border: 1px solid transparent;
    border-radius: 10px;
    background: transparent;
    transition: background .2s ease, border-color .2s ease, box-shadow .2s ease, transform .12s ease;
  }
  .nav-actions .dropdown .btn.btn-icon:focus-visible {
    outline: none;
  }
  /* (removed empty rules for aria-expanded and icon hover to keep CSS tidy) */
  /* Settings and user buttons: no hover visuals; keep base transparent style */
  #settings-btn.btn.btn-icon,
  #user-btn.btn.btn-icon {
    border: 1px solid transparent;
    border-radius: 10px;
    background: transparent;
  }
  /* Fix: user button shouldn’t be a square when it has text; keep within navbar height */
  .nav-user .btn.btn-icon,
  #user-btn.btn.btn-icon {
    aspect-ratio: auto !important;
    height: auto !important;
    max-height: calc(var(--navbar-height) - 12px) !important;
    padding: 8px 10px !important;
    line-height: 1 !important;
    align-self: center !important;
  }
  
  /* Settings menu positioning is handled via JS to avoid viewport overflow */
  /* Limit dropdown container size to its contents (avoid oversized hitbox) */
  .nav-actions .dropdown,
  #user-dropdown.dropdown.nav-user {
    display: inline-flex !important;
    align-items: center !important;
    height: var(--navbar-height) !important;
  }
  
  /* User menu (right) positioning - MORE SPECIFIC */
  #user-dropdown #user-menu,
  #user-menu {
    right: 12px !important;
    left: auto !important;
    transform-origin: right top !important;
  }
  /* Play/Pause stateful styling: make paused state yellow per theme */
  #section-devices .device-card .btn-playpause.is-paused i {
    color: var(--color-warning) !important;
  }
  #section-devices .device-card .btn-playpause.is-playing i {
  color: var(--color-text-muted) !important;
  }
  /* Utility classes for explicit dropdown alignment */
  .dropdown.dropdown-left .dropdown-menu {
    left: 0 !important;
    right: auto !important;
    transform-origin: left top !important;
  }
  .dropdown.dropdown-right .dropdown-menu {
    right: 0 !important;
    left: auto !important;
    transform-origin: right top !important;
  }
  .dropdown.dropdown-left .dropdown-menu::after {
    left: 22px !important;
    right: auto !important;
  }
  .dropdown.dropdown-right .dropdown-menu::after {
    right: 22px !important;
    left: auto !important;
  }
  
  /* (removed forced-left rules; JS sets left/right per available space) */
  
  /* Force user menu to right with extreme specificity */  
  body .dropdown #user-menu,
  body #user-dropdown #user-menu,
  body .dropdown-menu.dropdown-right#user-menu,
  body #user-dropdown .dropdown-menu.dropdown-right#user-menu {
  right: 0 !important;
    left: auto !important;
  margin-top: 0 !important;
    margin-right: 0 !important;
  /* Align user menu height with navbar buttons by compensating for the inner shift */
  top: calc(100% - var(--navbar-inner-shift) + 4px) !important; /* nudged a bit lower for consistent spacing */
    position: absolute !important;
  }

  /* Ensure Notifications and Settings dropdowns match the same vertical offset as the User menu */
  /* Notifications & Settings: align with user menu */
  .navbar .nav-actions #notif-dropdown > .dropdown-menu,
  .navbar .nav-actions #settings-dropdown > .dropdown-menu {
    top: calc(100% - var(--navbar-inner-shift) + 4px) !important;
  }
  
  /* Dropdown items */
  .dropdown-menu .dropdown-item {
    display: flex !important;
    align-items: center !important;
    gap: 12px !important;
    padding: 12px 14px !important;
    margin: 2px 0 !important;
    border-radius: var(--border-radius-md) !important;
    color: var(--color-text-primary) !important;
    text-decoration: none !important;
    font-size: 14px !important;
    font-weight: 500 !important;
    border: 1px solid transparent !important;
    transition: all 0.15s ease !important;
    position: relative !important;
    overflow: hidden !important;
  }
  
  .dropdown-menu .dropdown-item:before {
    content: '' !important;
    position: absolute !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    background: linear-gradient(135deg, 
      rgba(255, 255, 255, 0.03) 0%,
      rgba(255, 255, 255, 0.06) 50%,
      rgba(255, 255, 255, 0.03) 100%) !important;
    opacity: 0 !important;
    transition: opacity 0.15s ease !important;
    z-index: -1 !important;
  }
  
  .dropdown-menu .dropdown-item:hover:before { opacity: 0 !important; }
  
  .dropdown-menu .dropdown-item:hover {
    background: rgba(0,0,0,0.18) !important;
    border-color: rgba(0,0,0,0.7) !important;
    transform: none !important;
    box-shadow: none !important;
    transition: background .12s ease, border-color .12s ease !important;
  }
  
  .dropdown-menu .dropdown-item i {
    width: 18px !important;
    height: 18px !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    font-size: 14px !important;
    opacity: 0.8 !important;
    color: var(--color-text-secondary) !important;
    will-change: transform !important;
    transition: transform .12s ease, color .12s ease, opacity .12s ease !important;
  }
  
  .dropdown-menu .dropdown-item:hover i {
    opacity: 1 !important;
    color: var(--color-text-primary) !important;
    transform: translateY(-1px) scale(1.06) !important;
    transition: transform .12s ease, color .12s ease, opacity .12s ease !important;
  }
  /* Keyboard focus parity */
  .dropdown-menu .dropdown-item:focus-visible i {
    opacity: 1 !important;
    color: var(--color-text-primary) !important;
    transform: translateY(-1px) scale(1.06) !important;
  }
  /* Respect reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .dropdown-menu .dropdown-item i { transition: none !important; }
    .dropdown-menu .dropdown-item:hover i,
    .dropdown-menu .dropdown-item:focus-visible i { transform: none !important; }
  }
  /* Clean hover without accents/shadows */
  .dropdown-menu .dropdown-item:hover { box-shadow: none !important; }
  
  /* Special styling for danger items */
  .dropdown-menu .dropdown-item.text-danger:hover {
    background: rgba(239, 68, 68, 0.1) !important;
    border-color: rgba(239, 68, 68, 0.2) !important;
    color: #fca5a5 !important;
  }
  
  /* Dropdown divider */
  .dropdown-menu .dropdown-divider {
    height: 1px !important;
    background: linear-gradient(90deg, 
      transparent 0%,
      var(--color-border) 20%,
      var(--color-border-hover) 50%,
      var(--color-border) 80%,
      transparent 100%) !important;
    margin: 8px 6px !important;
    border: none !important;
  }
  
  /* Dropdown heading */
  .dropdown-menu .dropdown-heading {
    font-size: 12px !important;
    font-weight: 600 !important;
    color: var(--color-text-secondary) !important;
    text-transform: uppercase !important;
    letter-spacing: 0.5px !important;
    padding: 8px 14px 4px !important;
    margin-bottom: 4px !important;
  }

  
  /* Dropdown items */
  .dropdown-menu .dropdown-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 14px;
    margin: 2px 0;
    border-radius: 12px;
    color: var(--color-text-primary);
    text-decoration: none;
    font-size: 14px;
    font-weight: 500;
    border: 1px solid transparent;
    transition: all 0.15s ease;
    position: relative;
    overflow: hidden;
  }
  
  .dropdown-menu .dropdown-item:before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, 
      rgba(255, 255, 255, 0.03) 0%,
      rgba(255, 255, 255, 0.06) 50%,
      rgba(255, 255, 255, 0.03) 100%);
    opacity: 0;
    transition: opacity 0.15s ease;
    z-index: -1;
  }
  
  /* (removed duplicate legacy hover rules to avoid conflicts) */
  
  /* Special styling for danger items */
  .dropdown-menu .dropdown-item.text-danger:hover {
    background: linear-gradient(135deg, rgba(239, 68, 68, 0.08), rgba(239, 68, 68, 0.05));
    border-color: rgba(239, 68, 68, 0.15);
    color: #fca5a5;
    box-shadow: 0 0 20px rgba(239, 68, 68, 0.05);
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  /* Dropdown divider */
  .dropdown-menu .dropdown-divider {
    height: 1px;
    background: linear-gradient(90deg, 
      transparent 0%,
      rgba(255, 255, 255, 0.08) 20%,
      rgba(255, 255, 255, 0.12) 50%,
      rgba(255, 255, 255, 0.08) 80%,
      transparent 100%);
    margin: 8px 6px;
    border: none;
  }
  /* Notification layers: keep above dropdowns/modals to ensure visibility */
  .notify-center { z-index: 3003; }
  .toast-container { z-index: 11000; }
  .notification-container { z-index: 11000; }
    /* Toasts – theme alignment, bottom-right placement */
  .toast-container { position: fixed; right: 16px; bottom: 16px; display: flex; flex-direction: column; gap: 8px; z-index: 11000; }
    .toast { display: flex; align-items: flex-start; gap: 10px; min-width: 260px; max-width: 360px; padding: 10px 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.08); background: rgba(20,20,28,0.95); color: var(--color-text-primary, #E5E7EB); box-shadow: 0 10px 30px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.05); opacity: 0; transform: translateY(8px); transition: opacity .18s ease, transform .18s ease; }
    .toast.show { opacity: 1; transform: translateY(0); }
    .toast .toast-icon { font-size: 1rem; line-height: 1.2; }
    .toast .toast-content { flex: 1; }
    .toast .toast-title { display:block; margin-bottom: 2px; font-weight: 600; opacity: .95; }
    .toast .toast-message { font-size: .9rem; opacity: .9; }
    .toast .toast-close { background: transparent; border: none; color: inherit; font-size: 1.1rem; cursor: pointer; opacity: .7; }
    .toast .toast-close:hover { opacity: 1; }
    .toast-info { border-left: 4px solid #60a5fa; }
    .toast-success { border-left: 4px solid #34d399; }
    .toast-warning { border-left: 4px solid #f59e0b; }
    .toast-error { border-left: 4px solid #ef4444; }
    /* Button loading spinner */
    @keyframes spin { to { transform: rotate(360deg); } }
    .spinner { display:inline-block; width:14px; height:14px; border:2px solid rgba(255,255,255,0.25); border-top-color:#60a5fa; border-radius:50%; animation:spin .8s linear infinite; margin-right:6px; vertical-align:-2px; }
    .btn .spinner { display:none; }
    .btn.btn-loading .spinner { display:inline-block; }
    .btn.btn-loading i { display:none; }
    /* Prevent header shift when icon buttons show spinner */
    .panel-actions .btn.btn-icon.btn-sm {
      width: 32px;
      min-width: 32px;
      height: 32px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    .panel-actions .btn.btn-icon .spinner { margin-right: 0; }
    .btn[aria-busy="true"] { cursor: progress; opacity: .85; }

    /* Device toolbar icon animations */
    /* One-time quick spin for reload icon */
    #section-devices .device-tools .btn-reload i.icon-spin-once { display:inline-block; animation: spin .6s linear 1; }
    /* Broom sweep animation */
    @keyframes broom-sweep { 0% { transform: rotate(0deg) translateX(0); } 25% { transform: rotate(-14deg) translateX(2px); } 50% { transform: rotate(14deg) translateX(-2px); } 75% { transform: rotate(-10deg) translateX(1px); } 100% { transform: rotate(0deg) translateX(0); } }
    #section-devices .device-tools .btn-clearcache i.broom-sweep { display:inline-block; transform-origin: 50% 70%; animation: broom-sweep .8s ease-in-out 1; }

  /* Pinned state for Pin button: only icon turns magenta (strong specificity) */
  #section-devices .device-card .device-tools .btn-pin.is-pinned > i { color: #ff00a7 !important; }
  /* Powered-off state for Power button: only icon turns magenta (same as pin) */
  #section-devices .device-card .device-tools .btn-power.is-off > i { color: #ff00a7 !important; }

  /* Synced indicator: top-right pulsing green dot with tooltip */
  #section-devices .device-card { position: relative; }
  /* Device list footer (pagination) styled like the cards above */
  #device-ui .table-footer.device-pagination {
    background: linear-gradient(135deg, var(--color-bg-card), var(--color-bg-tertiary));
    border: 1px solid var(--color-border);
    border-radius: var(--border-radius-lg);
    box-shadow: var(--shadow-md);
    padding: 14px 16px;
    margin-top: var(--space-lg);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-md);
  }
  #device-ui .table-footer.device-pagination .table-info {
    color: var(--color-text-secondary);
    font-size: 0.9rem;
  }
  #device-ui .table-footer.device-pagination .pagination {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
  }
  #device-ui .table-footer.device-pagination .pagination .btn:disabled {
    opacity: .5;
    cursor: not-allowed;
  }
  #device-ui .table-footer.device-pagination .per-page select {
    background: var(--color-bg-card);
    border-color: var(--color-border);
    color: var(--color-text-primary);
    border-radius: var(--border-radius-md);
    padding: 6px 10px;
  }
  /* Wrap nicely on small widths */
  @media (max-width: 640px) {
    #device-ui .table-footer.device-pagination {
      flex-wrap: wrap;
      row-gap: 8px;
    }
    #device-ui .table-footer.device-pagination .pagination { margin-left: auto; }
  }
  #section-devices .device-card .device-corner { position: absolute; top: 10px; right: 10px; z-index: 2; pointer-events: auto; }
  #section-devices .device-card .device-corner .synced-dot {
    width: 10px; height: 10px; display: inline-block; border-radius: 50%;
    background: #22c55e; box-shadow: 0 0 0 0 rgba(34,197,94,0.6);
    position: relative;
  }
  @keyframes pulse-green { 0% { box-shadow: 0 0 0 0 rgba(34,197,94,0.6); } 70% { box-shadow: 0 0 0 8px rgba(34,197,94,0); } 100% { box-shadow: 0 0 0 0 rgba(34,197,94,0); } }
  @media (prefers-reduced-motion: no-preference) {
    #section-devices .device-card .device-corner .synced-dot { animation: pulse-green 1.8s ease-out infinite; }
  }

  /* Live status pill: match Display Settings Mode pill design (Wallart/Cinema style) */
  #section-devices .device-badges .status-pill.status-live {
    background: linear-gradient(90deg, rgba(16,185,129,0.32), rgba(59,130,246,0.24)) !important;
    color: #ecfdf5 !important;
    border: 1px solid rgba(16,185,129,0.65) !important;
    box-shadow: 0 0 0 3px rgba(16,185,129,0.14), 0 10px 28px rgba(16,185,129,0.35) !important;
    font-weight: 800 !important;
    position: relative;
    overflow: visible;
  }
  #section-devices .device-badges .status-pill.status-live i { color: inherit !important; }

  /* Powered off pill (red variant) */
  #section-devices .device-badges .status-pill.sp-poweredoff {
    background: rgba(239,68,68,0.12);
    border: 1px solid rgba(239,68,68,0.35);
    color: #fca5a5;
  }
  #section-devices .device-badges .status-pill.sp-poweredoff i { color: #fca5a5; }

  /* Status change flash animation (applies to any status when it changes) */
  #section-devices .device-badges .status-pill { --status-flash: rgba(99,102,241,0.28); }
  #section-devices .device-badges .status-pill.status-live { --status-flash: rgba(34,197,94,0.30); }
  #section-devices .device-badges .status-pill.status-online { --status-flash: rgba(59,130,246,0.32); }
  #section-devices .device-badges .status-pill.status-unknown { --status-flash: rgba(245,158,11,0.32); }
  #section-devices .device-badges .status-pill.status-offline { --status-flash: rgba(239,68,68,0.32); }
  @keyframes status-flip-kf {
    0% { transform: scale(0.98); box-shadow: 0 0 0 0 var(--status-flash); }
    55% { transform: scale(1.04); box-shadow: 0 0 0 8px color-mix(in srgb, var(--status-flash) 60%, transparent); }
    100% { transform: scale(1); box-shadow: 0 0 0 0 transparent; }
  }
  @media (prefers-reduced-motion: no-preference) {
    #section-devices .device-badges .status-pill.status-flip { animation: status-flip-kf 420ms ease-out; }
  }

    /* Hovercard — modern floating panel */
    .hovercard {
      position: absolute;
      top: 0;
      left: 0;
      z-index: 1700;
      display: block; /* keep in flow so offsetWidth is measurable */
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
      transform: translateY(4px);
      transition: opacity .16s ease, transform .16s ease, visibility .16s ease;
      min-width: 300px;
      max-width: 460px;
      padding: 12px 12px 10px 12px;
      border-radius: 12px;
      border: 1px solid var(--color-border, rgba(255,255,255,0.12));
      background: linear-gradient(135deg, var(--color-bg-card, #12141a), var(--color-bg-tertiary, #0f1117));
      box-shadow: 0 12px 32px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.04);
      color: var(--color-text-primary, #E5E7EB);
      font-size: 0.88rem;
    }
    .hovercard.open { opacity: 1; visibility: visible; pointer-events: auto; transform: translateY(0); z-index: 1700; }
    .hovercard .hc-title { font-weight: 400; font-size: .88rem; margin: 0 0 8px 0; padding-bottom: 8px; border-bottom: 1px solid var(--color-border, rgba(255,255,255,0.08)); opacity: .95; display:flex; align-items:center; gap:8px; }
    .hovercard .hc-title .status-dot { width:8px; height:8px; border-radius:50%; display:inline-block; }
    .hovercard .hc-title .sd-live { background: var(--color-success, #22c55e); box-shadow:0 0 0 3px color-mix(in srgb, var(--color-success, #22c55e) 25%, transparent); }
    .hovercard .hc-title .sd-online { background: var(--color-info, #60a5fa); box-shadow:0 0 0 3px color-mix(in srgb, var(--color-info, #60a5fa) 25%, transparent); }
    .hovercard .hc-title .sd-unknown { background: var(--color-warning, #f59e0b); box-shadow:0 0 0 3px color-mix(in srgb, var(--color-warning, #f59e0b) 25%, transparent); }
    .hovercard .hc-title .sd-offline { background: var(--color-error, #ef4444); box-shadow:0 0 0 3px color-mix(in srgb, var(--color-error, #ef4444) 25%, transparent); }
  /* Powered off (live but blacked out) — magenta like pin */
  .hovercard .hc-title .sd-poweredoff { background: #ff00a7; box-shadow: 0 0 0 3px color-mix(in srgb, #ff00a7 25%, transparent); }
    .hovercard .hc-list { display:flex; flex-direction:column; gap:0; margin-bottom:8px; }
    .hovercard .hc-row { display:grid; grid-template-columns: 18px var(--hc-label-w, 130px) 1fr; gap:10px; align-items:center; padding:9px 0; }
    /* Ensure labels take consistent width and don’t push values */
    .hovercard .hc-row > span:nth-child(2) {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      color: var(--color-text-secondary, #A3AED0);
    }
    .hovercard .hc-row + .hc-row { border-top: 1px solid var(--color-border, rgba(255,255,255,0.08)); }
    .hovercard .hc-row:not(:first-child) { border-top: 1px solid var(--color-border, rgba(255,255,255,0.08)); }
    .hovercard .hc-row i { opacity: .88; color: var(--color-text-primary, #E5E7EB); }
    .hovercard .hc-row .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; opacity:.96; font-size: .88rem; }
    .hovercard .hc-row .dim { opacity: .78; color: var(--color-text-muted, #9CA3AF); }
    .hovercard .hc-row .value { justify-self: start; text-align: left; font-weight: 400; color: var(--color-text-primary, #E5E7EB); }
    .hovercard .hc-row.hc-ua .value { justify-self: start; text-align: left; font-weight: 400; }
    .hovercard .hc-row .value, .hovercard .hc-row .mono { word-break: break-word; overflow-wrap: anywhere; }
    /* Fallback: if .value is missing, last cell still left-aligns */
    .hovercard .hc-row > :nth-child(3) { justify-self: start; text-align: left; }
    .hovercard .hc-actions { display:flex; gap:8px; justify-content:flex-end; }
    .hovercard .hc-actions .btn { padding: 4px 8px; font-size: .8rem; }

  /* MODERN DASHBOARD - inspired by the screenshot */
  #panel-perf-dashboard {
    background: linear-gradient(135deg, var(--color-bg-card), var(--color-bg-tertiary)) !important;
    border: 1px solid var(--color-border) !important;
    border-radius: var(--border-radius-lg) !important;
    box-shadow: var(--shadow-md) !important;
  }
  
  #panel-perf-dashboard .panel-header {
    background: linear-gradient(135deg, var(--color-bg-tertiary), var(--color-bg-card)) !important;
    border-bottom: 1px solid var(--color-border) !important;
    border-radius: 12px 12px 0 0 !important;
    padding: 20px 24px !important;
  }
  
  #panel-perf-dashboard .panel-header h2 {
    color: var(--color-text-primary) !important;
    font-weight: 600 !important;
    font-size: 1.25rem !important;
    margin: 0 !important;
    display: flex !important;
    align-items: center !important;
    gap: 12px !important;
  }
  
  #panel-perf-dashboard .panel-header h2 i {
    color: var(--color-text-primary) !important;
  }
  
  /* Button hover effects */
  #panel-perf-dashboard button:hover {
    opacity: 0.8 !important;
    transform: translateY(-1px) !important;
    transition: all 0.2s ease !important;
  }
  
  #panel-perf-dashboard .btn-icon:hover {
    background: #e5e7eb !important;
  }
  /* Sections: visible by default; hide only when [hidden] is set */
  .app-section { display: block; }
  .app-section[hidden] { display: none !important; }
  /* Safety: ensure Plex panel content is visible */
  #panel-plex .panel-content { display: block !important; visibility: visible !important; }
  /* Consistent inner padding for Media Sources panels (Plex/Jellyfin/TMDB/TVDB) */
  #section-media-sources .panel > .panel-content { padding: 16px 20px; }
  /* Lightweight sub-section groupings inside panels */
  .form-section { margin: 14px 0 8px; }
  .form-section .section-title { display:flex; align-items:center; gap:8px; margin: 6px 0 10px; padding-left: 10px; border-left: 3px solid var(--color-border); color: var(--color-text-primary); font-size: 1rem; font-weight: 600; opacity: .95; }
  .form-section .section-title i { color: var(--color-text-secondary); }
  /* Operations panel polish (align with theme-demo) */
  /* Ensure Operations panel uses the same panel background as theme-demo */
  .operations-panel {
    background: linear-gradient(135deg, var(--color-bg-card), var(--color-bg-tertiary)) !important;
    border: 1px solid var(--color-border) !important;
    border-radius: var(--border-radius-lg) !important;
    box-shadow: var(--shadow-md) !important;
  }
  .operations-panel > .panel-header {
    background: linear-gradient(135deg, var(--color-bg-tertiary), var(--color-bg-card)) !important;
    border-bottom: 1px solid var(--color-border) !important;
  }
  /* Operations grouping */
  .ops-group { margin: 6px 0 10px; padding: 0; }
  .ops-group-title { display:flex; align-items:center; gap:8px; margin: 8px 0 10px; padding-left: 10px; border-left: 3px solid var(--color-border); color: var(--color-text-primary); font-size: 0.95rem; font-weight: 700; letter-spacing: .01em; opacity:.95; }
  .ops-group-title i { color: var(--color-text-secondary); }
  .operations-panel .actions { display:flex; flex-wrap:wrap; gap:8px; align-items:center; }
  .operations-panel .main-actions { margin-top: 8px; }
  .operations-panel .sub-actions { margin-top: 8px; }
  .operations-panel .input-row { display:flex; gap:8px; align-items:center; }
  .operations-panel .status-pill { font-size: 0.8rem; padding: 4px 10px; border-radius: 999px; background: rgba(255,255,255,0.08); }
  .operations-panel .status-pill.status-success { background: rgba(34,197,94,0.15); color: #86efac; }
  .operations-panel .status-pill.status-info { background: rgba(59,130,246,0.15); color: #93c5fd; }
  .operations-panel .status-pill.status-warning { background: rgba(251,191,36,0.15); color: #fde68a; }
  .operations-panel .status-pill.status-error { background: rgba(239,68,68,0.15); color: #fca5a5; }
  .operations-panel .card-subtext { font-size: 0.85rem; color: var(--color-text-secondary); margin: -2px 0 8px; opacity: .9; }
  /* Utilities for spacing and sizing */
  .mt-6 { margin-top: 6px !important; }
  .mt-8 { margin-top: 8px !important; }
  .nowrap { white-space: nowrap !important; }
  .w-90 { width: 90px !important; }
  .w-110 { width: 110px !important; }
  /* Operations layout */
  .operations-panel .content-grid { display: grid; grid-template-columns: 1.2fr 1fr; gap: 12px; align-items: start; }
  @media (max-width: 1200px) { .operations-panel .content-grid { grid-template-columns: 1fr; } }
  .operations-panel .ops-col { display: flex; flex-direction: column; gap: 12px; }
  /* URL chip and status line */
  .operations-panel .status-line { display:flex; align-items:center; gap:8px; margin-top:6px; }
  .operations-panel .url-chip { display:inline-flex; align-items:center; gap:6px; padding:4px 10px; border-radius:999px; border:1px solid rgba(255,255,255,0.12); background: rgba(255,255,255,0.04); color: inherit; text-decoration: none; }
  .operations-panel .url-chip:hover { border-color: rgba(96,165,250,0.45); box-shadow: inset 0 1px 0 rgba(255,255,255,0.06); }
  /* Operations cards (theme aligned) */
  .operations-panel .perf-card { position: relative; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08); border-radius: 14px; padding: 12px 14px; box-shadow: 0 6px 20px rgba(0,0,0,0.15), inset 0 1px 0 rgba(255,255,255,0.04); }
  .operations-panel .perf-card h3 { margin: 0 0 10px 0; font-size: 0.95rem; opacity: 0.9; display: flex; align-items: center; gap: 8px; }
  .operations-panel .metric-row { display: flex; flex-direction: column; gap: 10px; }
  /* Small, muted inline hints */
  .operations-panel .micro-hint { display: inline-flex; align-items: center; gap: 6px; font-size: 0.78rem; color: var(--color-text-secondary); opacity: 0.7; margin-top: 4px; }
  .operations-panel .micro-hint i { font-size: 0.8em; color: var(--color-text-secondary); opacity: 0.6; }
  /* Top-right pill placement inside cards */
  .operations-panel .card-pill-spot { position: absolute; top: 10px; right: 12px; display: flex; gap: 6px; }
  /* API key field styling */
  .operations-panel #api-key-input { flex: 1; min-width: 220px; background: var(--color-bg-card); color: var(--color-text-primary); border: 1px solid var(--color-border); border-radius: 10px; padding: 8px 12px; outline: none; }
  .operations-panel #api-key-input:focus { border-color: var(--color-info); box-shadow: 0 0 0 3px rgba(102,126,234,0.25); }
  /* Inline field styling for label + input rows */
  .operations-panel .inline-field { display: flex; align-items: center; gap: 12px; justify-content: flex-start; flex-wrap: nowrap; }
  .operations-panel .inline-field label {
    display: inline-flex; align-items: center; margin: 0; line-height: 1.2; white-space: nowrap; width: auto;
  }
  .operations-panel .inline-field input,
  .operations-panel .inline-field select {
    flex: 0 0 auto;
  }
  /* removed number input left padding per UX request */
  /* Update progress bar */
  .meter { height: 8px; border-radius: 999px; background: rgba(255,255,255,0.06); overflow: hidden; }
  .meter > div { height: 100%; width: 0; background: linear-gradient(90deg, #60a5fa, #2563eb); transition: width .2s ease; }
  /* Backups list styling */
  #backups-display { border-top: 1px dashed rgba(255,255,255,0.08); padding-top: 10px; }
  #backups-content { display: grid; gap: 8px; }
  #backups-content .backup-item { display:flex; justify-content:space-between; align-items:center; padding:8px 10px; border:1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.02); border-radius:10px; }
  /* Operations panel – compact layout */
  /* Match inner card backgrounds to theme across panels */
  .operations-panel .perf-card {
    background: linear-gradient(135deg, var(--color-bg-card), var(--color-bg-tertiary));
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 14px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.15), inset 0 1px 0 rgba(255,255,255,0.04);
  }
  .operations-panel .perf-card { position: relative; background: linear-gradient(135deg, var(--color-bg-card), var(--color-bg-tertiary)); border: 1px solid rgba(255,255,255,0.08); border-radius: 14px; padding: 12px 14px; box-shadow: 0 6px 20px rgba(0,0,0,0.15), inset 0 1px 0 rgba(255,255,255,0.04); }
  /* Utility */
  .is-hidden { display: none !important; }

  /* Subheader inside panels (e.g., Streaming Releases under TMDB) */
  .panel-header.panel-sub {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
    padding: 8px 0;
    margin: 8px 0;
    border-top: 1px dashed rgba(255,255,255,0.08);
    border-bottom: 1px dashed rgba(255,255,255,0.08);
  }
  .panel-header.panel-sub h3 {
    margin: 0;
    font-size: 1rem;
    font-weight: 600;
    opacity: .92;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  /* (clean) visibility uses [hidden] default styles in theme */
  /* Panel loading overlay (prevents default-value flash) */
  .panel .panel-content { position: relative; }
  /* Subpanel styling (used inside TMDB for Streaming Releases) */
  .subpanel { border: 1px solid rgba(255,255,255,0.08); border-radius: 12px; padding: 10px 12px; background: rgba(255,255,255,0.02); box-shadow: inset 0 1px 0 rgba(255,255,255,0.04); }
  .subpanel + .subpanel { margin-top: 10px; }
  /* Streaming Releases should match themed panel background */
  #subpanel-streaming { background: linear-gradient(135deg, var(--color-bg-card), var(--color-bg-tertiary)); }
  .subpanel-header { display:flex; align-items:center; justify-content:space-between; gap:10px; margin: -2px 0 8px; }
  .subpanel-header h3 { margin:0; font-size: 1rem; display:flex; align-items:center; gap:8px; opacity:.95; }
  .subpanel-body .subtle { opacity:.8; margin-bottom: 8px; }
  .loading-overlay { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; z-index: 2; opacity: 0; pointer-events: none; transition: opacity .18s ease; }
  .loading-overlay .glass { position: absolute; inset: 0; background: transparent; backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px); border-radius: 12px; }
  .loading-overlay .loader { position: relative; display: flex; align-items: center; justify-content: center; padding: 0; border: 0; background: transparent; box-shadow: none; color: var(--color-text-primary); }
  .loading-overlay .loader .spinner { margin: 0; width: 20px; height: 20px; border-width: 2px; filter: drop-shadow(0 0 10px rgba(96,165,250,0.35)); }
  .panel.is-loading .loading-overlay { opacity: 1; pointer-events: auto; }
  /* Blur/dim content while loading, then fade to sharp */
  .panel .panel-content > *:not(.loading-overlay) { opacity: 1; transform: none; filter: none; transition: opacity .18s ease, transform .18s ease, filter .18s ease; }
  .panel.is-loading .panel-content > *:not(.loading-overlay) { opacity: 1; filter: blur(4px); }
  @media (prefers-reduced-motion: reduce) {
    .loading-overlay,
    .panel .panel-content > *:not(.loading-overlay) {
      transition: none !important;
    }
  }

  /* Media Sources header with elegant subtitle */
  #panel-sources-overview > .panel-header { 
    display: flex; 
    align-items: flex-start; 
    justify-content: space-between; 
    gap: 12px; 
  }
  #panel-sources-overview .panel-title { display: flex; flex-direction: column; gap: 4px; }
  #panel-sources-overview .panel-title h2 { 
    margin: 0; 
    display: flex; 
    align-items: center; 
    gap: 10px; 
    line-height: 1.2; 
  }
  #panel-sources-overview .panel-title h2 i { color: inherit; }
  /* Generic subtitle style for panel headers (used by Media Sources and Operations) */
  /* Config backups compact list */
  .compact-backup-list { display: flex; flex-direction: column; gap: 6px; margin-top: 6px; }
  .compact-backup-list .backup-item { border: 1px solid rgba(255,255,255,0.08); border-radius: 10px; overflow: hidden; background: rgba(255,255,255,0.02); }
  .compact-backup-list .backup-summary { display:flex; align-items:center; justify-content: space-between; gap: 10px; padding: 8px 10px; }
  .compact-backup-list .backup-summary .left { display:flex; align-items:center; gap: 8px; }
  .compact-backup-list .backup-summary .subtle { opacity: .7; font-size: .85em; }
  .compact-backup-list .backup-summary .right { display:flex; align-items:center; gap: 6px; }
  /* Ensure backup action icons (chevron/trash) are readable on dark backgrounds */
  .compact-backup-list .backup-summary .right .btn,
  .compact-backup-list .backup-summary .right .btn i { color: #fff !important; }
  .compact-backup-list .backup-summary .right .btn:hover i { color: #fff !important; }
  /* Keep the archive icon on the left white as well */
  .compact-backup-list .backup-summary .left i { color: #fff !important; }
  .compact-backup-list .backup-details { padding: 8px 10px 12px 14px; border-top: 1px solid rgba(255,255,255,0.06); }
  .compact-backup-list .backup-group { margin: 6px 0 10px; }
  .compact-backup-list .backup-group .group-title {
    font-size: .78rem;
    letter-spacing: .02em;
    text-transform: uppercase;
    color: var(--color-text-secondary);
    opacity: .9;
    margin: 0 0 8px 0;
    display: inline-flex;
    align-items: center;
    gap: 8px;
  }
  .compact-backup-list .backup-group .group-title:before {
    content: '';
    width: 10px;
    height: 10px;
    border-radius: 999px;
    display: inline-block;
    background: var(--color-primary);
    box-shadow: 0 0 0 2px color-mix(in srgb, var(--color-primary) 20%, transparent);
  }
  /* Specialize bullets by group using data attribute */
  .compact-backup-list .backup-group[data-group="Core"] .group-title:before { 
    background: var(--color-warning); 
    box-shadow: 0 0 0 2px color-mix(in srgb, var(--color-warning) 25%, transparent); 
  }
  .compact-backup-list .backup-group[data-group="Data"] .group-title:before { 
    background: var(--color-success); 
    box-shadow: 0 0 0 2px color-mix(in srgb, var(--color-success) 20%, transparent); 
  }
  .compact-backup-list .backup-files { display: flex; flex-direction: column; gap: 8px; }
  .compact-backup-list .backup-file-row {
    display: grid;
    grid-template-columns: 1fr auto;
    align-items: center;
    gap: 10px;
    padding: 8px 10px;
    border: 1px solid rgba(255,255,255,0.08);
    background: rgba(255,255,255,0.03);
    border-radius: 10px;
  }
  .compact-backup-list .backup-file-row .file-left { display:flex; align-items:center; gap: 10px; min-width: 0; }
  .compact-backup-list .backup-file-row .file-left i { color: #fff; opacity: .9; }
  .compact-backup-list .backup-file-row .file-text { display:flex; flex-direction:column; gap: 2px; min-width: 0; }
  .compact-backup-list .backup-file-row .file-title { font-weight: 600; opacity: .95; }
  .compact-backup-list .backup-file-row .file-subtle { font-size: .8rem; color: var(--color-text-secondary); opacity: .85; }
  .compact-backup-list .backup-file-row .btn-xs { padding: 4px 10px; font-size: .78rem; border-radius: 8px; }

  /* Themed time input with clock icon */
  .time-input { display:inline-flex; align-items:center; gap:8px; padding: 6px 10px; border-radius: 8px; background: var(--color-bg-tertiary); border: 1px solid var(--color-border); margin: 0 8px; }
  .time-input i { color: var(--color-text-secondary); opacity: .85; }
  .time-input input[type="time"] { background: transparent; border: none; outline: none; color: var(--color-text-primary); font: inherit; }
  .time-input input[type="time"]::-webkit-calendar-picker-indicator { filter: invert(1) opacity(.7); }

  .panel-header .panel-subtitle {
    font-size: 0.95rem;
    color: var(--color-text-secondary);
    opacity: 0.9;
    max-width: 70ch;
    margin-top: 2px;
  }
  
  /* Media Sources Help Cards */
  .card-description {
    font-size: 0.9rem;
    opacity: 0.8;
    margin-bottom: 12px;
  }
  .card-features {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  .card-features li {
    font-size: 0.85rem;
    opacity: 0.9;
    margin-bottom: 6px;
    padding-left: 12px;
    position: relative;
  }
  .card-features li:before {
    content: "•";
    color: rgba(255,255,255,0.6);
    position: absolute;
    left: 0;
  }
  .card-steps {
    margin-top: 8px;
  }
  .card-steps .step {
    font-size: 0.85rem;
    opacity: 0.9;
    margin-bottom: 6px;
    padding-left: 0;
  }
  .card-tips {
    margin-top: 8px;
  }
  .card-tips .tip {
    font-size: 0.85rem;
    opacity: 0.9;
    margin-bottom: 8px;
    line-height: 1.4;
  }

  /* Force correct icon colors for Media Sources cards */
  #section-media-sources .status-card.status-info .card-icon i {
    color: var(--color-info) !important;
  }
  #section-media-sources .status-card.status-success .card-icon i {
    color: var(--color-success) !important;
  }
  #section-media-sources .status-card.status-warning .card-icon i {
    color: var(--color-warning) !important;
  }
  #section-media-sources .status-card.status-error .card-icon i {
    color: var(--color-error) !important;
  }
  #section-media-sources .status-card.status-primary .card-icon i {
    color: var(--color-primary) !important;
  }
  #section-media-sources .status-card.status-secondary .card-icon i {
    color: var(--color-secondary) !important;
  }
  #section-media-sources .status-card.status-accent .card-icon i {
    color: var(--color-accent) !important;
  }

  /* Border-left colors for all status types */
  #section-media-sources .status-card.status-primary {
    border-left-color: var(--color-primary) !important;
  }
  #section-media-sources .status-card.status-secondary {
    border-left-color: var(--color-secondary) !important;
  }
  #section-media-sources .status-card.status-accent {
    border-left-color: var(--color-accent) !important;
  }
  #section-media-sources .status-card.status-error {
    border-left-color: var(--color-error) !important;
  }

  /* Media Sources – Modern overview cards */
  #section-media-sources .source-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 24px;
  }
  /* Prefer 2 columns on medium screens */
  @media (min-width: 900px) {
  #section-media-sources .source-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 26px; }
  }
  /* On very wide screens, fit all four cards on one row */
  @media (min-width: 1400px) {
  #section-media-sources .source-grid { grid-template-columns: repeat(4, minmax(0, 1fr)); gap: 32px; }
  }
  #section-media-sources .source-card {
    position: relative;
    background: linear-gradient(180deg, var(--color-bg-card), var(--color-bg-tertiary));
    border: 1px solid var(--color-border);
    border-radius: 14px;
  padding: 22px 22px; /* larger, calmer cards */
  /* Match device card shadow */
  box-shadow: var(--shadow-md);
  /* No motion/elevation on hover */
  transition: border-color .16s ease, outline-color .16s ease;
  /* Make cards stretch to equal heights within grid rows */
  display: flex;
  flex-direction: column;
  height: 100%;
  }
  #section-media-sources .source-card:hover {
    transform: none;
    box-shadow: var(--shadow-md);
    border-color: var(--color-border);
  }
  /* Per-card accent color via CSS var */
  #section-media-sources .source-card { --sc-accent: var(--color-primary); }
  #section-media-sources .source-card.card-plex { --sc-accent: var(--color-primary); }
  #section-media-sources .source-card.card-jf   { --sc-accent: var(--color-accent); }
  #section-media-sources .source-card.card-tmdb { --sc-accent: var(--color-success); }
  #section-media-sources .source-card.card-tvdb { --sc-accent: var(--color-info); }
  /* Thin accent bar at the top of each card */
  #section-media-sources .source-card::before {
  /* Remove the decorative accent line entirely */
  content: none !important;
  }
  /* Overview status row */
  #section-media-sources .sc-status { display:flex; align-items:center; gap:12px; margin: 12px 0 10px; }
  #section-media-sources .sc-status .status-dot { width: 8px; height: 8px; border-radius: 50%; display:inline-block; }
  #section-media-sources .sc-status .status-dot.status-success { background: #34d399; box-shadow: 0 0 0 0 rgba(52,211,153,.6); }
  #section-media-sources .sc-status .status-dot.status-warning { background: #f59e0b; box-shadow: 0 0 0 0 rgba(245,158,11,.6); }
  #section-media-sources .sc-status .status-dot.status-error { background: #ef4444; box-shadow: 0 0 0 0 rgba(239,68,68,.6); }
  @media (prefers-reduced-motion: no-preference) {
    #section-media-sources .sc-status .status-dot { animation: pulse-dot 2.2s ease-out infinite; }
  }
  @keyframes pulse-dot { 0%{ box-shadow: 0 0 0 0 rgba(255,255,255,.0);} 70%{ box-shadow: 0 0 0 6px rgba(255,255,255,.05);} 100%{ box-shadow: 0 0 0 0 rgba(255,255,255,.0);} }
  #section-media-sources .sc-status .status-pill { font-size:.75rem; padding: 3px 10px; border-radius:999px; background: rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.1); }
  /* Match 'Mode: Wallart' pill design for Configured state */
  #section-media-sources .sc-status .status-pill.status-success,
  #section-media-sources .status-pill.is-configured {
    background: linear-gradient(90deg, rgba(16,185,129,0.22), rgba(59,130,246,0.16));
    color:#d1fae5;
    border-color: rgba(16,185,129,0.45);
    box-shadow: 0 0 0 2px rgba(16,185,129,0.08), 0 6px 22px rgba(16,185,129,0.26);
    font-weight: 700;
  }
  #section-media-sources .sc-status .header-toggle { margin-left:auto; }
  #section-media-sources .sc-meta { display:flex; align-items:center; align-content: flex-start; flex-wrap: wrap; gap: 10px 10px; font-size:.85rem; color: var(--color-text-secondary); margin: 10px 0 16px; }
  /* Header pills (Not configured / Configured) use same look when configured */
  #section-media-sources .status-pill.is-configured,
  #plex-status-pill-header.is-configured,
  #jf-status-pill-header.is-configured,
  #tmdb-status-pill-header.is-configured,
  #tvdb-status-pill-header.is-configured {
    background: linear-gradient(90deg, rgba(16,185,129,0.22), rgba(59,130,246,0.16));
    color:#d1fae5;
    border-color: rgba(16,185,129,0.45);
    box-shadow: 0 0 0 2px rgba(16,185,129,0.08), 0 6px 22px rgba(16,185,129,0.26);
    font-weight: 700;
  }
  /* Ensure consistent pill area height so cards line up evenly */
  /* Very wide screens: allow up to two chip lines comfortably */
  @media (min-width: 1400px) {
    #section-media-sources .sc-meta { height: 92px; }
  }
  /* Medium and small screens: allow up to two chip lines comfortably */
  @media (min-width: 900px) and (max-width: 1399.98px) {
    #section-media-sources .sc-meta { height: 88px; }
  }
  @media (max-width: 899.98px) {
    #section-media-sources .sc-meta { height: 88px; }
  }
  #section-media-sources .sc-meta > span:not(.sep) { white-space: nowrap; }
  #section-media-sources .sc-meta .sep { display:none; opacity:.35; }
  #section-media-sources .sc-meta i { opacity:.8; margin-right: 6px; color: var(--color-text-secondary); }
  /* Meta chips */
  #section-media-sources .sc-chip { display:inline-flex; align-items:center; gap:6px; padding: 4px 10px; border-radius: 999px; background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.10); color: var(--color-text-secondary); }
  #section-media-sources .sc-chip i { margin-right: 0; color: var(--color-text-secondary); opacity: .85; }
  #section-media-sources .sc-chip:hover { border-color: rgba(255,255,255,0.18); }
  #section-media-sources .sc-header { display:flex; align-items:center; gap:14px; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid rgba(255,255,255,0.06); }
  #section-media-sources .sc-icon {
    display: inline-flex; align-items: center; justify-content: center;
    width: auto; height: auto; flex: 0 0 auto; min-width: 0; min-height: 0; flex-shrink: 0;
    border-radius: 0; background: none; box-shadow: none; outline: none;
    color: inherit;
  }
  #section-media-sources .sc-icon i { color: inherit; opacity: 1; }
  #section-media-sources .sc-title { font-size: 1.12rem; font-weight: 700; color: var(--color-text-primary); letter-spacing: .01em; }
  #section-media-sources .sc-desc { font-size: .9rem; color: var(--color-text-secondary); margin: 0 0 12px; }
  /* subtle divider under meta */
  #section-media-sources .source-card .sc-meta { padding-bottom: 12px; margin-bottom: 18px; border-bottom: 1px solid rgba(255,255,255,0.08); }
  #section-media-sources .sc-points { list-style:none; margin:0 0 12px; padding:0; }
  /* Make bullets match the descriptive tone for a calmer look */
  #section-media-sources .sc-points li { font-size: .85rem; color: var(--color-text-secondary); opacity:.95; margin: 6px 0; padding-left: 20px; position: relative; line-height: 1.55; }
  /* Use a small chevron as custom bullet for a modern, light look */
  #section-media-sources .sc-points li:before { content: "\f105"; font-family: "Font Awesome 5 Free"; font-weight: 900; position:absolute; left:0; top: 0.25rem; color: var(--color-text-secondary); opacity: .7; font-size: .8rem; }
  #section-media-sources .sc-actions { display:flex; gap: 12px; align-items:center; }
  #section-media-sources .btn-ghost { background: var(--color-bg-tertiary); border: 1px solid var(--color-border); color: var(--color-text-secondary); }
  /* Help card styles removed (card deleted) */
  
  </style>
</head>
<body>
  <!-- Top navbar -->
  <nav class="navbar">
    <div class="nav-brand">
      <button class="btn btn-icon mobile-only" id="mobile-nav-toggle" aria-label="Toggle navigation" aria-expanded="false">
        <i class="fas fa-bars"></i>
      </button>
      <span>Posterrama</span>
  <span class="version" id="app-version" title="Current version" style="margin-left:8px;">—</span>
  <span class="nav-badge" id="update-available-pill" hidden title="" style="margin-left:6px;">Update available</span>
    </div>
    <div class="nav-actions">
      <div class="dropdown" id="notif-dropdown">
        <button class="btn btn-icon dropdown-toggle" id="notif-btn" title="Notifications" aria-haspopup="true" aria-expanded="false" aria-controls="notif-menu">
          <i class="fas fa-bell"></i>
          <span class="badge" id="notif-count" hidden>0</span>
        </button>
        <div class="dropdown-menu" id="notif-menu" role="menu" aria-hidden="true"></div>
      </div>
  <div class="dropdown" id="settings-dropdown">
        <button class="btn btn-icon dropdown-toggle" id="settings-btn" title="Settings" aria-haspopup="true" aria-expanded="false" aria-controls="settings-menu">
          <i class="fas fa-cog"></i>
        </button>
        <div class="dropdown-menu" id="settings-menu" role="menu" aria-hidden="true">
          <div class="dropdown-heading">Quick links</div>
          <a class="dropdown-item" href="/" target="_blank" rel="noopener" title="Open Posterrama in a new tab">
            <i class="fas fa-external-link-alt"></i>
            <span>View Posterrama</span>
          </a>
          
          <a class="dropdown-item" href="/api-docs" target="_blank" rel="noopener">
            <i class="fas fa-book"></i>
            <span>API Docs</span>
          </a>
          <a class="dropdown-item" href="https://github.com/Posterrama/posterrama" target="_blank" rel="noopener">
            <i class="fab fa-github"></i>
            <span>GitHub Repository</span>
          </a>
          <a class="dropdown-item" href="https://github.com/Posterrama/posterrama/issues/new/choose" target="_blank" rel="noopener">
            <i class="fas fa-bug"></i>
            <span>Report an Issue</span>
          </a>
          <div class="dropdown-divider"></div>
          <div class="dropdown-heading">Server</div>
          <a class="dropdown-item" href="#" id="menu-restart">
            <i class="fas fa-rotate"></i>
            <span>Restart Posterrama</span>
          </a>
        </div>
      </div>
      <div class="dropdown nav-user" id="user-dropdown">
        <button class="btn btn-icon dropdown-toggle" id="user-btn" title="Account" aria-haspopup="true" aria-expanded="false" aria-controls="user-menu">
          <i class="fas fa-user-circle"></i>
          <span>Admin</span>
        </button>
        <div class="dropdown-menu dropdown-right" id="user-menu" role="menu" aria-hidden="true">
          <div class="dropdown-heading">Account</div>
          <a class="dropdown-item" href="#" id="user-change-password">
            <i class="fas fa-key"></i>
            <span>Change Password</span>
          </a>
          <a class="dropdown-item" href="#" id="user-two-fa">
            <i class="fas fa-user-lock"></i>
            <span>Two‑Factor</span>
          </a>
          <a class="dropdown-item" href="#" id="user-profile-photo">
            <i class="fas fa-image"></i>
            <span>Profile Photo</span>
          </a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="/admin/logout" id="user-logout">
            <i class="fas fa-sign-out-alt"></i>
            <span>Logout</span>
          </a>
        </div>
      </div>
    </div>
  </nav>

  <!-- Sidebar -->
  <aside class="sidebar">
    <nav class="sidebar-nav">
      <a href="#" class="nav-item active" data-nav="dashboard">
        <i class="fas fa-tachometer-alt"></i>
        <span>Dashboard</span>
      </a>
      <a href="#" class="nav-item" data-nav="display">
        <i class="fas fa-desktop"></i>
        <span>Display Settings</span>
      </a>
      <div class="nav-group">
        <a href="#" class="nav-item nav-toggle">
          <i class="fas fa-server"></i>
          <span>Media Sources</span>
          <i class="fas fa-chevron-down nav-arrow"></i>
        </a>
        <div class="nav-submenu">
          <a href="#" class="nav-subitem" data-sub="plex"><i class="fas fa-film"></i><span>Plex</span></a>
          <a href="#" class="nav-subitem" data-sub="jellyfin"><i class="fas fa-play"></i><span>Jellyfin</span></a>
          <a href="#" class="nav-subitem" data-sub="tmdb"><i class="fas fa-database"></i><span>TMDB</span></a>
          <a href="#" class="nav-subitem" data-sub="tvdb"><i class="fas fa-tv"></i><span>TVDB</span></a>
        </div>
      </div>
      <a href="#" class="nav-item" data-nav="devices">
        <i class="fas fa-laptop"></i>
        <span class="nav-text-with-badge">
          Device Management
          <span class="nav-badge nav-badge-error">BETA</span>
        </span>
      </a>
      <a href="#" class="nav-item" data-nav="operations"><i class="fas fa-screwdriver-wrench"></i><span>Operations</span></a>
    </nav>
  <div class="sidebar-footer"></div>
  </aside>

  <div class="sidebar-overlay" id="sidebar-overlay" hidden></div>

  <!-- Main content -->
  <main class="main-content">
    <header class="page-header">
      <div class="page-title">
        <h1><i class="fas fa-gauge-high"></i> Dashboard</h1>
        <p>Devices, media, and health at a glance</p>
      </div>
      <div class="page-actions">
        <span class="header-pill" id="perf-activity" title="Overall system activity (CPU and memory)">
          <i class="fas fa-wave-square"></i>
          <span class="label">Activity</span>
          <span class="value">—</span>
        </span>
      </div>
    </header>

  <!-- Dashboard Section -->
  <section id="section-dashboard" class="app-section active">
  <!-- KPI cards -->
  <section class="card-grid" id="kpi-cards">
      <div class="status-card status-success" title="Devices that are Online or Live">
        <div class="card-icon"><i class="fas fa-check-circle"></i></div>
        <div class="card-content">
          <h3>Active Devices</h3>
          <span class="metric" id="metric-active-devices">—</span>
          <span class="trend" id="metric-active-trend"></span>
        </div>
      </div>
      <div class="status-card status-info" title="Total media items across connected sources">
        <div class="card-icon"><i class="fas fa-images"></i></div>
        <div class="card-content">
          <h3>Media Items</h3>
          <span class="metric" id="metric-media-items">—</span>
          <span class="trend" id="metric-media-sub">from sources</span>
        </div>
      </div>
      <div class="status-card status-info" id="mode-card" title="Current display mode and key settings">
        <div class="card-icon"><i id="metric-mode-icon" class="fas fa-image"></i></div>
        <div class="card-content">
          <h3>Active Mode</h3>
          <span class="metric" id="metric-mode">—</span>
          <span class="trend" id="metric-mode-sub"></span>
        </div>
      </div>
      <div class="status-card status-error" title="Devices currently Offline">
        <div class="card-icon"><i class="fas fa-times-circle"></i></div>
        <div class="card-content">
          <h3>Offline Devices</h3>
          <span class="metric" id="metric-offline-devices">—</span>
          <span class="trend negative" id="metric-offline-sub">needs attention</span>
        </div>
      </div>
    </section>

    
    

  <section class="content-grid" style="margin-top: 16px;">
      <!-- Unified System Performance Dashboard -->
      <section class="panel" id="panel-perf-dashboard" style="background: var(--color-bg-card); border: 1px solid var(--color-border); border-radius: 12px; box-shadow: var(--shadow-md);">
        <header class="panel-header" style="background: var(--color-bg-card); border-bottom: 1px solid var(--color-border); border-radius: 12px 12px 0 0; padding: 20px 24px; display: flex; justify-content: space-between; align-items: center;">
          <h2 style="color: var(--color-text-primary); font-size: 1.25rem; font-weight: 600; margin: 0; display: flex; align-items: center; gap: 12px;"><i class="fas fa-gauge-high" style="color: var(--color-accent);"></i> System Performance</h2>
          
          <!-- Status pills in header -->
          <div style="display: flex; gap: 16px; align-items: center;">
            <span class="header-pill status-success" id="perf-app-status" title="Application server status">
              <i class="fas fa-rocket"></i>
              <span class="label">Application</span>
              <span class="value">Running</span>
            </span>
            <span class="header-pill" id="perf-db-status" title="Storage status" style="background: rgba(59, 130, 246, 0.15); color: #93c5fd; border-color: rgba(59, 130, 246, 0.25);">
              <i class="fas fa-hdd"></i>
              <span class="label">Storage</span>
              <span class="value">Healthy</span>
            </span>
            <span class="header-pill status-warning" id="perf-cache-status" title="Cache system status">
              <i class="fas fa-bolt"></i>
              <span class="label">Cache</span>
              <span class="value">Active</span>
            </span>
            <!-- Uptime moved here as a pill only -->
            <span class="header-pill" id="perf-uptime-pill" title="Server uptime">
              <i class="fas fa-clock"></i>
              <span class="label">Uptime</span>
              <span class="value" id="perf-uptime">—</span>
            </span>
          </div>
        </header>
        <div class="panel-content" style="padding: 24px;">
          
          <!-- Resource usage cards -->
          <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px;">
            
            <!-- Resources card -->
            <div style="background: var(--color-bg-card); border-radius: 12px; padding: 24px; box-shadow: var(--shadow-md); border: 1px solid var(--color-border);">
              <h3 style="margin: 0 0 20px 0; font-size: 1.1rem; font-weight: 600; color: var(--color-text-primary); display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-microchip" style="color: var(--color-info);"></i>
                System Resources
              </h3>
              
              <div style="display: grid; gap: 20px;">
                <!-- CPU -->
                <div>
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <span style="font-size: 0.9rem; color: var(--color-text-secondary); font-weight: 500;">CPU Usage</span>
                    <span style="font-size: 0.9rem; font-weight: 600; color: var(--color-text-primary);" id="perf-cpu">—</span>
                  </div>
                  <div style="width: 100%; height: 8px; background: var(--color-bg-secondary); border-radius: 4px; overflow: hidden;">
                    <div style="height: 100%; background: linear-gradient(90deg, var(--color-info), var(--color-info-dark)); border-radius: 4px; transition: width 0.6s ease; width: 0%;" id="meter-cpu"></div>
                  </div>
                </div>
                
                <!-- Memory -->
                <div>
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <span style="font-size: 0.9rem; color: var(--color-text-secondary); font-weight: 500;">Memory Usage</span>
                    <span style="font-size: 0.9rem; font-weight: 600; color: var(--color-text-primary);" id="perf-mem">—</span>
                  </div>
                  <div style="width: 100%; height: 8px; background: var(--color-bg-secondary); border-radius: 4px; overflow: hidden;">
                    <div style="height: 100%; background: linear-gradient(90deg, var(--color-success), var(--color-success-dark)); border-radius: 4px; transition: width 0.6s ease; width: 0%;" id="meter-mem"></div>
                  </div>
                </div>

                <!-- Disk Usage: full-width bar like CPU/Memory -->
                <div>
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <span style="font-size: 0.9rem; color: var(--color-text-secondary); font-weight: 500;">Disk Usage</span>
                    <span style="font-size: 0.9rem; font-weight: 600; color: var(--color-text-primary);" id="perf-disk">—</span>
                  </div>
                  <div style="width: 100%; height: 8px; background: var(--color-bg-secondary); border-radius: 4px; overflow: hidden;">
                    <div style="height: 100%; background: linear-gradient(90deg, var(--color-info), var(--color-info-dark)); border-radius: 4px; transition: width 0.6s ease; width: 0%;" id="meter-disk"></div>
                  </div>
                </div>

                <!-- Load Average under Disk Usage -->
                <div id="perf-loadavg-container" style="margin-top: 8px;">
                  <div style="display: flex; align-items: center; justify-content: space-between; gap: 12px; margin-bottom: 4px;">
                    <div style="display: flex; align-items: center; gap: 8px; color: var(--color-text-secondary);">
                      <i class="fas fa-chart-line" style="color: var(--color-info);"></i>
                      <span style="font-size: 0.9rem; font-weight: 500;">Load Average</span>
                    </div>
                    <div style="display: flex; gap: 8px; align-items: center;">
                      <span style="background: var(--color-bg-tertiary); border: 1px solid var(--color-border); color: var(--color-text-primary); padding: 4px 10px; border-radius: 9999px; font-size: 0.85rem; font-weight: 600; min-width: 48px; text-align: center; font-variant-numeric: tabular-nums;" id="perf-loadavg-1">—</span>
                      <span style="background: var(--color-bg-tertiary); border: 1px solid var(--color-border); color: var(--color-text-primary); padding: 4px 10px; border-radius: 9999px; font-size: 0.85rem; font-weight: 600; min-width: 48px; text-align: center; font-variant-numeric: tabular-nums;" id="perf-loadavg-5">—</span>
                      <span style="background: var(--color-bg-tertiary); border: 1px solid var(--color-border); color: var(--color-text-primary); padding: 4px 10px; border-radius: 9999px; font-size: 0.85rem; font-weight: 600; min-width: 48px; text-align: center; font-variant-numeric: tabular-nums;" id="perf-loadavg-15">—</span>
                    </div>
                  </div>
                  
                </div>
                
              </div>
            </div>

            <!-- Cache management card -->
            <div style="background: var(--color-bg-card); border-radius: 12px; padding: 24px; box-shadow: var(--shadow-md); border: 1px solid var(--color-border);">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="margin: 0; font-size: 1.1rem; font-weight: 600; color: var(--color-text-primary); display: flex; align-items: center; gap: 8px;">
                  <i class="fas fa-database" style="color: var(--color-warning);"></i>
                  Cache
                </h3>
                <button type="button" class="btn btn-icon btn-sm cache-edit-btn" id="btn-edit-cache-size" style="background: var(--color-bg-tertiary); border: 1px solid var(--color-border); color: var(--color-text-secondary); padding: 8px; border-radius: 6px; font-size: 0.8rem; transition: all 0.2s ease;">
                  <i class="fas fa-pen"></i>
                </button>
              </div>
              
              <!-- Storage usage -->
              <div style="margin-bottom: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                  <span style="font-size: 0.85rem; color: var(--color-text-secondary);">Storage</span>
                  <span style="font-size: 0.85rem; font-weight: 600; color: var(--color-text-primary);" id="cache-disk-usage">Loading…</span>
                </div>
                <div style="width: 100%; height: 6px; background: var(--color-bg-secondary); border-radius: 3px; overflow: hidden;">
                  <div style="height: 100%; background: linear-gradient(90deg, var(--color-warning), var(--color-warning-dark)); border-radius: 3px; transition: width 0.6s ease; width: 0%;" id="meter-image-cache"></div>
                </div>
              </div>
              
              <!-- Memory items -->
              <div style="margin-bottom: 24px;">
                <div style="font-size: 0.85rem; color: var(--color-text-secondary); margin-bottom: 4px;">Memory Items</div>
                <div style="font-size: 1.2rem; font-weight: 600; color: var(--color-text-primary);" id="cache-item-count">Loading…</div>
              </div>
              
              <!-- Actions -->
              <div style="display: flex !important; flex-direction: row !important; gap: 8px !important;">
                <button type="button" id="cleanup-cache-button" style="flex: 1; padding: 10px 16px; background: var(--color-bg-tertiary); border: 1px solid var(--color-border); border-radius: 8px; font-size: 0.85rem; font-weight: 500; color: var(--color-text-primary); display: flex; align-items: center; justify-content: center; gap: 8px;">
                  <i class="fas fa-compress-alt"></i>
                  <span>Run Cleanup</span>
                </button>
                <button type="button" id="clear-cache-button" style="flex: 1; padding: 10px 16px; background: var(--color-error); border: 1px solid var(--color-error); border-radius: 8px; font-size: 0.85rem; font-weight: 500; color: white; display: flex; align-items: center; justify-content: center; gap: 8px;">
                  <i class="fas fa-broom"></i>
                  <span>Clear Cache</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>
    </section>
    </section> <!-- /section-dashboard -->

    <!-- Display Settings -->
    <section id="section-display" class="app-section" hidden>
      <style>
        /* Display section micro-styles */
    #section-display .panel { background: linear-gradient(135deg, var(--color-bg-card), var(--color-bg-tertiary)); border:1px solid var(--color-border); border-radius: var(--border-radius-lg); box-shadow: var(--shadow-md); }
    #section-display .panel-header { display:flex; align-items:center; justify-content:space-between; gap:10px; background: linear-gradient(135deg, var(--color-bg-tertiary), var(--color-bg-card)); border-bottom:1px solid var(--color-border); padding: 16px 20px; border-radius: 12px 12px 0 0; }
        #section-display .panel-title { display:flex; align-items:center; gap:10px; }
        #section-display .panel-content { padding: 16px 20px; }
    /* Ops-like cards for Display sections */
    #section-display .form-section { background: linear-gradient(135deg, var(--color-bg-card), var(--color-bg-tertiary)); border: 1px solid rgba(255,255,255,0.08); border-radius: 14px; padding: 12px 14px; box-shadow: 0 6px 20px rgba(0,0,0,0.15), inset 0 1px 0 rgba(255,255,255,0.04); margin-bottom: 12px; }
    #section-display .section-title { margin: 0 0 10px 0; font-size: 0.95rem; opacity: 0.9; display: flex; align-items: center; gap: 8px; }
    /* Tab bar styled like Operations aesthetics */
    #section-display .segmented { display:flex; align-items:center; gap:4px; padding:4px; border-radius:12px; background: linear-gradient(135deg, var(--color-bg-tertiary), var(--color-bg-card)); border: 1px solid rgba(255,255,255,0.08); box-shadow: inset 0 1px 0 rgba(255,255,255,0.04); width: fit-content; }
    #section-display .segmented .seg { display:inline-flex; align-items:center; gap:8px; padding:8px 12px; cursor:pointer; color: var(--color-text-secondary); border-radius: 8px; transition: background .15s ease, color .15s ease, border-color .15s ease; }
    #section-display .segmented .seg:hover { background: rgba(255,255,255,0.05); }
    #section-display .segmented input[type="radio"] { display:none; }
    #section-display .segmented .seg[aria-checked="true"] { background: rgba(59,130,246,0.18); color:#bfdbfe; border: 1px solid rgba(59,130,246,0.35); }
  /* Header status pill for current mode */
  #section-display .status-pill { font-size: 0.85rem; padding: 6px 12px; border-radius: 999px; border: 1px solid rgba(255,255,255,0.14); display:inline-flex; align-items:center; gap:8px; font-weight: 700; letter-spacing: .2px; box-shadow: inset 0 0 0 1px rgba(255,255,255,0.04), 0 4px 16px rgba(0,0,0,0.18); }
  #section-display .status-pill i { font-size: .95em; opacity: .95; }
  #section-display .status-pill .mode-label { opacity: .95; }
  /* Default/info look (fallback) */
  #section-display .status-pill.status-info { background: linear-gradient(90deg, rgba(59,130,246,0.18), rgba(59,130,246,0.10)); color:#dbeafe; border-color: rgba(59,130,246,0.35); box-shadow: 0 0 0 2px rgba(59,130,246,0.06), 0 6px 20px rgba(59,130,246,0.20); }
  /* Mode-specific highlight variants */
  #section-display #display-mode-pill.pill-screensaver { background: linear-gradient(90deg, rgba(99,102,241,0.22), rgba(139,92,246,0.16)); color:#e0e7ff; border-color: rgba(139,92,246,0.45); box-shadow: 0 0 0 2px rgba(139,92,246,0.08), 0 6px 22px rgba(139,92,246,0.28); }
  #section-display #display-mode-pill.pill-wallart { background: linear-gradient(90deg, rgba(16,185,129,0.22), rgba(59,130,246,0.16)); color:#d1fae5; border-color: rgba(16,185,129,0.45); box-shadow: 0 0 0 2px rgba(16,185,129,0.08), 0 6px 22px rgba(16,185,129,0.26); }
  #section-display #display-mode-pill.pill-cinema { background: linear-gradient(90deg, rgba(245,158,11,0.26), rgba(244,63,94,0.16)); color:#fde68a; border-color: rgba(245,158,11,0.50); box-shadow: 0 0 0 2px rgba(245,158,11,0.10), 0 6px 22px rgba(245,158,11,0.30); }
  /* Grids */
  #section-display .form-grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 12px; align-items: start; }
  /* spacing below mode cards */
  #section-display .mode-card + .content-grid,
  #section-display .mode-card + .form-grid { margin-top: 12px; }
  /* Utility to force a single-column full-width stack */
  #section-display .form-grid.fullwidth-stack { grid-template-columns: 1fr !important; }
  /* Clock Widget: checkbox spans full width; timezone + format align on the next row */
  #section-display #sec-clock .form-grid { grid-template-columns: repeat(2, minmax(260px, 1fr)); }
  #section-display #sec-clock .form-grid .form-row:first-child { grid-column: 1 / -1; }
  @media (max-width: 800px) {
    #section-display #sec-clock .form-grid { grid-template-columns: 1fr; }
  }
  /* Masonry utility for mini-card groups (neat stacking without row gaps) */
  #section-display .masonry { display: block; column-width: 320px; column-gap: 12px; }
  @media (max-width: 1600px) { #section-display .masonry { column-width: 300px; } }
  @media (max-width: 1400px) { #section-display .masonry { column-width: 280px; } }
  @media (max-width: 1200px) { #section-display .masonry { column-width: 260px; } }
  @media (max-width: 900px)  { #section-display .masonry { column-width: 100%; } }
  #section-display .masonry > .mode-card { display: inline-block; width: 100%; margin: 0 0 12px; break-inside: avoid; }
  /* Make generic form-section items behave like cards inside masonry as well */
  #section-display .masonry > .form-section { display: inline-block; width: 100%; margin: 0 0 12px; break-inside: avoid; }

  /* Clock Widget: keep all rows in one compact card, two columns for controls */
  #section-display #sec-clock .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px 12px; }
  #section-display #sec-clock .form-grid > .form-row:first-child { grid-column: 1 / -1; }
  @media (max-width: 900px) { #section-display #sec-clock .form-grid { grid-template-columns: 1fr; } }

  /* UI Element Scaling: compact two-column layout for 4 sliders */
  #section-display #sec-scaling .form-grid { display: grid; grid-template-columns: repeat(2, minmax(180px, 1fr)); gap: 12px; }
  @media (max-width: 900px) { #section-display #sec-scaling .form-grid { grid-template-columns: 1fr; } }
  /* Visual Elements: tidy two-column layout for checkboxes, numeric input spans full width */
  #section-display #sec-visual .form-grid { grid-template-columns: repeat(2, minmax(220px, 1fr)); gap: 10px 16px; }
  @media (max-width: 900px) { #section-display #sec-visual .form-grid { grid-template-columns: 1fr; } }
  #section-display #sec-visual .form-grid .form-row.full-span { grid-column: 1 / -1; }
  #section-display #sec-visual .checkbox { display: inline-flex; align-items: center; gap: 10px; }
  /* Wallart: force exactly two masonry columns so we can target the rightmost column reliably */
  #section-display #card-wallart .masonry { column-count: 2; column-width: auto; column-gap: 12px; }
  @media (max-width: 1200px) { #section-display #card-wallart .masonry { column-count: 1; } }

  /* Force exactly two columns for Screensaver and Cinema card groups as well */
  #section-display #saver-cards.masonry { column-count: 2; column-width: auto; column-gap: 12px; }
  #section-display #cinema-cards.masonry { column-count: 2; column-width: auto; column-gap: 12px; }
  @media (max-width: 1200px) {
    #section-display #saver-cards.masonry,
    #section-display #cinema-cards.masonry { column-count: 1; }
  }
  /* (removed) Utility that forced next-column placement; kept for reference */
  /* #section-display .push-right { break-before: column; -webkit-column-break-before: always; } */
    #section-display .form-row { display:flex; flex-direction:column; gap:6px; }
    #section-display .form-row.inline { flex-direction:row; align-items:center; gap:10px; }
    #section-display .form-row label { font-size:.9rem; color: var(--color-text-secondary); }
  /* Two-column container for Display sections (like Operations) */
  #section-display .content-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; align-items: start; }
  @media (max-width: 1200px) { #section-display .content-grid { grid-template-columns: 1fr; } }
  /* Gapless variant using CSS columns for masonry packing */
  #section-display .content-grid.masonry { display: block; column-count: 2; column-gap: 12px; }
  @media (max-width: 1200px) { #section-display .content-grid.masonry { column-count: 1; } }
  #section-display .content-grid.masonry > .form-section { display: inline-block; width: 100%; margin: 0 0 12px; break-inside: avoid; }
  /* (removed) Utility that forced column-break after an element to avoid auto reordering interfering */
  /* #section-display .break-after { break-after: column; -webkit-column-break-after: always; } */
  /* Custom layout mode: Screensaver cards */
  /* Screensaver no longer supports customize layout; rules removed */

  /* Custom layout mode for Wallart & Cinema removed */
    /* Mode cards aligned with perf-card look */
  #section-display .mode-card { position: relative; background: linear-gradient(135deg, var(--color-bg-card), var(--color-bg-tertiary)); border: 1px solid rgba(255,255,255,0.08); border-radius: 14px; padding: 12px 14px; box-shadow: 0 6px 20px rgba(0,0,0,0.15), inset 0 1px 0 rgba(255,255,255,0.04); align-self: start; height: auto; }
  /* Ensure bottom spacing equals top by trimming trailing inner margins */
  #section-display .mode-card > :last-child { margin-bottom: 0 !important; }
  #section-display .mode-card .form-grid > .form-row:last-child { margin-bottom: 0 !important; }
  #section-display .form-section > :last-child { margin-bottom: 0 !important; }
        #section-display .mode-card.inactive { opacity: .6; }
        #section-display .card-header { display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom: 10px; }
  #section-display .card-title { display:flex; align-items:center; gap:8px; font-weight:700; }
  #section-display .card-header .badge { display:inline-flex; align-items:center; gap:6px; padding:2px 10px; border-radius:999px; font-size:.75rem; border:1px solid var(--color-border); position: static; }
        #section-display .badge.active { background: rgba(34,197,94,0.15); color:#86efac; border-color: rgba(34,197,94,0.35); }
        #section-display .badge.inactive { background: rgba(100,116,139,0.15); color:#cbd5e1; border-color: rgba(100,116,139,0.35); }
        #section-display fieldset:disabled { opacity:.6; }
  /* Remove default fieldset border within Display to avoid inner white outlines */
  #section-display fieldset { border: 0; padding: 0; margin: 0; }
        /* Small, muted inline hints inside Display section */
        #section-display .micro-hint { display: inline-flex; align-items: center; gap: 6px; font-size: 0.78rem; color: var(--color-text-secondary); opacity: 0.8; }
        #section-display .micro-hint i { font-size: 0.85em; color: var(--color-text-secondary); opacity: 0.7; }
    /* Themed sliders for Display section */
    #section-display .modern-slider { display:block; width:100%; }
  #section-display .modern-slider input[type="range"] { width:100%; height: 28px; background: transparent; accent-color: var(--color-info); position: relative; z-index: 1; }
    /* Add a non-intrusive progress bar behind the native slider */
    #section-display .modern-slider { position: relative; }
    #section-display .modern-slider .slider-bar { 
      position: absolute; left: 0; right: 0; top: 50%; transform: translateY(-50%);
      height: 4px; border-radius: 999px; pointer-events: none; z-index: 0;
      background: var(--color-bg-tertiary);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.02), 0 1px 2px rgba(0,0,0,0.16);
    }
    #section-display .modern-slider .slider-bar .fill {
      width: 0%; height: 100%; border-radius: 999px; pointer-events: none;
      background: linear-gradient(90deg, var(--color-primary), var(--color-accent));
      box-shadow: 0 0 6px rgba(139, 92, 246, 0.18), inset 0 0 0 1px rgba(255,255,255,0.03);
    }
    #section-display .slider-percentage { font-size: .8rem; color: var(--color-text-secondary); opacity: .85; margin-top: 4px; text-align: right; }

    /* Themed number steppers (shared in Display) */
    #section-display .number-input-wrapper { display:flex; align-items:stretch; border:1px solid var(--color-border); background: var(--color-bg-card); border-radius: 10px; overflow:hidden; width: 100%; }
  #section-display .number-input-wrapper input[type="number"] { flex:1; min-width: 0; padding:8px 10px; background: transparent; color: var(--color-text-primary); border: none; outline: none; font: inherit; appearance: textfield; -moz-appearance: textfield; }
    #section-display .number-input-wrapper input[type="number"]::-webkit-outer-spin-button,
    #section-display .number-input-wrapper input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    #section-display .number-input-wrapper .number-controls { display:flex; flex-direction: column; border-left:1px solid var(--color-border); }
    #section-display .number-input-wrapper .number-btn { width:34px; height:50%; display:flex; align-items:center; justify-content:center; background: var(--color-bg-tertiary); border: 0; color: var(--color-text-secondary); cursor: pointer; }
    #section-display .number-input-wrapper .number-btn:hover { background: rgba(255,255,255,0.06); color: var(--color-text-primary); }
    #section-display .number-input-wrapper .number-btn:active { transform: translateY(0); }
    #section-display .form-help { margin-top: 6px; font-size: .82rem; color: var(--color-text-secondary); opacity: .9; }
      </style>
      <div class="panel" id="panel-display">
        <div class="panel-header">
          <div class="panel-title" style="flex-direction:column; align-items:flex-start; gap:4px;">
            <div style="display:flex; align-items:center; gap:10px;">
              <i class="fas fa-desktop" aria-hidden="true"></i>
              <h2 style="margin:0;">Display Settings</h2>
            </div>
            <div class="panel-subtitle">Customize posters for Screensaver, Wallart, Cinema: effects, timing, sync.</div>
          </div>
          <div class="panel-actions">
            <span class="status-pill status-info" id="display-mode-pill" title="Current display mode">Mode: —</span>
            <button class="btn btn-primary btn-sm" id="btn-save-display"><span class="spinner" style="display:none"></span><i class="fas fa-save"></i><span>Save Settings</span></button>
          </div>
        </div>
        <div class="panel-content">
          <!-- Active mode selector -->
          <div class="form-section">
            <div class="section-title"><i class="fas fa-layer-group"></i> Active Mode</div>
            <div class="form-row">
              <div class="segmented" role="tablist" aria-label="Display Mode">
                <label class="seg" id="seg-saver" role="tab" aria-controls="card-screensaver" aria-checked="false">
                  <input type="radio" name="display.mode" id="mode-screensaver" value="screensaver" />
                  <i class="fas fa-image"></i> Screensaver
                </label>
                <label class="seg" id="seg-wallart" role="tab" aria-controls="card-wallart" aria-checked="false">
                  <input type="radio" name="display.mode" id="mode-wallart" value="wallart" />
                  <i class="fas fa-images"></i> Wallart
                </label>
                <label class="seg" id="seg-cinema" role="tab" aria-controls="card-cinema" aria-checked="false">
                  <input type="radio" name="display.mode" id="mode-cinema" value="cinema" />
                  <i class="fas fa-tv" style="transform: rotate(90deg);"></i> Cinema
                </label>
              </div>

            </div>
          </div>
          <!-- Mode-specific settings placed directly under Active Mode for better hierarchy -->
          <div id="mode-cards-top">
            <!-- Screensaver settings (active when mode = screensaver) -->
            <div class="mode-card" id="card-screensaver" hidden>
              <div class="card-header">
                <div class="card-title"><i class="fas fa-image"></i> Screensaver</div>
              </div>
              <fieldset id="fs-screensaver">
                <div class="card-subtext" style="margin-bottom:10px; color: var(--color-text-secondary);">
                  A calm, full-screen slideshow of your posters. Use presets or fine‑tune Effects & Playback.
                </div>
                <div class="form-grid masonry" id="saver-cards" style="grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));">
                  <!-- Presets + Summary card (first by default) -->
                  <div class="mode-card" id="saver-presets-card" data-card-key="presets" style="padding:12px;">
                    <div class="card-title" style="font-size:.95rem; margin-bottom:6px;"><i class="fas fa-sliders-h"></i> Presets</div>
                    <div class="scaling-presets" style="display:flex; flex-wrap:wrap; gap:8px;">
                      <button type="button" class="btn btn-secondary btn-sm" id="saver-preset-chill" title="Ken Burns, slower cadence"><i class="fas fa-wind"></i> <span>Chill</span></button>
                      <button type="button" class="btn btn-secondary btn-sm" id="saver-preset-standard" title="Fade, balanced cadence"><i class="fas fa-balance-scale"></i> <span>Standard</span></button>
                      <button type="button" class="btn btn-secondary btn-sm" id="saver-preset-lively" title="Slide, faster cadence"><i class="fas fa-bolt"></i> <span>Lively</span></button>
                      <button type="button" class="btn btn-outline btn-sm" id="saver-preset-reset" title="Reset to sensible defaults"><i class="fas fa-undo"></i> <span>Reset</span></button>
                    </div>
                    <div class="card-title" style="font-size:.95rem; margin:10px 0 6px;"><i class="fas fa-info-circle"></i> Current Experience</div>
                    <div id="saver-summary" style="display:flex; flex-wrap:wrap; gap:8px; align-items:center;">
                      <span class="status-pill" id="saver-summary-interval" title="Poster change interval">Every — s</span>
                      <span class="status-pill" id="saver-summary-effect" title="Visual transition">Effect: —</span>
                      <span class="status-pill" id="saver-summary-pause" title="Pause after transition">Pause: —</span>
                      <span class="status-pill" id="saver-summary-clock" title="Clock widget status">Clock: —</span>
                    </div>
                  </div>
                  
                  <!-- MOVED: Shared sections now live inside Screensaver -->
                  <!-- Visual Elements -->
                  <div class="form-section" id="sec-visual" data-card-key="visual">
                    <div class="section-title"><i class="fas fa-eye"></i> Visual Elements</div>
                    <div class="form-grid">
                      <div class="form-row">
                        <label class="checkbox" for="showPoster">
                          <input type="checkbox" id="showPoster" />
                          <span class="checkmark"></span>
                          <span>Show poster</span>
                        </label>
                      </div>
                      <div class="form-row">
                        <label class="checkbox" for="showMetadata" style="margin-bottom:4px;">
                          <input type="checkbox" id="showMetadata" />
                          <span class="checkmark"></span>
                          <span>Show metadata</span>
                        </label>
                      </div>
                      <div class="form-row">
                        <label class="checkbox" for="showClearLogo">
                          <input type="checkbox" id="showClearLogo" />
                          <span class="checkmark"></span>
                          <span>Show clearlogo</span>
                        </label>
                      </div>
                      <div class="form-row">
                        <label class="checkbox" for="showRottenTomatoes">
                          <input type="checkbox" id="showRottenTomatoes" />
                          <span class="checkmark"></span>
                          <span>Show Rotten Tomatoes</span>
                        </label>
                      </div>
                      <div class="form-row full-span"><label for="rottenTomatoesMinimumScore">Minimum Rotten Tomatoes (0–10)</label><div class="number-input-wrapper"><input type="number" min="0" max="10" step="0.5" id="rottenTomatoesMinimumScore" /><div class="number-controls" role="group"><button type="button" class="number-btn number-inc" title="Increase"><i class="fas fa-chevron-up"></i></button><button type="button" class="number-btn number-dec" title="Decrease"><i class="fas fa-chevron-down"></i></button></div></div></div>
                    </div>
                  </div>

                  <!-- Clock Widget -->
                  <div class="form-section" id="sec-clock" data-card-key="clock">
                    <div class="section-title"><i class="fas fa-clock"></i> Clock Widget</div>
                    <div class="form-grid">
                      <div class="form-row">
                        <label class="checkbox" for="clockWidget">
                          <input type="checkbox" id="clockWidget" />
                          <span class="checkmark"></span>
                          <span>Show clock</span>
                        </label>
                      </div>
                      <div class="form-row"><label for="clockTimezone">Clock timezone</label><select id="clockTimezone"><option value="auto">Auto (System Timezone)</option><optgroup label="Common Timezones"><option value="Europe/Amsterdam">Europe/Amsterdam (CET/CEST)</option><option value="Europe/London">Europe/London (GMT/BST)</option><option value="Europe/Berlin">Europe/Berlin (CET/CEST)</option><option value="Europe/Paris">Europe/Paris (CET/CEST)</option><option value="America/New_York">America/New_York (EST/EDT)</option><option value="America/Chicago">America/Chicago (CST/CDT)</option><option value="America/Denver">America/Denver (MST/MDT)</option><option value="America/Los_Angeles">America/Los_Angeles (PST/PDT)</option><option value="Asia/Tokyo">Asia/Tokyo (JST)</option><option value="Asia/Shanghai">Asia/Shanghai (CST)</option><option value="Australia/Sydney">Australia/Sydney (AEST/AEDT)</option></optgroup><optgroup label="Additional Timezones"><option value="UTC">UTC (Coordinated Universal Time)</option><option value="Africa/Cairo">Africa/Cairo (EET)</option><option value="Africa/Johannesburg">Africa/Johannesburg (SAST)</option><option value="America/Argentina/Buenos_Aires">America/Argentina/Buenos_Aires (ART)</option><option value="America/Mexico_City">America/Mexico_City (CST/CDT)</option><option value="America/Sao_Paulo">America/Sao_Paulo (BRT/BRST)</option><option value="America/Toronto">America/Toronto (EST/EDT)</option><option value="America/Vancouver">America/Vancouver (PST/PDT)</option><option value="Asia/Bangkok">Asia/Bangkok (ICT)</option><option value="Asia/Dubai">Asia/Dubai (GST)</option><option value="Asia/Hong_Kong">Asia/Hong_Kong (HKT)</option><option value="Asia/Jakarta">Asia/Jakarta (WIB)</option><option value="Asia/Kolkata">Asia/Kolkata (IST)</option><option value="Asia/Seoul">Asia/Seoul (KST)</option><option value="Asia/Singapore">Asia/Singapore (SGT)</option><option value="Asia/Taipei">Asia/Taipei (CST)</option><option value="Australia/Brisbane">Australia/Brisbane (AEST)</option><option value="Australia/Melbourne">Australia/Melbourne (AEST/AEDT)</option><option value="Australia/Perth">Australia/Perth (AWST)</option><option value="Europe/Athens">Europe/Athens (EET/EEST)</option><option value="Europe/Istanbul">Europe/Istanbul (TRT)</option><option value="Europe/Moscow">Europe/Moscow (MSK)</option><option value="Europe/Rome">Europe/Rome (CET/CEST)</option><option value="Europe/Stockholm">Europe/Stockholm (CET/CEST)</option><option value="Europe/Zurich">Europe/Zurich (CET/CEST)</option><option value="Pacific/Auckland">Pacific/Auckland (NZST/NZDT)</option><option value="Pacific/Honolulu">Pacific/Honolulu (HST)</option></optgroup></select></div>
                      <div class="form-row"><label for="clockFormat">Clock format</label><select id="clockFormat"><option value="24h">24-hour</option><option value="12h">12-hour</option></select></div>
                    </div>
                  </div>

                  <!-- UI Element Scaling -->
                  <div class="form-section" id="sec-scaling" data-card-key="scaling">
                    <div class="section-title"><i class="fas fa-expand-arrows-alt"></i> UI Element Scaling</div>
                    <div class="form-grid">
                      <div class="form-row"><label for="uiScaling.content">Content</label><div class="modern-slider"><input type="range" id="uiScaling.content" min="50" max="200" step="5" value="100" /><div class="slider-percentage" data-target="uiScaling.content">100%</div></div></div>
                      <div class="form-row"><label for="uiScaling.clearlogo">Clearlogo</label><div class="modern-slider"><input type="range" id="uiScaling.clearlogo" min="50" max="200" step="5" value="100" /><div class="slider-percentage" data-target="uiScaling.clearlogo">100%</div></div></div>
                      <div class="form-row"><label for="uiScaling.clock">Clock</label><div class="modern-slider"><input type="range" id="uiScaling.clock" min="50" max="200" step="5" value="100" /><div class="slider-percentage" data-target="uiScaling.clock">100%</div></div></div>
                      <div class="form-row"><label for="uiScaling.global">Global</label><div class="modern-slider"><input type="range" id="uiScaling.global" min="50" max="200" step="5" value="100" /><div class="slider-percentage" data-target="uiScaling.global">100%</div></div></div>
                    </div>
                    <!-- Presets -->
                    <div class="form-row" style="margin-top:8px;">
                      <div class="scaling-presets" style="display:flex; flex-wrap:wrap; gap:8px;">
                        <button type="button" class="btn btn-secondary btn-sm" id="preset-4k-tv"><i class="fas fa-tv"></i> <span>4K TV</span></button>
                        <button type="button" class="btn btn-secondary btn-sm" id="preset-full-hd"><i class="fas fa-desktop"></i> <span>Full HD</span></button>
                        <button type="button" class="btn btn-secondary btn-sm" id="preset-ultrawide"><i class="fas fa-expand-arrows-alt"></i> <span>Ultrawide</span></button>
                        <button type="button" class="btn btn-outline btn-sm" id="reset-ui-scaling"><i class="fas fa-undo"></i> <span>Reset</span></button>
                      </div>
                    </div>
                  </div>

                  <!-- Sync -->
                  <div class="form-section" id="sec-sync" data-card-key="sync">
                    <div class="section-title"><i class="fas fa-link"></i> Sync</div>
                    <div class="form-grid">
                      <div class="form-row">
                        <label class="checkbox" for="syncEnabled">
                          <input type="checkbox" id="syncEnabled" />
                          <span class="checkmark"></span>
                          <span>Enable device sync</span>
                        </label>
                      </div>
                      <div class="form-row"><label for="syncAlignMaxDelayMs">Max align delay (ms)</label><div class="number-input-wrapper"><input type="number" id="syncAlignMaxDelayMs" min="0" step="50" /><div class="number-controls" role="group"><button type="button" class="number-btn number-inc" title="Increase"><i class="fas fa-chevron-up"></i></button><button type="button" class="number-btn number-dec" title="Decrease"><i class="fas fa-chevron-down"></i></button></div></div></div>
                    </div>
                  </div>

                  <!-- Effects & Transitions -->
                  <div class="form-section" id="sec-effects" data-card-key="effects">
                    <div class="section-title"><i class="fas fa-magic"></i> Effects & Transitions</div>
                    <div class="form-grid">
                      <div class="form-row"><label for="transitionEffect">Transition effect</label><select id="transitionEffect"><option value="kenburns">Ken Burns</option><option value="fade">Fade In/Out</option><option value="slide">Slide Transition</option></select></div>
                      <div class="form-row"><label for="effectPauseTime">Effect pause (seconds)</label><div class="number-input-wrapper"><input type="number" min="0" max="10" step="0.5" id="effectPauseTime" /><div class="number-controls" role="group"><button type="button" class="number-btn number-inc" title="Increase"><i class="fas fa-chevron-up"></i></button><button type="button" class="number-btn number-dec" title="Decrease"><i class="fas fa-chevron-down"></i></button></div></div></div>
                    </div>
                  </div>

                  <!-- Playback Timing -->
                  <div class="form-section" id="sec-playback" data-card-key="playback">
                    <div class="section-title"><i class="fas fa-cogs"></i> Playback Timing</div>
                    <div class="form-grid">
                      <div class="form-row"><label for="transitionIntervalSeconds">Transition interval (seconds)</label><div class="number-input-wrapper"><input type="number" min="1" max="300" step="1" id="transitionIntervalSeconds" /><div class="number-controls" role="group"><button type="button" class="number-btn number-inc" title="Increase"><i class="fas fa-chevron-up"></i></button><button type="button" class="number-btn number-dec" title="Decrease"><i class="fas fa-chevron-down"></i></button></div></div><div class="form-help">Time in seconds between poster transitions (1-300).</div></div>
                    </div>
                  </div>

              </fieldset>
            </div>

            <!-- Wallart settings -->
            <div class="mode-card" id="card-wallart" style="margin-top:12px;" hidden>
              <div class="card-header">
                <div class="card-title"><i class="fas fa-th-large"></i> Wallart</div>
              </div>
              <fieldset id="fs-wallart">
                <div class="card-subtext" style="margin-bottom:10px; color: var(--color-text-secondary);">
                  A dynamic, tiled poster wall. Fine‑tune density, animation, layout, ambience, and hero.
                </div>
                <div class="form-grid masonry" id="wallart-cards" style="grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));">
                  <!-- Tempo card -->
                  <div class="mode-card" data-card-key="tempo" style="padding:12px;">
                    <div class="card-title" style="font-size:.95rem; margin-bottom:6px;"><i class="fas fa-tachometer-alt"></i> Tempo</div>
                    <div class="form-grid">
                      <div class="form-row">
                        <label for="wallartMode.refreshRate">Poster Refresh Rate</label>
                        <div class="modern-slider">
                          <input type="range" min="1" max="10" step="1" id="wallartMode.refreshRate" value="5" />
                          <div class="slider-percentage" data-target="wallartMode.refreshRate">Medium</div>
                        </div>
                      </div>
                      <div class="form-row">
                        <label for="wallartMode.randomness">Timing Randomness</label>
                        <div class="modern-slider">
                          <input type="range" min="0" max="10" step="1" id="wallartMode.randomness" value="3" />
                          <div class="slider-percentage" data-target="wallartMode.randomness">Low</div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Animation card -->
                  <div class="mode-card" data-card-key="animation" style="padding:12px;">
                    <div class="card-title" style="font-size:.95rem; margin-bottom:6px;"><i class="fas fa-magic"></i> Animation</div>
                    <div class="form-grid">
                      <div class="form-row">
                        <label for="wallartMode.animationType">Animation</label>
                        <select id="wallartMode.animationType">
                          <option value="random">Random — Uses all animations</option>
                          <option value="fade">Fade — Smooth opacity</option>
                          <option value="slideLeft">Slide Left — From right</option>
                          <option value="slideUp">Slide Up — From bottom</option>
                          <option value="zoom">Zoom — Scale in</option>
                          <option value="flip">Flip — 3D flip</option>
                          <option value="staggered">Staggered — Rows/columns</option>
                          <option value="ripple">Ripple — Wave from center</option>
                          <option value="scanline">Scanline — Horizontal sweep</option>
                          <option value="parallax">Parallax — Subtle depth</option>
                          <option value="neonPulse">Neon Pulse — Soft glow</option>
                          <option value="chromaticShift">Chromatic Shift — RGB split</option>
                          <option value="mosaicShatter">Mosaic Shatter — Tiles assemble</option>
                        </select>
                      </div>
                    </div>
                  </div>

                  <!-- Layout card -->
                  <div class="mode-card" data-card-key="layout" style="padding:12px;">
                    <div class="card-title" style="font-size:.95rem; margin-bottom:6px;"><i class="fas fa-th-large"></i> Layout</div>
                    <div class="form-grid">
                      <div class="form-row">
                        <label for="wallartMode.density">Density</label>
                        <select id="wallartMode.density">
                          <option value="low">Low</option>
                          <option value="medium">Medium</option>
                          <option value="high">High</option>
                          <option value="ludicrous">Ludicrous</option>
                        </select>
                      </div>
                      <div class="form-row">
                        <label for="wallartMode.layoutVariant">Layout</label>
                        <select id="wallartMode.layoutVariant">
                          <option value="heroGrid">Hero Grid</option>
                          <option value="classic">Classic</option>
                        </select>
                      </div>
                      
                    </div>
                  </div>

                  <!-- Ambience card -->
                  <div class="mode-card" data-card-key="ambience" style="padding:12px;">
                    <div class="card-title" style="font-size:.95rem; margin-bottom:6px;"><i class="fas fa-lightbulb"></i> Ambience</div>
                    <div class="form-grid">
                      <div class="form-row">
                        <label class="checkbox" for="wallartMode.ambientGradient">
                          <input type="checkbox" id="wallartMode.ambientGradient" />
                          <span class="checkmark"></span>
                          <span>Ambient gradient</span>
                        </label>
                      </div>
                      <div class="form-row">
                        <label class="checkbox" for="wallartMode.layoutSettings.heroGrid.biasAmbientToHero">
                          <input type="checkbox" id="wallartMode.layoutSettings.heroGrid.biasAmbientToHero" />
                          <span class="checkmark"></span>
                          <span>Bias ambient to hero</span>
                        </label>
                      </div>
                    </div>
                  </div>

                  <!-- Hero settings card (shown for Hero Grid) -->
                  <div class="mode-card" id="wallart-hero-card" data-card-key="hero" style="padding:12px;">
                    <div class="card-title" style="font-size:.95rem; margin-bottom:6px;"><i class="fas fa-user-astronaut"></i> Hero Settings</div>
                    <div class="form-grid">
                      <div class="form-row">
                        <label for="wallartMode.layoutSettings.heroGrid.heroSide">Hero side</label>
                        <select id="wallartMode.layoutSettings.heroGrid.heroSide">
                          <option value="left">Left</option>
                          <option value="right">Right</option>
                        </select>
                      </div>
                      <div class="form-row">
                        <label for="wallartMode.layoutSettings.heroGrid.heroRotationMinutes">Hero rotation (min)</label>
                        <div class="number-input-wrapper"><input type="number" min="1" max="60" id="wallartMode.layoutSettings.heroGrid.heroRotationMinutes" /><div class="number-controls" role="group"><button type="button" class="number-btn number-inc" title="Increase"><i class="fas fa-chevron-up"></i></button><button type="button" class="number-btn number-dec" title="Decrease"><i class="fas fa-chevron-down"></i></button></div></div>
                      </div>
                    </div>
                  </div>
                </div>
              </fieldset>
            </div>

            <!-- Cinema settings -->
            <div class="mode-card" id="card-cinema" style="margin-top:12px;" hidden>
              <div class="card-header">
                <div class="card-title"><i class="fas fa-film"></i> Cinema</div>
              </div>
              <fieldset id="fs-cinema">
                <div class="card-subtext" style="margin-bottom:10px; color: var(--color-text-secondary);">
                  A large, single‑poster view for displays. Choose your screen orientation.
                </div>
                <div class="form-grid masonry" id="cinema-cards" style="grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));">
                  <!-- Orientation card -->
                  <div class="mode-card" data-card-key="orientation" style="padding:12px;">
                    <div class="card-title" style="font-size:.95rem; margin-bottom:6px;"><i class="fas fa-mobile-alt"></i> Orientation</div>
                    <div class="form-grid">
                      <div class="form-row">
                        <label for="cinemaOrientation">Orientation</label>
                        <select id="cinemaOrientation">
                          <option value="auto">Auto</option>
                          <option value="portrait">Portrait</option>
                          <option value="portrait-flipped">Portrait (flipped)</option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
              </fieldset>
            </div>
          </div>

        </div>
      </div>

    </section>

    <!-- Media Sources Section (top-level sibling, not nested under dashboard) -->
    <section id="section-media-sources" class="app-section" hidden>
      <section class="panel" id="panel-sources-overview">
        <header class="panel-header">
          <div style="display:flex; align-items:flex-start; justify-content:space-between; gap:10px;">
            <div class="panel-title">
              <h2><i class="fas fa-database"></i> Media Sources</h2>
              <div class="panel-subtitle">Combine media across platforms into a unified poster gallery</div>
            </div>
            <div class="panel-actions"></div>
          </div>
        </header>
        <div class="panel-content">
          <div class="help-content">

            <!-- Sources Overview: modern, calm cards -->
            <section class="source-grid" style="margin-bottom: 32px;">
              <!-- Plex Card -->
              <div class="source-card card-plex">
                <div class="sc-header">
                  <div class="sc-icon"><i class="fas fa-film" style="color: var(--color-primary);"></i></div>
                  <div class="sc-title">Plex Media Server</div>
                </div>
                <div class="sc-status" id="sc-plex-status">
                  <span class="status-dot" id="sc-plex-dot"></span>
                  <span class="status-pill" id="sc-plex-pill">—</span>
                  <label class="header-toggle" for="sc.plex.enabled" title="Enable Plex">
                    <input type="checkbox" id="sc.plex.enabled" />
                    <span class="ht-switch" aria-hidden="true"></span>
                    <span class="ht-text">Enabled</span>
                  </label>
                </div>
                <div class="sc-meta">
                  <span class="sc-chip" id="sc-plex-count" title="Items (filtered vs total)"><i class="fas fa-layer-group"></i><span class="value">—</span></span>
                  <span class="sc-chip" id="sc-plex-sync" title="Last sync time"><i class="fas fa-clock"></i><span class="value">—</span></span>
                  <span class="sc-chip" id="sc-plex-libs" title="Selected libraries"><i class="fas fa-list"></i><span class="value">—</span></span>
                </div>
                <p class="sc-desc">Your personal media server for movies and TV.</p>
                <ul class="sc-points">
                  <li>Connection: Hostname, Port, Token</li>
                  <li>Libraries: select Movies and Shows</li>
                  <li>Filters: Years, Ratings, Genres, Qualities</li>
                  <li>Recently added only (+ days)</li>
                </ul>
                <div class="sc-actions">
                  <a class="btn btn-primary btn-sm" href="#plex"><i class="fas fa-sliders-h"></i> <span>Configure</span></a>
                  <a class="btn btn-sm btn-ghost" href="https://support.plex.tv/" target="_blank" rel="noopener"><i class="fas fa-book"></i> <span>Docs</span></a>
                </div>
              </div>

              <!-- Jellyfin Card -->
              <div class="source-card card-jf">
                <div class="sc-header">
                  <div class="sc-icon"><i class="fas fa-play" style="color: var(--color-accent);"></i></div>
                  <div class="sc-title">Jellyfin Server</div>
                </div>
                <div class="sc-status" id="sc-jf-status">
                  <span class="status-dot" id="sc-jf-dot"></span>
                  <span class="status-pill" id="sc-jf-pill">—</span>
                  <label class="header-toggle" for="sc.jf.enabled" title="Enable Jellyfin">
                    <input type="checkbox" id="sc.jf.enabled" />
                    <span class="ht-switch" aria-hidden="true"></span>
                    <span class="ht-text">Enabled</span>
                  </label>
                </div>
                <div class="sc-meta">
                  <span class="sc-chip" id="sc-jf-count" title="Items (filtered vs total)"><i class="fas fa-layer-group"></i><span class="value">—</span></span>
                  <span class="sc-chip" id="sc-jf-sync" title="Last sync time"><i class="fas fa-clock"></i><span class="value">—</span></span>
                  <span class="sc-chip" id="sc-jf-libs" title="Selected libraries"><i class="fas fa-list"></i><span class="value">—</span></span>
                </div>
                <p class="sc-desc">Open‑source media server with flexible libraries.</p>
                <ul class="sc-points">
                  <li>Connection: Hostname, Port, API Key</li>
                  <li>Libraries: select Movies and Shows</li>
                  <li>Filters: Years, Ratings, Genres</li>
                  <li>Recently added only (+ days)</li>
                </ul>
                <div class="sc-actions">
                  <a class="btn btn-primary btn-sm" href="#jellyfin"><i class="fas fa-sliders-h"></i> <span>Configure</span></a>
                  <a class="btn btn-sm btn-ghost" href="https://jellyfin.org/docs/" target="_blank" rel="noopener"><i class="fas fa-book"></i> <span>Docs</span></a>
                </div>
              </div>

              <!-- TMDB Card -->
              <div class="source-card card-tmdb">
                <div class="sc-header">
                  <div class="sc-icon"><i class="fas fa-database" style="color: var(--color-success);"></i></div>
                  <div class="sc-title">The Movie Database</div>
                </div>
                <div class="sc-status" id="sc-tmdb-status">
                  <span class="status-dot" id="sc-tmdb-dot"></span>
                  <span class="status-pill" id="sc-tmdb-pill">—</span>
                  <label class="header-toggle" for="sc.tmdb.enabled" title="Enable TMDB">
                    <input type="checkbox" id="sc.tmdb.enabled" />
                    <span class="ht-switch" aria-hidden="true"></span>
                    <span class="ht-text">Enabled</span>
                  </label>
                </div>
                <div class="sc-meta">
                  <span class="sc-chip" id="sc-tmdb-count" title="TMDB items"><i class="fas fa-layer-group"></i><span class="value">—</span></span>
                  <span class="sc-chip" id="sc-tmdb-sync" title="Last fetch time"><i class="fas fa-cloud-download-alt"></i><span class="value">—</span></span>
                  <span class="sc-chip" id="sc-tmdb-mode" title="Category"><i class="fas fa-stream"></i><span class="value">—</span></span>
                </div>
                <p class="sc-desc">Comprehensive metadata and discovery.</p>
                <ul class="sc-points">
                  <li>API Key</li>
                  <li>Category (popular, top rated, etc.)</li>
                  <li>Filters: Min rating, Years, Genres</li>
                </ul>
                <div class="sc-actions">
                  <a class="btn btn-primary btn-sm" href="#tmdb"><i class="fas fa-sliders-h"></i> <span>Configure</span></a>
                  <a class="btn btn-sm btn-ghost" href="https://developer.themoviedb.org/" target="_blank" rel="noopener"><i class="fas fa-book"></i> <span>Docs</span></a>
                </div>
              </div>

              <!-- TVDB Card -->
              <div class="source-card card-tvdb">
                <div class="sc-header">
                  <div class="sc-icon"><i class="fas fa-tv" style="color: var(--color-info);"></i></div>
                  <div class="sc-title">TheTVDB</div>
                </div>
                <div class="sc-status" id="sc-tvdb-status">
                  <span class="status-dot" id="sc-tvdb-dot"></span>
                  <span class="status-pill" id="sc-tvdb-pill">—</span>
                  <label class="header-toggle" for="sc.tvdb.enabled" title="Enable TVDB">
                    <input type="checkbox" id="sc.tvdb.enabled" />
                    <span class="ht-switch" aria-hidden="true"></span>
                    <span class="ht-text">Enabled</span>
                  </label>
                </div>
                <div class="sc-meta">
                  <span class="sc-chip" id="sc-tvdb-count" title="TVDB items"><i class="fas fa-layer-group"></i><span class="value">—</span></span>
                  <span class="sc-chip" id="sc-tvdb-sync" title="Last fetch time"><i class="fas fa-cloud-download-alt"></i><span class="value">—</span></span>
                </div>
                <p class="sc-desc">Series and episode metadata with artwork.</p>
                <ul class="sc-points">
                  <li>Category (popular, top rated, etc.)</li>
                  <li>Filter: Min rating</li>
                  <li>Filter: Year</li>
                </ul>
                <div class="sc-actions">
                  <a class="btn btn-primary btn-sm" href="#tvdb"><i class="fas fa-sliders-h"></i> <span>Configure</span></a>
                  <a class="btn btn-sm btn-ghost" href="https://thetvdb.com/" target="_blank" rel="noopener"><i class="fas fa-book"></i> <span>Docs</span></a>
                </div>
              </div>

              
            </section>

          </div>
        </div>
      </section>

      <!-- Plex Panel -->
      <section class="panel" id="panel-plex">
        <header class="panel-header">
          <h2><i class="fas fa-film"></i> Plex</h2>
          <div class="panel-actions">
            <span class="status-pill" id="plex-status-pill-header" title="Plex configuration status">Not configured</span>
            <span class="status-pill" id="plex-count-pill" title="Change ratings/genres/quality chips or year fields → the “Items: N” pill updates immediately using the cached playlist">Items: —</span>
            <a href="#" id="plex-open-link" class="header-link" title="Open Plex Web UI" hidden aria-label="Open Plex Web UI" target="_blank" rel="noopener"><i class="fas fa-globe"></i></a>
            <label class="header-toggle" for="plex.enabled" title="Enable Plex source">
              <input type="checkbox" id="plex.enabled" />
              <span class="ht-switch" aria-hidden="true"></span>
              <span class="ht-text">Enabled</span>
            </label>
            <button class="btn btn-icon btn-sm" id="btn-plex-test" title="Test connection"><i class="fas fa-vial"></i></button>
            <button class="btn btn-icon btn-sm" id="btn-plex-libraries" title="Fetch libraries"><i class="fas fa-list"></i></button>
            <button class="btn btn-primary btn-sm" id="btn-save-plex" title="Save Plex settings"><i class="fas fa-save"></i><span>Save Settings</span></button>
          </div>
        </header>
        <div class="panel-content">
          <div class="loading-overlay" aria-hidden="true">
            <div class="glass"></div>
            <div class="loader"><span class="spinner"></span></div>
          </div>
          <!-- Connection -->
          <div class="form-section">
            <div class="section-title"><i class="fas fa-server"></i> Server</div>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label for="plex.hostname">Hostname</label>
              <input type="text" id="plex.hostname" placeholder="e.g. 192.168.1.10" autocomplete="off" autocapitalize="off" spellcheck="false">
            </div>
            <div class="form-group">
              <label for="plex.port">Port</label>
              <input type="number" id="plex.port" min="1" max="65535" placeholder="32400" autocomplete="off">
            </div>
            <div class="form-group">
              <label for="plex.token">API Token</label>
              <input type="password" id="plex.token" placeholder="X-Plex-Token" autocomplete="new-password">
              <small class="form-help">Stored in environment. Not shown after save.</small>
            </div>
          </div>

          <!-- Libraries -->
          <div class="form-section">
            <div class="section-title"><i class="fas fa-list"></i> Libraries</div>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label for="plex.movies">Movie Libraries</label>
              <select id="plex.movies" multiple style="display:none"></select>
              <div class="multiselect" id="plex-ms-movies">
                <div class="ms-control" role="combobox" aria-expanded="false" aria-haspopup="listbox">
                  <div class="ms-chips" id="plex-ms-movies-chips"></div>
                  <button class="ms-clear" id="plex-ms-movies-clear" title="Clear selection"><i class="fas fa-xmark"></i></button>
                  <i class="fas fa-chevron-down ms-caret" aria-hidden="true"></i>
                </div>
                <div class="ms-menu" id="plex-ms-movies-menu" role="listbox">
                  <div class="ms-search">
                    <i class="fas fa-search"></i>
                    <input id="plex-ms-movies-search" type="text" placeholder="Search libraries…">
                  </div>
                  <div class="ms-actions">
                    <button class="btn btn-outline btn-sm" id="plex-ms-movies-select-all"><i class="fas fa-square-check"></i> Select all</button>
                    <button class="btn btn-outline btn-sm" id="plex-ms-movies-clear-all"><i class="fas fa-eraser"></i> Clear</button>
                  </div>
                  <div class="ms-options" id="plex-ms-movies-options"></div>
                </div>
              </div>
            </div>
            <div class="form-group">
              <label for="plex.shows">Show Libraries</label>
              <select id="plex.shows" multiple style="display:none"></select>
              <div class="multiselect" id="plex-ms-shows">
                <div class="ms-control" role="combobox" aria-expanded="false" aria-haspopup="listbox">
                  <div class="ms-chips" id="plex-ms-shows-chips"></div>
                  <button class="ms-clear" id="plex-ms-shows-clear" title="Clear selection"><i class="fas fa-xmark"></i></button>
                  <i class="fas fa-chevron-down ms-caret" aria-hidden="true"></i>
                </div>
                <div class="ms-menu" id="plex-ms-shows-menu" role="listbox">
                  <div class="ms-search">
                    <i class="fas fa-search"></i>
                    <input id="plex-ms-shows-search" type="text" placeholder="Search libraries…">
                  </div>
                  <div class="ms-actions">
                    <button class="btn btn-outline btn-sm" id="plex-ms-shows-select-all"><i class="fas fa-square-check"></i> Select all</button>
                    <button class="btn btn-outline btn-sm" id="plex-ms-shows-clear-all"><i class="fas fa-eraser"></i> Clear</button>
                  </div>
                  <div class="ms-options" id="plex-ms-shows-options"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Years -->
          <div class="form-section">
            <div class="section-title"><i class="fas fa-filter"></i> Filters</div>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label for="plex.yearFilter">Release Years</label>
              <input type="text" id="plex.yearFilter" inputmode="numeric" placeholder="e.g. 1995, 1998, 2015-2025">
            </div>
          </div>

          <!-- Ratings + Genres -->
          <div class="form-grid">
            <div class="form-group">
              <label for="plex.ratingFilter">Ratings</label>
              <input type="hidden" id="plex.ratingFilter-hidden" value="">
              <div class="multiselect" id="plex-ms-ratings">
                <div class="ms-control" role="combobox" aria-expanded="false" aria-haspopup="listbox">
                  <div class="ms-chips" id="plex-ms-ratings-chips"></div>
                  <button class="ms-clear" id="plex-ms-ratings-clear" title="Clear selection"><i class="fas fa-xmark"></i></button>
                  <i class="fas fa-chevron-down ms-caret" aria-hidden="true"></i>
                </div>
                <div class="ms-menu" id="plex-ms-ratings-menu" role="listbox">
                  <div class="ms-search">
                    <i class="fas fa-search"></i>
                    <input id="plex-ms-ratings-search" type="text" placeholder="Search ratings…">
                  </div>
                  <div class="ms-actions">
                    <button class="btn btn-outline btn-sm" id="plex-ms-ratings-select-all"><i class="fas fa-square-check"></i> Select all</button>
                    <button class="btn btn-outline btn-sm" id="plex-ms-ratings-clear-all"><i class="fas fa-eraser"></i> Clear</button>
                  </div>
                  <div class="ms-options" id="plex-ms-ratings-options"></div>
                </div>
              </div>
              <small class="form-help">Select one or more content ratings. Populated from Plex.</small>
            </div>
            <div class="form-group">
              <label for="plex.genreFilter">Genres</label>
              <input type="hidden" id="plex.genreFilter-hidden" value="">
              <div class="multiselect" id="plex-ms-genres">
                <div class="ms-control" role="combobox" aria-expanded="false" aria-haspopup="listbox">
                  <div class="ms-chips" id="plex-ms-genres-chips"></div>
                  <button class="ms-clear" id="plex-ms-genres-clear" title="Clear selection"><i class="fas fa-xmark"></i></button>
                  <i class="fas fa-chevron-down ms-caret" aria-hidden="true"></i>
                </div>
                <div class="ms-menu" id="plex-ms-genres-menu" role="listbox">
                  <div class="ms-search">
                    <i class="fas fa-search"></i>
                    <input id="plex-ms-genres-search" type="text" placeholder="Search genres…">
                  </div>
                  <div class="ms-actions">
                    <button class="btn btn-outline btn-sm" id="plex-ms-genres-select-all"><i class="fas fa-square-check"></i> Select all</button>
                    <button class="btn btn-outline btn-sm" id="plex-ms-genres-clear-all"><i class="fas fa-eraser"></i> Clear</button>
                  </div>
                  <div class="ms-options" id="plex-ms-genres-options"></div>
                </div>
              </div>
              <small id="plex-genre-help" class="form-help">Select one or more genres. Populated from Plex.</small>
            </div>
          </div>

          <!-- Qualities -->
          <div class="form-grid">
            <div class="form-group">
              <label for="plex.qualityFilter">Qualities</label>
              <input type="hidden" id="plex.qualityFilter-hidden" value="">
              <div class="multiselect" id="plex-ms-qualities">
                <div class="ms-control" role="combobox" aria-expanded="false" aria-haspopup="listbox">
                  <div class="ms-chips" id="plex-ms-qualities-chips"></div>
                  <button class="ms-clear" id="plex-ms-qualities-clear" title="Clear selection"><i class="fas fa-xmark"></i></button>
                  <i class="fas fa-chevron-down ms-caret" aria-hidden="true"></i>
                </div>
                <div class="ms-menu" id="plex-ms-qualities-menu" role="listbox">
                  <div class="ms-search">
                    <i class="fas fa-search"></i>
                    <input id="plex-ms-qualities-search" type="text" placeholder="Search qualities…">
                  </div>
                  <div class="ms-actions">
                    <button class="btn btn-outline btn-sm" id="plex-ms-qualities-select-all"><i class="fas fa-square-check"></i> Select all</button>
                    <button class="btn btn-outline btn-sm" id="plex-ms-qualities-clear-all"><i class="fas fa-eraser"></i> Clear</button>
                  </div>
                  <div class="ms-options" id="plex-ms-qualities-options"></div>
                </div>
              </div>
              <small class="form-help">Select one or more qualities (e.g., 720p, 1080p, 4K). Populated from Plex.</small>
            </div>
          </div>
          
            <!-- Recently-added controls moved to bottom of Plex panel -->
            <div class="form-grid">
              <div class="form-group">
                <label class="checkbox"><input type="checkbox" id="plex.recentOnly"><span class="checkmark"></span><span>Recently added only</span></label>
              </div>
              <div class="form-group">
                <label for="plex.recentDays">Recently added days</label>
                <input type="number" id="plex.recentDays" min="1" max="365" placeholder="30">
              </div>
            </div>
        </div>
      </section>

      <!-- Jellyfin Panel -->
      <section class="panel" id="panel-jellyfin" hidden>
        <header class="panel-header">
          <h2><i class="fas fa-play"></i> Jellyfin</h2>
          <div class="panel-actions">
            <span class="status-pill" id="jf-status-pill-header" title="Jellyfin configuration status">Not configured</span>
            <span class="status-pill" id="jf-count-pill" title="Change ratings/genres/quality chips or year fields → the “Items: N” pill updates immediately using the cached playlist">Items: —</span>
            <a href="#" id="jf-open-link" class="header-link" title="Open Jellyfin Web UI" hidden aria-label="Open Jellyfin Web UI" target="_blank" rel="noopener"><i class="fas fa-globe"></i></a>
            <label class="header-toggle" for="jf.enabled" title="Enable Jellyfin source">
              <input type="checkbox" id="jf.enabled" />
              <span class="ht-switch" aria-hidden="true"></span>
              <span class="ht-text">Enabled</span>
            </label>
            <button class="btn btn-icon btn-sm" id="btn-jf-test" title="Test connection"><i class="fas fa-vial"></i></button>
            <button class="btn btn-icon btn-sm" id="btn-jf-libraries" title="Fetch libraries"><i class="fas fa-list"></i></button>
            <button class="btn btn-primary btn-sm" id="btn-save-jellyfin" title="Save Jellyfin settings"><i class="fas fa-save"></i><span>Save Settings</span></button>
          </div>
        </header>
        <div class="panel-content">
          <div class="loading-overlay" aria-hidden="true">
            <div class="glass"></div>
            <div class="loader"><span class="spinner"></span></div>
          </div>
          <div class="form-section">
            <div class="section-title"><i class="fas fa-server"></i> Server</div>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label for="jf.hostname">Hostname</label>
              <input type="text" id="jf.hostname" placeholder="e.g. 192.168.1.20" autocomplete="off" autocapitalize="off" spellcheck="false">
            </div>
            <div class="form-group">
              <label for="jf.port">Port</label>
              <input type="number" id="jf.port" min="1" max="65535" placeholder="8096" autocomplete="off">
            </div>
            <div class="form-group">
              <label for="jf.apikey">API Key</label>
              <input type="password" id="jf.apikey" placeholder="Jellyfin API Key" autocomplete="new-password">
              <small class="form-help">Stored in environment. Not shown after save.</small>
            </div>
            <div class="form-group">
              <label class="header-toggle" for="jf.insecureHttps" title="Allow insecure HTTPS (self-signed)">
                <input type="checkbox" id="jf.insecureHttps" />
                <span class="ht-switch" aria-hidden="true"></span>
                <span class="ht-text">Insecure HTTPS</span>
              </label>
              <small class="form-help">Use for testing with self-signed certs (e.g., HTTPS on port 8920).</small>
            </div>
          </div>
          <div class="form-section">
            <div class="section-title"><i class="fas fa-list"></i> Libraries</div>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label for="jf.movies">Movie Libraries</label>
              <select id="jf.movies" multiple style="display:none"></select>
              <div class="multiselect" id="jf-ms-movies">
                <div class="ms-control" role="combobox" aria-expanded="false" aria-haspopup="listbox">
                  <div class="ms-chips" id="jf-ms-movies-chips"></div>
                  <button class="ms-clear" id="jf-ms-movies-clear" title="Clear selection"><i class="fas fa-xmark"></i></button>
                  <i class="fas fa-chevron-down ms-caret" aria-hidden="true"></i>
                </div>
                <div class="ms-menu" id="jf-ms-movies-menu" role="listbox">
                  <div class="ms-search">
                    <i class="fas fa-search"></i>
                    <input id="jf-ms-movies-search" type="text" placeholder="Search libraries…">
                  </div>
                  <div class="ms-actions">
                    <button class="btn btn-outline btn-sm" id="jf-ms-movies-select-all"><i class="fas fa-square-check"></i> Select all</button>
                    <button class="btn btn-outline btn-sm" id="jf-ms-movies-clear-all"><i class="fas fa-eraser"></i> Clear</button>
                  </div>
                  <div class="ms-options" id="jf-ms-movies-options"></div>
                </div>
              </div>
            </div>
            <div class="form-group">
              <label for="jf.shows">Show Libraries</label>
              <select id="jf.shows" multiple style="display:none"></select>
              <div class="multiselect" id="jf-ms-shows">
                <div class="ms-control" role="combobox" aria-expanded="false" aria-haspopup="listbox">
                  <div class="ms-chips" id="jf-ms-shows-chips"></div>
                  <button class="ms-clear" id="jf-ms-shows-clear" title="Clear selection"><i class="fas fa-xmark"></i></button>
                  <i class="fas fa-chevron-down ms-caret" aria-hidden="true"></i>
                </div>
                <div class="ms-menu" id="jf-ms-shows-menu" role="listbox">
                  <div class="ms-search">
                    <i class="fas fa-search"></i>
                    <input id="jf-ms-shows-search" type="text" placeholder="Search libraries…">
                  </div>
                  <div class="ms-actions">
                    <button class="btn btn-outline btn-sm" id="jf-ms-shows-select-all"><i class="fas fa-square-check"></i> Select all</button>
                    <button class="btn btn-outline btn-sm" id="jf-ms-shows-clear-all"><i class="fas fa-eraser"></i> Clear</button>
                  </div>
                  <div class="ms-options" id="jf-ms-shows-options"></div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="form-section">
            <div class="section-title"><i class="fas fa-filter"></i> Filters</div>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label for="jf.yearFilter">Release Years</label>
              <input type="text" id="jf.yearFilter" inputmode="numeric" placeholder="e.g. 1995, 1998, 2015-2025">
            </div>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label for="jf.ratingFilter">Ratings</label>
              <input type="hidden" id="jf.ratingFilter-hidden" value="">
              <div class="multiselect" id="jf-ms-ratings">
                <div class="ms-control" role="combobox" aria-expanded="false" aria-haspopup="listbox">
                  <div class="ms-chips" id="jf-ms-ratings-chips"></div>
                  <button class="ms-clear" id="jf-ms-ratings-clear" title="Clear selection"><i class="fas fa-xmark"></i></button>
                  <i class="fas fa-chevron-down ms-caret" aria-hidden="true"></i>
                </div>
                <div class="ms-menu" id="jf-ms-ratings-menu" role="listbox">
                  <div class="ms-search">
                    <i class="fas fa-search"></i>
                    <input id="jf-ms-ratings-search" type="text" placeholder="Search ratings…">
                  </div>
                  <div class="ms-actions">
                    <button class="btn btn-outline btn-sm" id="jf-ms-ratings-select-all"><i class="fas fa-square-check"></i> Select all</button>
                    <button class="btn btn-outline btn-sm" id="jf-ms-ratings-clear-all"><i class="fas fa-eraser"></i> Clear</button>
                  </div>
                  <div class="ms-options" id="jf-ms-ratings-options"></div>
                </div>
              </div>
              <small class="form-help">Select one or more content ratings. Populated from Jellyfin.</small>
            </div>
            <div class="form-group">
              <label for="jf.genreFilter">Genres</label>
              <input type="hidden" id="jf.genreFilter-hidden" value="">
              <div class="multiselect" id="jf-ms-genres">
                <div class="ms-control" role="combobox" aria-expanded="false" aria-haspopup="listbox">
                  <div class="ms-chips" id="jf-ms-genres-chips"></div>
                  <button class="ms-clear" id="jf-ms-genres-clear" title="Clear selection"><i class="fas fa-xmark"></i></button>
                  <i class="fas fa-chevron-down ms-caret" aria-hidden="true"></i>
                </div>
                <div class="ms-menu" id="jf-ms-genres-menu" role="listbox">
                  <div class="ms-search">
                    <i class="fas fa-search"></i>
                    <input id="jf-ms-genres-search" type="text" placeholder="Search genres…">
                  </div>
                  <div class="ms-actions">
                    <button class="btn btn-outline btn-sm" id="jf-ms-genres-select-all"><i class="fas fa-square-check"></i> Select all</button>
                    <button class="btn btn-outline btn-sm" id="jf-ms-genres-clear-all"><i class="fas fa-eraser"></i> Clear</button>
                  </div>
                  <div class="ms-options" id="jf-ms-genres-options"></div>
                </div>
              </div>
              <small class="form-help">Select one or more genres. Populated from selected Jellyfin libraries.</small>
            </div>
          </div>
          <!-- Jellyfin Qualities hidden (disabled feature) -->
          <div class="form-grid" style="display:none">
            <div class="form-group">
              <label for="jf.qualityFilter">Qualities</label>
              <input type="hidden" id="jf.qualityFilter-hidden" value="">
              <div class="multiselect" id="jf-ms-qualities"></div>
              <small class="form-help">Qualities disabled for Jellyfin</small>
            </div>
          </div>
          <!-- Recently-added controls moved to bottom of Jellyfin panel -->
          <div class="form-grid">
            <div class="form-group">
              <label class="checkbox"><input type="checkbox" id="jf.recentOnly"><span class="checkmark"></span><span>Recently added only</span></label>
            </div>
            <div class="form-group">
              <label for="jf.recentDays">Recently added days</label>
              <input type="number" id="jf.recentDays" min="1" max="365" placeholder="30">
            </div>
          </div>
        </div>
      </section>

      <!-- TMDB Panel -->
      <section class="panel" id="panel-tmdb">
        <header class="panel-header">
          <h2><i class="fas fa-database"></i> TMDB</h2>
          <div class="panel-actions">
            <span class="status-pill" id="tmdb-status-pill-header" title="TMDB configuration status">Not configured</span>
            <span class="status-pill" id="tmdb-count-pill" title="Items from TMDB in the current playlist">Items: —</span>
            <label class="header-toggle" for="tmdb.enabled" title="Enable TMDB source">
              <input type="checkbox" id="tmdb.enabled" />
              <span class="ht-switch" aria-hidden="true"></span>
              <span class="ht-text">Enabled</span>
            </label>
            <button class="btn btn-icon btn-sm" id="btn-tmdb-test" title="Test connection"><i class="fas fa-vial"></i></button>
            <button class="btn btn-primary btn-sm" id="btn-save-tmdb" title="Save TMDB settings"><i class="fas fa-save"></i><span>Save Settings</span></button>
          </div>
        </header>
        <div class="panel-content">
          <div class="loading-overlay" aria-hidden="true">
            <div class="glass"></div>
            <div class="loader"><span class="spinner"></span></div>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label for="tmdb.apikey">API Key</label>
              <input type="password" id="tmdb.apikey" placeholder="TMDB API Key" autocomplete="new-password">
            </div>
            <div class="form-group">
              <label for="tmdb.category">Category</label>
              <div class="select-wrap">
                <span class="select-icon" id="tmdb-category-icon"><i class="fas fa-fire"></i></span>
                <select id="tmdb.category">
                  <optgroup label="Movies">
                    <option value="popular">Popular Movies</option>
                    <option value="top_rated">Top Rated Movies</option>
                    <option value="now_playing">Now Playing</option>
                    <option value="upcoming">Upcoming Movies</option>
                    <option value="latest">Latest Movies</option>
                  </optgroup>
                  <optgroup label="TV Shows">
                    <option value="tv_popular">Popular TV Shows</option>
                    <option value="tv_top_rated">Top Rated TV Shows</option>
                    <option value="tv_on_the_air">Currently Airing</option>
                    <option value="tv_airing_today">Airing Today</option>
                    <option value="tv_latest">Latest TV Shows</option>
                  </optgroup>
                  <optgroup label="Trending">
                    <option value="trending_all_day">Trending Today (All)</option>
                    <option value="trending_movie_day">Trending Movies (Day)</option>
                    <option value="trending_tv_day">Trending TV (Day)</option>
                    <option value="trending_all_week">Trending Week (All)</option>
                    <option value="trending_movie_week">Trending Movies (Week)</option>
                    <option value="trending_tv_week">Trending TV (Week)</option>
                  </optgroup>
                  <optgroup label="Collections">
                    <option value="discover_movie">Discover Movies</option>
                    <option value="discover_tv">Discover TV Shows</option>
                  </optgroup>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label for="tmdb.minRating">Min Rating</label>
              <input type="number" id="tmdb.minRating" min="0" max="10" step="0.1" placeholder="0">
            </div>
            <div class="form-group">
              <label for="tmdb.yearFilter">Release Years</label>
              <input type="text" id="tmdb.yearFilter" inputmode="numeric" placeholder="e.g. 1995, 1998, 2015-2025">
              
            </div>
          </div>
            <div class="form-grid">
              <div class="form-group" style="grid-column: 1 / -1;">
                <label>Genres</label>
                <input type="hidden" id="tmdb.genreFilter-hidden" value="">
                <div class="multiselect" id="tmdb-ms-genres">
                  <div class="ms-control" role="combobox" aria-expanded="false" aria-haspopup="listbox">
                    <div class="ms-chips" id="tmdb-ms-genres-chips"></div>
                    <button class="ms-clear" id="tmdb-ms-genres-clear" title="Clear selection"><i class="fas fa-xmark"></i></button>
                    <i class="fas fa-chevron-down ms-caret" aria-hidden="true"></i>
                  </div>
                  <div class="ms-menu" id="tmdb-ms-genres-menu" role="listbox">
                    <div class="ms-search">
                      <i class="fas fa-search"></i>
                      <input id="tmdb-ms-genres-search" type="text" placeholder="Search genres…">
                    </div>
                    <div class="ms-actions">
                      <button class="btn btn-outline btn-sm" id="tmdb-ms-genres-select-all"><i class="fas fa-square-check"></i> Select all</button>
                      <button class="btn btn-outline btn-sm" id="tmdb-ms-genres-clear-all"><i class="fas fa-eraser"></i> Clear</button>
                    </div>
                    <div class="ms-options" id="tmdb-ms-genres-options"></div>
                  </div>
                </div>
                <small id="tmdb-genre-help" class="form-help">Select one or more genres. Populated from TMDB.</small>
              </div>
            </div>

          <!-- Streaming Releases (TMDB-based) -->
          <div class="form-divider" aria-hidden="true"></div>
          <section class="subpanel" id="subpanel-streaming">
            <header class="subpanel-header">
              <h3>
                <i class="fas fa-stream" aria-hidden="true"></i>
                <span>Streaming Releases</span>
              </h3>
              <div class="panel-actions">
                <label class="header-toggle" for="streamingSources.enabled" title="Enable Streaming Releases">
                  <input type="checkbox" id="streamingSources.enabled" />
                  <span class="ht-switch" aria-hidden="true"></span>
                  <span class="ht-text">Enabled</span>
                </label>
                <button class="btn btn-icon btn-sm" id="test-streaming-button" title="Test Streaming"><i class="fas fa-vial"></i></button>
              </div>
            </header>
            <div class="subpanel-body">
              <div class="subtle">Add latest releases from popular streaming platforms using TMDB's provider data.</div>
              <small id="streaming-connection-status" class="form-help"></small>
          
          <div class="form-grid">
            <div class="form-group" style="grid-column: 1 / -1;">
              <label>Streaming Providers</label>
              <select id="streaming.providers" multiple style="display:none"></select>
              <div class="multiselect" id="streaming-ms-providers">
                <div class="ms-control" role="combobox" aria-expanded="false" aria-haspopup="listbox">
                  <div class="ms-chips" id="streaming-ms-providers-chips"></div>
                  <div class="placeholder">Select streaming providers</div>
                  <i class="fas fa-chevron-down ms-caret" aria-hidden="true"></i>
                </div>
                <div class="ms-menu" id="streaming-ms-providers-menu" role="listbox">
                  <div class="ms-actions">
                    <input type="text" id="streaming-ms-providers-search" placeholder="Search providers" aria-label="Search providers">
                    <div class="ms-actions-buttons">
                      <button class="btn btn-outline btn-sm" id="streaming-ms-providers-select-all"><i class="fas fa-plus"></i> Select all</button>
                      <button class="btn btn-outline btn-sm" id="streaming-ms-providers-clear-all"><i class="fas fa-eraser"></i> Clear</button>
                    </div>
                  </div>
                  <div class="ms-options" id="streaming-ms-providers-options"></div>
                </div>
              </div>
            </div>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label class="checkbox"><input type="checkbox" id="streamingSources.newReleases"><span class="checkmark"></span><span>New Releases (Selected)</span></label>
            </div>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label for="streamingSources.region">Region</label>
              <select id="streamingSources.region">
                <option value="US">🇺🇸 United States</option>
                <option value="NL">🇳🇱 Netherlands</option>
                <option value="GB">🇬🇧 United Kingdom</option>
                <option value="DE">🇩🇪 Germany</option>
                <option value="FR">🇫🇷 France</option>
                <option value="CA">🇨🇦 Canada</option>
                <option value="AU">🇦🇺 Australia</option>
                <option value="ES">🇪🇸 Spain</option>
                <option value="IT">🇮🇹 Italy</option>
                <option value="BR">🇧🇷 Brazil</option>
                <option value="MX">🇲🇽 Mexico</option>
                <option value="AR">🇦🇷 Argentina</option>
                <option value="JP">🇯🇵 Japan</option>
                <option value="KR">🇰🇷 South Korea</option>
                <option value="IN">🇮🇳 India</option>
                <option value="CN">🇨🇳 China</option>
                <option value="RU">🇷🇺 Russia</option>
                <option value="BE">🇧🇪 Belgium</option>
                <option value="AT">🇦🇹 Austria</option>
                <option value="CH">🇨🇭 Switzerland</option>
                <option value="SE">🇸🇪 Sweden</option>
                <option value="NO">🇳🇴 Norway</option>
                <option value="DK">🇩🇰 Denmark</option>
                <option value="FI">🇫🇮 Finland</option>
                <option value="PL">🇵🇱 Poland</option>
                <option value="CZ">🇨🇿 Czech Republic</option>
                <option value="HU">🇭🇺 Hungary</option>
                <option value="PT">🇵🇹 Portugal</option>
                <option value="GR">🇬🇷 Greece</option>
                <option value="TR">🇹🇷 Turkey</option>
                <option value="IL">🇮🇱 Israel</option>
                <option value="ZA">🇿🇦 South Africa</option>
                <option value="EG">🇪🇬 Egypt</option>
                <option value="SA">🇸🇦 Saudi Arabia</option>
                <option value="AE">🇦🇪 United Arab Emirates</option>
                <option value="TH">🇹🇭 Thailand</option>
                <option value="SG">🇸🇬 Singapore</option>
                <option value="MY">🇲🇾 Malaysia</option>
                <option value="ID">🇮🇩 Indonesia</option>
                <option value="PH">🇵🇭 Philippines</option>
                <option value="VN">🇻🇳 Vietnam</option>
                <option value="TW">🇹🇼 Taiwan</option>
                <option value="HK">🇭🇰 Hong Kong</option>
                <option value="NZ">🇳🇿 New Zealand</option>
                <option value="CL">🇨🇱 Chile</option>
                <option value="CO">🇨🇴 Colombia</option>
                <option value="PE">🇵🇪 Peru</option>
                <option value="VE">🇻🇪 Venezuela</option>
                <option value="UY">🇺🇾 Uruguay</option>
                <option value="EC">🇪🇨 Ecuador</option>
                <option value="BO">🇧🇴 Bolivia</option>
                <option value="PY">🇵🇾 Paraguay</option>
              </select>
            </div>
          </div>
          
          <div class="form-grid">
            <div class="form-group">
              <label for="streamingSources.minRating">Minimum Rating (0-10)</label>
              <input type="number" id="streamingSources.minRating" min="0" max="10" step="0.1" placeholder="6.0">
            </div>
          </div>
            </div>
          </section>
        </div>
      </section>

      <!-- TVDB Panel -->
      <section class="panel" id="panel-tvdb">
        <header class="panel-header">
          <h2><i class="fas fa-tv"></i> TVDB</h2>
          <div class="panel-actions">
            <span class="status-pill" id="tvdb-status-pill-header" title="TVDB configuration status">Not configured</span>
            <span class="status-pill" id="tvdb-count-pill" title="Items from TVDB in the current playlist">Items: —</span>
            <label class="header-toggle" for="tvdb.enabled" title="Enable TVDB source">
              <input type="checkbox" id="tvdb.enabled" />
              <span class="ht-switch" aria-hidden="true"></span>
              <span class="ht-text">Enabled</span>
            </label>
            <button class="btn btn-icon btn-sm" id="btn-tvdb-test" title="Test connection"><i class="fas fa-vial"></i></button>
            <button class="btn btn-primary btn-sm" id="btn-save-tvdb" title="Save TVDB settings"><i class="fas fa-save"></i><span>Save Settings</span></button>
          </div>
        </header>
        <div class="panel-content">
          <div class="loading-overlay" aria-hidden="true">
            <div class="glass"></div>
            <div class="loader"><span class="spinner"></span></div>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label for="tvdb.category">Category</label>
              <div class="select-wrap">
                <span class="select-icon" id="tvdb-category-icon"><i class="fas fa-fire"></i></span>
                <select id="tvdb.category">
                <optgroup label="By Rating & Popularity">
                  <option value="top_rated">Top Rated</option>
                  <option value="popular">Most Popular</option>
                </optgroup>
                <optgroup label="By Date">
                  <option value="recently_updated">Recently Updated</option>
                  <option value="newest">Newest Releases</option>
                  <option value="oldest">Classic Content</option>
                </optgroup>
                <optgroup label="By Activity">
                  <option value="trending">Trending Now</option>
                  <option value="recently_added">Recently Added to TVDB</option>
                </optgroup>
                <optgroup label="Alphabetical">
                  <option value="alphabetical">A-Z Order</option>
                </optgroup>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label for="tvdb.minRating">Min Rating</label>
              <input type="number" id="tvdb.minRating" min="0" max="10" step="0.1" placeholder="e.g. 7.0">
            </div>
            <div class="form-group">
              <label for="tvdb.yearFilter">Release Years</label>
              <input type="text" id="tvdb.yearFilter" inputmode="numeric" placeholder="e.g. 1995, 1998, 2015-2025">
              
            </div>
          </div>
        </div>
      </section>
    </section>

    <!-- Devices Section (top-level sibling) -->
    <section id="section-devices" class="app-section" hidden>
      <section class="panel" id="device-ui">
        <header class="panel-header">
          <div class="panel-title">
            <h2><i class="fas fa-laptop"></i> Device Management <span class="badge badge-error">BETA</span></h2>
            <div class="panel-subtitle">Manage devices, groups, and configuration presets</div>
          </div>
          <div class="panel-actions device-toolbar">
            <div class="dropdown">
              <button class="btn btn-outline btn-sm dropdown-toggle" id="device-filter-toggle">
                <i class="fas fa-filter"></i>
                Filter
                <i class="fas fa-chevron-down"></i>
              </button>
              <div class="dropdown-menu" id="device-filter-menu"></div>
            </div>
            <div class="dropdown">
              <button class="btn btn-outline btn-sm dropdown-toggle" id="device-actions-toggle">
                <i class="fas fa-gear"></i>
                Actions
                <i class="fas fa-chevron-down"></i>
              </button>
              <div class="dropdown-menu" id="device-actions-menu"></div>
            </div>
            <div class="search-box">
              <i class="fas fa-search"></i>
              <input id="device-search" type="text" placeholder="Search devices…">
            </div>
          </div>
        </header>
        <div class="panel-content">
          <div class="device-grid" id="device-grid">
            <!-- Device cards will be rendered dynamically from /api/devices -->
          </div>

          <div class="table-footer device-pagination">
            <div class="table-info" id="device-page-info">Showing 0 of 0 devices</div>
            <div class="pagination">
              <button class="btn btn-icon btn-sm" id="device-page-prev" aria-label="Previous page"><i class="fas fa-chevron-left"></i></button>
              <span class="page-numbers" id="device-page-numbers"></span>
              <button class="btn btn-icon btn-sm" id="device-page-next" aria-label="Next page"><i class="fas fa-chevron-right"></i></button>
              <div class="per-page">
                <label for="device-per-page" class="sr-only">Per page</label>
                <select id="device-per-page">
                  <option value="6">6 / page</option>
                  <option value="9" selected>9 / page</option>
                  <option value="12">12 / page</option>
                  <option value="24">24 / page</option>
                </select>
              </div>
            </div>
          </div>
        </div>
      </section>
    </section>

    <!-- Operations Section (top-level sibling) -->
  <section id="section-operations" class="app-section" hidden>
    <section class="panel operations-panel">
        <header class="panel-header">
          <div style="display:flex; align-items:flex-start; justify-content:space-between; gap:10px; width:100%;">
            <div class="panel-title">
              <h2><i class="fas fa-screwdriver-wrench"></i> Operations</h2>
              <div class="panel-subtitle">Run media refresh and manage auto-updates</div>
            </div>
            <div class="panel-actions">
              <button type="button" id="btn-save-operations" class="btn btn-primary btn-sm" title="Save all operation settings">
                <i class="fas fa-save"></i><span>Save Settings</span>
              </button>
            </div>
          </div>
        </header>
        <div class="panel-content">
  <div class="content-grid" style="gap:12px;">
        <div class="ops-col">
          <div class="ops-group">
            <div class="ops-group-title"><i class="fas fa-download"></i> Updates</div>
          </div>
            <!-- Auto-Update Operations (moved to top-left) -->
            <section class="perf-card" aria-label="Automatic Updates">
              <h3><i class="fas fa-download"></i> Automatic Updates</h3>
              <div class="card-pill-spot">
                <span id="update-phase-text" class="status-pill status-info" style="display:none;">Checking…</span>
                <span id="update-progress-percent" class="status-pill" style="display:none;">0%</span>
                <span id="update-idle-pill" class="status-pill status-success">Ready</span>
              </div>
              <div class="card-subtext">Manage updates and view progress.</div>
              <div id="ops-update-status" class="status-display">
                <div id="update-idle-state"></div>
                <div id="update-progress-state" style="display:none;" class="mt-8">
                  <div class="meter mt-6">
                    <div id="update-progress-bar" style="width:0%; background: linear-gradient(90deg,#60a5fa,#1e40af);"></div>
                  </div>
                  <div id="update-message" class="subtle mt-6">Preparing…</div>
                </div>
              </div>
              <div class="actions main-actions">
                <button type="button" id="btn-start-update" class="btn btn-success btn-sm"><i class="fas fa-download"></i><span>Start Auto-Update</span></button>
                <button type="button" id="btn-rollback-update" class="btn btn-secondary btn-sm"><i class="fas fa-undo"></i><span>Rollback</span></button>
                <button type="button" id="btn-list-backups" class="btn btn-secondary btn-sm"><i class="fas fa-archive"></i><span>View Backups</span></button>
              </div>
              <div class="actions sub-actions">
                <div class="input-row">
                  <div class="form-group" style="margin:0;">
                    <input type="number" id="input-keep-backups" min="1" max="20" value="5" class="w-90" />
                  </div>
                  <button type="button" id="btn-cleanup-backups" class="btn btn-secondary btn-sm"><i class="fas fa-trash"></i><span>Cleanup Old</span></button>
                </div>
              </div>
              <div id="backups-display" class="status-display" style="display:none; margin-top:10px;">
                <div class="subtle" style="display:flex; align-items:center; gap:8px;"><i class="fas fa-archive"></i> Available Backups</div>
                <div id="backups-content" class="metric-row" style="margin-top:6px;">
                  <div class="subtle">Loading…</div>
                </div>
              </div>
      </section>
            <!-- Backups Group Title -->
            <div class="ops-group">
              <div class="ops-group-title"><i class="fas fa-folder-open"></i> Backups</div>
            </div>
            <!-- Config Backups (compact list) -->
            <section class="perf-card" aria-label="Config Backups">
              <h3><i class="fas fa-archive"></i> Config Backups</h3>
              <div class="card-pill-spot">
                <span id="cfg-backup-schedule-pill" class="status-pill status-warning">Disabled</span>
              </div>
              <div class="card-subtext">Create daily configuration backups and restore per file.</div>

              <div class="actions main-actions">
                <button type="button" id="btn-create-cfg-backup" class="btn btn-success btn-sm"><i class="fas fa-plus-circle"></i><span>Backup now</span></button>
                <div class="input-row">
                  <div class="form-group" style="margin:0;">
                    <input type="number" id="input-keep-cfg-backups" min="1" max="60" value="7" class="w-90" title="Number of backups to keep" />
                  </div>
                  <button type="button" id="btn-cleanup-cfg-backups" class="btn btn-secondary btn-sm"><i class="fas fa-broom"></i><span>Cleanup</span></button>
                </div>
              </div>

              <div class="actions sub-actions">
                <div class="inline-field">
                  <label for="input-cfg-backup-enabled" style="margin:0;display:inline-flex;align-items:center;padding-right:12px;">Daily schedule</label>
                  <label class="checkbox" style="margin-right:8px;">
                    <input type="checkbox" id="input-cfg-backup-enabled" />
                    <span class="checkmark"></span>
                    <span>Enabled</span>
                  </label>
                  <div class="time-input" title="Run time">
                    <i class="fas fa-clock" aria-hidden="true"></i>
                    <input type="time" id="input-cfg-backup-time" value="02:30" class="w-110" aria-label="Backup time" />
                  </div>
                  <button type="button" id="btn-save-cfg-backup-schedule" class="btn btn-primary btn-sm"><i class="fas fa-save"></i><span>Save</span></button>
                </div>
              </div>

              <div id="cfg-backup-list" class="compact-backup-list"></div>
            </section>
            <!-- Media Group Title -->
            <div class="ops-group">
              <div class="ops-group-title"><i class="fas fa-photo-video"></i> Media</div>
            </div>
            <!-- Media Operations -->
            <section class="perf-card" aria-label="Media Operations">
              <h3><i class="fas fa-sync-alt"></i> Media</h3>
              <div class="card-subtext">Refresh media from configured sources.</div>
              <div class="metric-row mt-6">
                <div class="form-group inline-field nowrap" style="display: block;">
                  <label for="ops.backgroundRefreshMinutes" style="margin:0;display:inline-flex;align-items:center;padding-right:12px; white-space:nowrap;">Background Refresh (minutes)</label>
                  <input type="number" id="ops.backgroundRefreshMinutes" min="5" max="1440" step="1" class="w-110" value="30" />
                </div>
              </div>
        <div class="actions main-actions">
                <button type="button" id="btn-refresh-media" class="btn btn-success btn-sm">
                  <i class="fas fa-sync-alt"></i><span>Refresh Media</span>
                </button>
              </div>
            </section>
            <!-- API Group Title (moved to left column) -->
            <div class="ops-group">
              <div class="ops-group-title"><i class="fas fa-plug"></i> API</div>
            </div>
            <!-- API Access (moved to left column) -->
            <section class="perf-card" aria-label="API Access Management">
              <h3><i class="fas fa-code"></i> API Access</h3>
              <div class="card-pill-spot">
                <span class="status-pill" id="api-key-status-pill">Key: <span id="api-key-status-text">Loading…</span></span>
              </div>
              <div class="card-subtext">Programmatic access to admin endpoints.</div>
              <div id="api-key-display" class="is-hidden mt-6">
                <div class="input-row">
                  <input id="api-key-input" type="password" readonly />
                  <div class="actions">
                    <button id="toggle-api-key-visibility-button" type="button" class="btn btn-icon btn-sm" title="Show/Hide"><i class="fas fa-eye"></i></button>
                    <button id="copy-api-key-button" type="button" class="btn btn-icon btn-sm" title="Copy to clipboard"><i class="fas fa-copy"></i></button>
                  </div>
                </div>
              </div>
              <div class="actions" style="margin-top:6px;">
                <button id="generate-api-key-button" type="button" class="btn btn-success btn-sm">
                  <i class="fas fa-key"></i>
                  <span>Generate New Key</span>
                </button>
                <button id="revoke-api-key-button" type="button" class="btn btn-error btn-sm" disabled>
                  <i class="fas fa-trash-alt"></i>
                  <span>Revoke Key</span>
                </button>
              </div>
            </section>
        </div>
  <div class="ops-col">
      <div class="ops-group">
        <div class="ops-group-title"><i class="fas fa-stethoscope"></i> Diagnostics</div>
      </div>
      <!-- Debug & Logging -->
            <section class="perf-card" aria-label="Debug & Logging">
              <h3><i class="fas fa-bug"></i> Debug & Logging</h3>
              <div class="card-pill-spot">
                <span class="status-pill" id="debug-status-pill">Debug: Off</span>
              </div>
              <div class="card-subtext">Detailed logging for troubleshooting.</div>
              <div class="metric-row mt-6">
                <div class="form-group checkbox-group">
                  <label class="checkbox" for="DEBUG">
                    <input type="checkbox" id="DEBUG" />
                    <span class="checkmark"></span>
                    <span>Enable Debug Mode</span>
                  </label>
                </div>
                <div class="micro-hint"><i class="fas fa-info-circle" aria-hidden="true"></i><span>Use temporarily; verbose logs can impact performance.</span></div>
              </div>
              <div class="actions mt-8">
                <a href="/logs.html" target="_blank" rel="noopener" class="btn btn-secondary btn-sm"><i class="fas fa-scroll"></i><span>Open Logs</span></a>
              </div>
            </section>
      <div class="ops-group">
        <div class="ops-group-title"><i class="fas fa-server"></i> Server</div>
      </div>
            <!-- Server Settings (under Server) -->
            <section class="perf-card" aria-label="Server Settings">
              <h3><i class="fas fa-gear"></i> Server</h3>
              <div class="card-subtext">Core server configuration.</div>
              <div class="metric-row">
                <div class="form-group inline-field nowrap" style="display: block;">
                  <label for="SERVER_PORT" style="margin:0;display:inline-flex;align-items:center;padding-right:12px;">Port</label>
                  <input type="number" id="SERVER_PORT" min="1024" max="65535" step="1" class="w-110" />
                </div>
              </div>
            </section>
  <!-- Promobox Site -->
            <section class="perf-card" aria-label="Promobox Site">
              <h3><i class="fas fa-bullhorn"></i> Promobox Site</h3>
              <div class="card-pill-spot">
                <span class="status-pill status-warning" id="siteServer-pill">Disabled</span>
              </div>
              <div class="card-subtext">Optional static poster showcase.</div>
              <div class="metric-row mt-6">
                <div class="form-group checkbox-group">
                  <label class="checkbox" for="siteServer.enabled">
                    <input type="checkbox" id="siteServer.enabled" />
                    <span class="checkmark"></span>
                    <span>Enable Promobox Site</span>
                  </label>
                </div>
                <div class="form-group inline-field nowrap" id="siteServerPortGroup" style="display:none;">
                  <label for="siteServer.port" style="margin:0;display:inline-flex;align-items:center;padding-right:12px;">Port</label>
                  <input type="number" id="siteServer.port" min="1024" max="65535" value="4001" class="w-110" />
                </div>
                <div id="siteServerStatus" class="subtle" style="display:none;"></div>
              </div>
            </section>

      
      
    </div>
          </div>
        </div>
      </section>
    </section>

  </main>

  <!-- Change Password Modal -->
  <div class="modal-overlay" id="modal-change-password">
    <div class="modal modal-sm" role="dialog" aria-modal="true" aria-labelledby="modal-change-password-title">
      <div class="modal-header">
        <div class="modal-title" id="modal-change-password-title"><i class="fas fa-key"></i> Change Password</div>
        <button class="modal-close" data-close-modal aria-label="Close"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body" style="text-align: center; padding: 24px;">
        
        <!-- Security icon and intro -->
        <div style="margin-bottom: 24px;">
          <div style="
            width: 64px; 
            height: 64px; 
            margin: 0 auto 16px auto; 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            background: linear-gradient(135deg, var(--color-primary), var(--color-accent));
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
          ">
            <i class="fas fa-key" style="font-size: 24px; color: white; text-shadow: 0 2px 4px rgba(0,0,0,0.3);"></i>
          </div>
          <h3 style="margin: 0 0 6px 0; font-size: 1.1rem; font-weight: 600;">Update Your Password</h3>
          <p style="margin: 0; font-size: 0.85rem; color: rgba(255,255,255,0.7); line-height: 1.4;">
            Choose a strong password to keep your account secure
          </p>
        </div>

        <!-- Password form section -->
        <div style="background: rgba(255,255,255,0.02); border-radius: 12px; padding: 20px; border: 1px solid rgba(255,255,255,0.06);">
          
          <!-- Current password -->
          <div style="margin-bottom: 16px; text-align: left;">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
              <i class="fas fa-unlock" style="color: var(--color-warning); font-size: 0.8rem;"></i>
              <span style="font-weight: 600; font-size: 0.85rem;">Current Password</span>
            </div>
            <input 
              type="password" 
              id="input-current-password" 
              autocomplete="current-password" 
              placeholder="Enter your current password"
              style="
                width: 100%;
                padding: 10px 12px;
                border-radius: 6px;
                border: 2px solid rgba(255,255,255,0.1);
                background: rgba(255,255,255,0.05);
                color: white;
                font-size: 0.9rem;
                transition: border-color 0.2s ease;
              "
            />
          </div>
          
          <!-- New password -->
          <div style="margin-bottom: 16px; text-align: left;">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
              <i class="fas fa-lock" style="color: var(--color-success); font-size: 0.8rem;"></i>
              <span style="font-weight: 600; font-size: 0.85rem;">New Password</span>
            </div>
            <input 
              type="password" 
              id="input-new-password" 
              autocomplete="new-password" 
              placeholder="Enter a strong new password"
              style="
                width: 100%;
                padding: 10px 12px;
                border-radius: 6px;
                border: 2px solid rgba(255,255,255,0.1);
                background: rgba(255,255,255,0.05);
                color: white;
                font-size: 0.9rem;
                transition: border-color 0.2s ease;
              "
            />
          </div>
          
          <!-- Confirm password -->
          <div style="margin-bottom: 16px; text-align: left;">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
              <i class="fas fa-check-circle" style="color: var(--color-accent); font-size: 0.8rem;"></i>
              <span style="font-weight: 600; font-size: 0.85rem;">Confirm Password</span>
            </div>
            <input 
              type="password" 
              id="input-confirm-password" 
              autocomplete="new-password" 
              placeholder="Confirm your new password"
              style="
                width: 100%;
                padding: 10px 12px;
                border-radius: 6px;
                border: 2px solid rgba(255,255,255,0.1);
                background: rgba(255,255,255,0.05);
                color: white;
                font-size: 0.9rem;
                transition: border-color 0.2s ease;
              "
            />
          </div>

          <!-- Password strength indicator -->
          <div id="password-strength" style="margin-bottom: 12px; text-align: left; display: none;">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
              <i class="fas fa-shield-alt" style="font-size: 0.75rem; color: rgba(255,255,255,0.6);"></i>
              <span style="font-size: 0.75rem; font-weight: 600; color: rgba(255,255,255,0.8);">Password Strength</span>
            </div>
            <div style="display: flex; gap: 2px; margin-bottom: 6px;">
              <div class="strength-bar" style="height: 4px; flex: 1; background: rgba(255,255,255,0.1); border-radius: 2px;"></div>
              <div class="strength-bar" style="height: 4px; flex: 1; background: rgba(255,255,255,0.1); border-radius: 2px;"></div>
              <div class="strength-bar" style="height: 4px; flex: 1; background: rgba(255,255,255,0.1); border-radius: 2px;"></div>
              <div class="strength-bar" style="height: 4px; flex: 1; background: rgba(255,255,255,0.1); border-radius: 2px;"></div>
            </div>
            <div id="strength-text" style="font-size: 0.7rem; color: rgba(255,255,255,0.6);"></div>
          </div>

          <!-- Status message -->
          <div id="password-status" class="status-message" style="display: none; margin-top: 12px;"></div>
        </div>
      </div>
      
      <div class="modal-footer" style="display: flex; gap: 12px; justify-content: flex-end; padding: 16px 24px;">
        <button type="button" class="btn btn-outline" data-close-modal style="min-width: 80px;">Cancel</button>
        <button type="button" id="btn-change-password" class="btn btn-primary" style="min-width: 140px;">
          <i class="fas fa-key"></i><span>Change Password</span>
        </button>
      </div>
    </div>
  </div>

  <!-- 2FA Enable Modal (theme-demo structure) -->
  <div class="modal-overlay" id="modal-2fa">
    <div class="modal modal-md" role="dialog" aria-modal="true" aria-labelledby="modal-2fa-title">
      <div class="modal-header">
        <div class="modal-title" id="modal-2fa-title"><i class="fas fa-shield-alt"></i> Enable Two-Factor Authentication</div>
        <button class="modal-close" data-close-modal aria-label="Close"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body" style="text-align: center; padding: 24px;">
        
        <!-- Compact security icon and intro -->
        <div style="margin-bottom: 24px;">
          <div style="
            width: 60px; 
            height: 60px; 
            margin: 0 auto 16px auto; 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            background: linear-gradient(135deg, var(--color-success), var(--color-primary));
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
          ">
            <i class="fas fa-shield-alt" style="font-size: 24px; color: white; text-shadow: 0 2px 4px rgba(0,0,0,0.3);"></i>
          </div>
          <h3 style="margin: 0 0 6px 0; font-size: 1.1rem; font-weight: 600;">Secure Your Account</h3>
          <p style="margin: 0; font-size: 0.85rem; color: rgba(255,255,255,0.7); line-height: 1.4;">
            Add an extra layer of security with 2FA
          </p>
        </div>

        <!-- Compact steps in horizontal layout -->
        <div style="background: rgba(255,255,255,0.02); border-radius: 12px; padding: 20px; border: 1px solid rgba(255,255,255,0.06);">
          
          <!-- Two-column layout for steps -->
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; align-items: start;">
            
            <!-- Step 1: QR Code -->
            <div>
              <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px; justify-content: center;">
                <div style="
                  width: 24px; 
                  height: 24px; 
                  border-radius: 50%; 
                  background: var(--color-primary); 
                  display: flex; 
                  align-items: center; 
                  justify-content: center;
                  font-size: 0.75rem;
                  font-weight: 700;
                  color: white;
                ">1</div>
                <span style="font-weight: 600; font-size: 0.9rem;">Scan QR Code</span>
              </div>
              
              <div id="qr-code-container" style="
                background: white; 
                border-radius: 8px; 
                padding: 12px; 
                margin: 0 auto 8px auto; 
                display: inline-block;
                box-shadow: 0 3px 8px rgba(0,0,0,0.15);
              ">
                <div class="subtle" style="color: #666; font-size: 0.85rem;">Loading QR...</div>
              </div>
              
              <p style="font-size: 0.75rem; color: rgba(255,255,255,0.6); margin: 0; line-height: 1.3;">
                Use any TOTP app
              </p>
            </div>

            <!-- Step 2: Verification -->
            <div>
              <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px; justify-content: center;">
                <div style="
                  width: 24px; 
                  height: 24px; 
                  border-radius: 50%; 
                  background: var(--color-accent); 
                  display: flex; 
                  align-items: center; 
                  justify-content: center;
                  font-size: 0.75rem;
                  font-weight: 700;
                  color: white;
                ">2</div>
                <span style="font-weight: 600; font-size: 0.9rem;">Enter Code</span>
              </div>
              
              <div style="margin-top: 8px;">
                <input 
                  id="input-2fa-token" 
                  inputmode="numeric" 
                  autocomplete="one-time-code" 
                  placeholder="000 000" 
                  maxlength="7"
                  style="
                    width: 140px;
                    font-size: 1rem;
                    font-weight: 600;
                    text-align: center;
                    letter-spacing: 0.4em;
                    padding: 10px 12px;
                    border-radius: 6px;
                    border: 2px solid rgba(255,255,255,0.1);
                    background: rgba(255,255,255,0.05);
                    color: white;
                  " 
                />
              </div>
              
              <p style="font-size: 0.75rem; color: rgba(255,255,255,0.6); margin: 8px 0 0 0; line-height: 1.3;">
                6-digit verification code
              </p>
            </div>
          </div>
        </div>
      </div>
      
      <div class="modal-footer" style="display: flex; gap: 12px; justify-content: flex-end; padding: 16px 24px;">
        <button type="button" class="btn btn-outline" data-close-modal style="min-width: 80px;">Cancel</button>
        <button type="button" id="btn-2fa-verify" class="btn btn-success" style="min-width: 140px;">
          <i class="fas fa-check-circle"></i><span>Verify & Enable</span>
        </button>
      </div>
    </div>
  </div>

  <!-- 2FA Disable Modal (theme-demo structure) -->
  <div class="modal-overlay" id="modal-2fa-disable">
    <div class="modal modal-sm" role="dialog" aria-modal="true" aria-labelledby="modal-2fa-disable-title">
      <div class="modal-header">
        <div class="modal-title" id="modal-2fa-disable-title"><i class="fas fa-shield-alt"></i> Disable Two-Factor Authentication</div>
        <button class="modal-close" data-close-modal aria-label="Close"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body" style="text-align: center; padding: 20px;">
        
        <!-- Compact warning icon and message -->
        <div style="margin-bottom: 20px;">
          <div style="
            width: 60px; 
            height: 60px; 
            margin: 0 auto 12px auto; 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            background: linear-gradient(135deg, var(--color-warning), var(--color-error));
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
          ">
            <i class="fas fa-exclamation-triangle" style="font-size: 24px; color: white; text-shadow: 0 2px 4px rgba(0,0,0,0.3);"></i>
          </div>
          <h3 style="margin: 0 0 6px 0; font-size: 1.1rem; font-weight: 600;">Disable Two-Factor Auth</h3>
          <p style="margin: 0; font-size: 0.85rem; color: rgba(255,255,255,0.7); line-height: 1.4;">
            This will reduce your account security
          </p>
        </div>

        <!-- Compact password input section -->
        <div style="background: rgba(255,255,255,0.02); border-radius: 12px; padding: 16px; border: 1px solid rgba(255,255,255,0.06);">
          <div style="margin-bottom: 12px; text-align: left;">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
              <i class="fas fa-key" style="color: var(--color-warning); font-size: 0.8rem;"></i>
              <span style="font-weight: 600; font-size: 0.85rem;">Confirm with password</span>
            </div>
            <input 
              type="password" 
              id="input-2fa-disable-password" 
              autocomplete="current-password" 
              placeholder="Current password"
              style="
                width: 100%;
                padding: 10px 12px;
                border-radius: 6px;
                border: 2px solid rgba(255,255,255,0.1);
                background: rgba(255,255,255,0.05);
                color: white;
                font-size: 0.95rem;
              "
            />
          </div>
          
          <!-- Compact security warning -->
          <div style="
            background: rgba(var(--color-warning-rgb, 251, 191, 36), 0.1); 
            border: 1px solid rgba(var(--color-warning-rgb, 251, 191, 36), 0.2);
            border-radius: 6px; 
            padding: 8px; 
            text-align: left;
          ">
            <div style="display: flex; align-items: center; gap: 6px;">
              <i class="fas fa-info-circle" style="color: var(--color-warning); font-size: 0.75rem; flex-shrink: 0;"></i>
              <div style="font-size: 0.75rem; color: var(--color-warning); line-height: 1.3;">
                Your account will only be protected by password
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="modal-footer" style="display: flex; gap: 12px; justify-content: flex-end; padding: 16px 20px;">
        <button type="button" class="btn btn-outline" data-close-modal style="min-width: 80px;">Cancel</button>
        <button type="button" id="btn-2fa-disable-confirm" class="btn btn-error" style="min-width: 120px;">
          <i class="fas fa-shield-alt"></i><span>Disable 2FA</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Device Merge Modal (from theme-demo) -->
  <div class="modal-overlay" id="modal-merge">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-merge-title">
      <div class="modal-header">
        <div class="modal-title" id="modal-merge-title">
          <i class="fas fa-object-group"></i>
          Merge Devices
        </div>
        <button class="modal-close" data-close-modal><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
        <p>Select the source and target devices to merge histories and preferences. This cannot be undone.</p>
        <div class="form-grid" style="margin-top: var(--space-lg);">
          <div class="form-group">
            <label>Source Device</label>
            <select id="merge-source"></select>
          </div>
          <div class="form-group">
            <label>Target Device</label>
            <select id="merge-target"></select>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" data-close-modal>Cancel</button>
        <button class="btn btn-error" id="btn-merge-confirm">Merge</button>
      </div>
    </div>
  </div>

  <!-- Bulk Selection Bar (from theme-demo) -->
  <div class="bulk-bar" id="bulk-bar" aria-live="polite">
    <div class="bulk-inner">
      <div class="bulk-count"><strong id="bulk-count">0</strong> selected</div>
  <div class="bulk-actions">
        <button class="btn btn-warning btn-sm" id="bulk-poweroff" title="Power toggle"><i class="fas fa-power-off"></i></button>
        <button class="btn btn-secondary btn-sm bulk-secondary" id="bulk-reload" title="Reload devices"><i class="fas fa-rotate-right"></i></button>
        <button class="btn btn-secondary btn-sm bulk-secondary" id="bulk-clearcache" title="Clear caches"><i class="fas fa-broom"></i></button>
        <button class="btn btn-secondary btn-sm bulk-secondary" id="bulk-pair" title="Generate pairing code"><i class="fas fa-qrcode"></i></button>
        <button class="btn btn-secondary btn-sm bulk-secondary" id="bulk-override" title="Edit display settings override"><i class="fas fa-sliders"></i></button>
        <button class="btn btn-secondary btn-sm bulk-secondary" id="bulk-sendcmd" title="Send command"><i class="fas fa-terminal"></i></button>
  <button class="btn btn-secondary btn-sm" id="bulk-playpause" title="Play/Pause"><i class="fas fa-play"></i></button>
        <button class="btn btn-error btn-sm" id="bulk-delete" title="Delete selected"><i class="fas fa-trash"></i></button>
        <button class="btn btn-outline btn-sm" id="bulk-clear" title="Clear selection"><i class="fas fa-xmark"></i></button>
        <div class="dropdown">
          <button class="btn btn-icon btn-sm" id="bulk-more" title="More"><i class="fas fa-ellipsis"></i></button>
          <div class="dropdown-menu" id="bulk-more-menu"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Remote Control Modal -->
  <style>
    /* Scoped remote control styles */
  #modal-remote .modal { width: min(96vw, 520px); }
    #modal-remote .modal-body {
      padding: 14px 16px;
    }
  #modal-remote .modal-header .modal-title { font-weight: 500; }
    #modal-remote #remote-target-name {
      font-weight: 400;
      color: var(--color-text-secondary, #b5bcc9);
      display: inline-block;
      max-width: 100%;
      white-space: normal;
      word-break: break-word;
      line-height: 1.25;
      vertical-align: middle;
    }
    #modal-remote .remote-panel {
      display: grid;
      justify-content: center;
      gap: 12px;
    }
    #modal-remote .remote-nav {
      display: grid;
      grid-template-columns: repeat(3, 60px);
      grid-auto-rows: 60px;
      gap: 8px;
      justify-content: center;
      align-items: center;
    }
    #modal-remote .remote-actions {
      display: grid;
      grid-template-columns: repeat(3, 60px);
      gap: 10px;
      justify-content: center;
      align-items: center;
      margin-top: 4px;
    }
    #modal-remote .remote-panel .btn {
      width: 60px;
      height: 60px;
      border-radius: 10px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: var(--color-bg-elevated, rgba(255,255,255,0.06));
      border: 1px solid var(--color-border, rgba(255,255,255,0.12));
      color: var(--color-text-primary, #e6e6e6);
      box-shadow: none;
      transition: transform 100ms ease, background 100ms ease, color 100ms ease, border-color 100ms ease;
    }
    #modal-remote .remote-panel .btn:hover {
      background: rgba(255, 255, 255, 0.08);
      color: #fff;
    }
    #modal-remote .remote-panel .btn:active {
      transform: scale(0.96);
      background: rgba(0, 0, 0, 0.20);
    }
    /* Use default theme focus styles (no custom glow) */
    #modal-remote .remote-panel .btn i {
      font-size: 18px;
      pointer-events: none;
    }
  /* No special accent/select styling to keep it neutral per theme */
    /* Click pulse feedback */
    @keyframes remotePulse {
      0% { transform: scale(1); }
      50% { transform: scale(0.92); }
      100% { transform: scale(1); }
    }
    #modal-remote .remote-panel .btn.pulse {
      animation: remotePulse 180ms ease-out;
    }
  </style>
  <div class="modal-overlay" id="modal-remote">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="remote-title">
      <div class="modal-header">
        <div class="modal-title" id="remote-title"><i class="fas fa-gamepad"></i> Remote Control <span id="remote-target-name" style="opacity:.75"></span></div>
        <button class="modal-close" data-close-modal><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
        <!-- Remote panel: only implemented controls (D‑pad + Select + Back/Home + Play/Pause) -->
        <div class="remote-panel">
          <div class="remote-nav">
            <div></div>
            <button class="btn" data-remote="up" title="Up" aria-label="Up"><i class="fas fa-arrow-up"></i></button>
            <div></div>
            <button class="btn" data-remote="left" title="Left" aria-label="Left"><i class="fas fa-arrow-left"></i></button>
            <button class="btn" data-remote="select" title="Select" aria-label="Select"><i class="fas fa-dot-circle"></i></button>
            <button class="btn" data-remote="right" title="Right" aria-label="Right"><i class="fas fa-arrow-right"></i></button>
            <div></div>
            <button class="btn" data-remote="down" title="Down" aria-label="Down"><i class="fas fa-arrow-down"></i></button>
            <div></div>
          </div>
          <div class="remote-actions">
            <button class="btn" data-remote="back" title="Back" aria-label="Back"><i class="fas fa-arrow-rotate-left"></i></button>
            <button class="btn" data-remote="playpause" title="Play/Pause" aria-label="Play or Pause"><i class="fas fa-play"></i></button>
            <button class="btn" data-remote="home" title="Home" aria-label="Home"><i class="fas fa-house"></i></button>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" data-close-modal>Close</button>
      </div>
    </div>
  </div>

  <!-- Display Settings Override Modal -->
  <div class="modal-overlay" id="modal-override">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="override-title">
      <div class="modal-header">
        <div class="modal-title" id="override-title"><i class="fas fa-sliders"></i> Display Settings Override</div>
        <button class="modal-close" data-close-modal><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
        <p>Provide a JSON object to override display settings for the selected device(s).</p>
        <textarea id="override-json" rows="10" style="width:100%;" placeholder="{\n  \"wallart\": { \"duration\": 30 }\n}"></textarea>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" data-close-modal>Cancel</button>
        <button class="btn btn-primary" id="btn-override-apply"><i class="fas fa-check"></i> Apply</button>
      </div>
    </div>
  </div>

  <!-- Send Command Modal -->
  <div class="modal-overlay" id="modal-sendcmd">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="sendcmd-title" style="width:min(96vw, 560px)">
      <div class="modal-header">
        <div class="modal-title" id="sendcmd-title"><i class="fas fa-terminal"></i> Send Command</div>
        <button class="modal-close" data-close-modal><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body" style="padding:14px 16px;">
        <style>
          /* Scoped styling for Send Command modal inputs */
          #modal-sendcmd .form-group label { font-weight: 500; color: var(--color-text-primary, #e6e6e6); }
          #modal-sendcmd select, #modal-sendcmd input[type="text"], #modal-sendcmd textarea {
            width: 100%;
            background: var(--color-bg-elevated, rgba(255,255,255,0.06));
            color: var(--color-text-primary, #e6e6e6);
            border: 1px solid var(--color-border, rgba(255,255,255,0.12));
            border-radius: 8px;
            padding: 10px 12px;
          }
          #modal-sendcmd select:focus, #modal-sendcmd input[type="text"]:focus, #modal-sendcmd textarea:focus {
            outline: none;
            border-color: var(--color-border-strong, rgba(255,255,255,0.22));
          }
        </style>
        <div class="form-group">
          <label for="sendcmd-select">Command</label>
          <select id="sendcmd-select" style="width:100%">
            <option value="" selected>— Choose a command —</option>
            <optgroup label="Playback">
              <option value="playback.prev">playback.prev</option>
              <option value="playback.next">playback.next</option>
              <option value="playback.pause">playback.pause</option>
              <option value="playback.resume">playback.resume</option>
              <option value="playback.toggle">playback.toggle</option>
              <option value="playback.pinPoster">playback.pinPoster</option>
            </optgroup>
            <optgroup label="Remote">
              <option value="remote.key">remote.key</option>
            </optgroup>
            <optgroup label="Power">
              <option value="power.on">power.on</option>
              <option value="power.off">power.off</option>
              <option value="power.toggle">power.toggle</option>
            </optgroup>
            <optgroup label="Source">
              <option value="source.switch">source.switch (plex|jellyfin|tmdb|tvdb|all)</option>
            </optgroup>
            <optgroup label="Management">
              <option value="core.mgmt.reload">core.mgmt.reload</option>
              <option value="core.mgmt.reset">core.mgmt.reset</option>
              <option value="core.mgmt.clearCache">core.mgmt.clearCache</option>
              <option value="core.mgmt.swUnregister">core.mgmt.swUnregister</option>
            </optgroup>
            <option value="__custom">Custom…</option>
          </select>
        </div>
        <div class="form-group" id="sendcmd-param-source" style="margin-top:10px; display:none;">
          <label for="sendcmd-source">Source key</label>
          <select id="sendcmd-source">
            <option value="plex" selected>plex</option>
            <option value="jellyfin">jellyfin</option>
            <option value="tmdb">tmdb</option>
            <option value="tvdb">tvdb</option>
            <option value="all">all</option>
          </select>
        </div>
        <div class="form-group" style="margin-top:10px;">
          <label for="sendcmd-type">Type</label>
          <input id="sendcmd-type" type="text" placeholder="e.g. playback.toggle" />
        </div>
        <div class="form-group" style="margin-top:10px;">
          <label for="sendcmd-payload">Payload (JSON, optional)</label>
          <textarea id="sendcmd-payload" rows="6" style="width:100%;" placeholder="{ }"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" data-close-modal>Cancel</button>
        <button class="btn btn-primary" id="btn-sendcmd-apply"><i class="fas fa-paper-plane"></i> Send</button>
      </div>
    </div>
  </div>

  <!-- Pairing Codes Modal -->
  <div class="modal-overlay" id="modal-pairing">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="pairing-title">
      <div class="modal-header">
        <div class="modal-title" id="pairing-title"><i class="fas fa-qrcode"></i> Pairing Codes</div>
        <button class="modal-close" data-close-modal><i class="fas fa-times"></i></button>
      </div>
  <div class="modal-body" style="display:grid; gap:12px;">
        <div id="pairing-namebar" class="pairing-namebar" hidden>
          <i class="fas fa-desktop" aria-hidden="true"></i>
          <span id="pairing-namebar-text">—</span>
        </div>
        <div id="pairing-list" style="display:grid; gap:12px;"></div>
        <!-- dynamically filled: per device code + QR image -->
      </div>
      <div class="modal-footer pairing-footer">
        <div class="pairing-exp subtle" id="pairing-exp-footer"></div>
  <button class="btn btn-outline" data-close-modal>Close</button>
      </div>
    </div>
  </div>

  <!-- Create Device Modal -->
  <div class="modal-overlay" id="modal-create-device">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="create-device-title">
      <div class="modal-header">
        <div class="modal-title" id="create-device-title"><i class="fas fa-plus"></i> New Device</div>
        <button class="modal-close" data-close-modal><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
        <div class="form-grid">
          <div class="form-group">
            <label for="create-device-name">Name</label>
            <input id="create-device-name" type="text" placeholder="Optional" />
          </div>
          <div class="form-group">
            <label for="create-device-location-select">Location</label>
            <select id="create-device-location-select"></select>
            <input id="create-device-location-new" type="text" placeholder="New location" style="display:none; margin-top:8px;" />
          </div>
          <div class="form-group">
            <label for="create-device-groups">Groups</label>
            <select id="create-device-groups" multiple size="4" style="min-height: 110px;"></select>
            <div class="hint" style="margin-top:6px; color: var(--color-text-muted); font-size:.85rem;">Optional. Select one or more groups.</div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" data-close-modal>Cancel</button>
        <button class="btn btn-primary" id="btn-create-device-confirm"><i class="fas fa-check"></i> Create &amp; Show Pairing code</button>
      </div>
    </div>
  </div>

  <!-- Group Assign Modal -->
  <div class="modal-overlay" id="modal-group-assign">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-group-title">
      <div class="modal-header">
        <div class="modal-title" id="modal-group-title">
          <i class="fas fa-layer-group"></i>
          Assign to Group
        </div>
        <button class="modal-close" data-close-modal><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
        <p>Select a group to assign or remove for the selected devices.</p>
        <div class="form-group" style="margin-top: var(--space-md);">
          <label for="group-select">Group</label>
          <select id="group-select"></select>
        </div>
        <div class="form-group" style="margin-top: var(--space-md);">
          <label for="new-group-name">Or create a new group</label>
          <div style="display:flex; gap:.5rem; align-items:center;">
            <input id="new-group-name" type="text" placeholder="New group name" />
            <button class="btn btn-outline" id="btn-group-create-assign"><i class="fas fa-plus"></i> Create & assign</button>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" data-close-modal>Cancel</button>
        <button class="btn btn-secondary" id="btn-group-remove">Remove from group</button>
        <button class="btn btn-primary" id="btn-group-assign">Assign to group</button>
      </div>
    </div>
  </div>

  <!-- Assign Preset Modal -->
  <div class="modal-overlay" id="modal-assign-preset">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-preset-title">
      <div class="modal-header">
        <div class="modal-title" id="modal-preset-title">
          <i class="fas fa-star"></i>
          Presets
        </div>
        <button class="modal-close" data-close-modal><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
  <p>Choose a preset to apply to the selected devices, or clear the current preset.</p>
        <div class="form-group" style="margin-top: var(--space-md);">
          <label for="preset-select">Preset</label>
          <select id="preset-select"></select>
        </div>
      </div>
      <div class="modal-footer">
  <button class="btn btn-outline" data-close-modal>Cancel</button>
  <button class="btn btn-secondary" id="btn-preset-clear">Clear preset</button>
  <button class="btn btn-primary" id="btn-preset-apply">Apply preset</button>
      </div>
    </div>
  </div>

  <!-- Assign Location Modal -->
  <div class="modal-overlay" id="modal-assign-location">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-location-title">
      <div class="modal-header">
        <div class="modal-title" id="modal-location-title">
          <i class="fas fa-location-dot"></i>
          Assign Location
        </div>
        <button class="modal-close" data-close-modal><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
        <p>Set or clear the location for the selected devices.</p>
        <div class="form-group" style="margin-top: var(--space-md);">
          <label for="location-input">Location</label>
          <input id="location-input" type="text" list="location-list" placeholder="e.g. Living Room" />
          <datalist id="location-list"></datalist>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" data-close-modal>Cancel</button>
        <button class="btn btn-secondary" id="btn-location-clear">Clear location</button>
        <button class="btn btn-primary" id="btn-location-apply">Assign location</button>
      </div>
    </div>
  </div>

  <!-- Revoke API Key Confirmation Modal (theme-demo structure) -->
  <div class="modal-overlay" id="modal-revoke-api-key">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-revoke-title">
      <div class="modal-header">
        <div class="modal-title" id="modal-revoke-title"><i class="fas fa-trash-alt"></i> Revoke API Key</div>
        <button class="modal-close" data-close-modal aria-label="Close"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to revoke the current API key? Any client using it will stop working immediately.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline" data-close-modal>Cancel</button>
        <button type="button" id="btn-revoke-api-key-confirm" class="btn btn-error"><i class="fas fa-trash-alt"></i><span>Revoke Key</span></button>
      </div>
    </div>
  </div>

  <!-- Update Confirmation Modal (theme-demo structure) -->
  <div class="modal-overlay" id="modal-update">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-update-title">
      <div class="modal-header">
        <div class="modal-title" id="modal-update-title"><i class="fas fa-download"></i> Confirm Auto-Update</div>
        <button class="modal-close" data-close-modal aria-label="Close"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body" id="modal-update-content">
        <div class="subtle">Loading update information…</div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline" data-close-modal>Cancel</button>
        <button type="button" id="btn-update-force" class="btn btn-warning" style="display:none;"><i class="fas fa-hammer"></i><span>Force Update</span></button>
        <button type="button" id="btn-update-confirm" class="btn btn-primary" disabled><i class="fas fa-check"></i><span>Start Update</span></button>
      </div>
    </div>
  </div>

  <!-- Delete Devices Confirmation Modal (theme-demo structure) -->
  <div class="modal-overlay" id="modal-delete-devices">
    <div class="modal modal-sm" role="dialog" aria-modal="true" aria-labelledby="modal-delete-title">
      <div class="modal-header">
        <div class="modal-title" id="modal-delete-title"><i class="fas fa-trash"></i> Delete devices</div>
        <button class="modal-close" data-close-modal aria-label="Close"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body" id="modal-delete-content" style="padding: 20px;">
        <!-- Filled dynamically with selection summary -->
      </div>
      <div class="modal-footer" style="display:flex; gap:12px; justify-content:flex-end; padding: 16px 20px;">
        <button type="button" class="btn btn-outline" data-close-modal>Cancel</button>
        <button type="button" class="btn btn-error" id="btn-confirm-delete-devices"><i class="fas fa-trash"></i><span> Delete</span></button>
      </div>
    </div>
  </div>

  <!-- Cache Size Edit Modal -->
  <div class="modal-overlay" id="modal-cache-size">
    <div class="modal modal-sm" role="dialog" aria-modal="true" aria-labelledby="modal-cache-size-title">
      <div class="modal-header">
        <div class="modal-title" id="modal-cache-size-title"><i class="fas fa-database"></i> Edit Cache Size</div>
        <button class="modal-close" data-close-modal aria-label="Close"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body" style="text-align: center; padding: 24px;">
        
        <!-- Cache icon and intro -->
        <div style="margin-bottom: 24px;">
          <div style="
            width: 64px; 
            height: 64px; 
            margin: 0 auto 16px auto; 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            background: linear-gradient(135deg, var(--color-warning), var(--color-warning-dark));
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
          ">
            <i class="fas fa-database" style="font-size: 24px; color: white; text-shadow: 0 2px 4px rgba(0,0,0,0.3);"></i>
          </div>
          <h3 style="margin: 0 0 6px 0; font-size: 1.1rem; font-weight: 600;">Configure Cache Storage</h3>
          <p style="margin: 0; font-size: 0.85rem; color: rgba(255,255,255,0.7); line-height: 1.4;">
            Set the maximum disk space for cached poster images
          </p>
        </div>

        <!-- Cache size form section -->
        <div style="background: rgba(255,255,255,0.02); border-radius: 12px; padding: 20px; border: 1px solid rgba(255,255,255,0.06);">
          
          <!-- Cache size input -->
          <div style="margin-bottom: 16px; text-align: left;">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
              <i class="fas fa-hdd" style="color: var(--color-warning); font-size: 0.8rem;"></i>
              <span style="font-weight: 600; font-size: 0.85rem;">Maximum Cache Size</span>
            </div>
            <div style="display: flex; gap: 12px; align-items: center;">
              <input 
                id="input-cache-size-gb" 
                type="number" 
                inputmode="decimal" 
                step="0.1" 
                min="0.1" 
                placeholder="2.0"
                style="
                  flex: 1;
                  padding: 12px 16px;
                  border-radius: 8px;
                  border: 2px solid rgba(255,255,255,0.1);
                  background: rgba(255,255,255,0.05);
                  color: white;
                  font-size: 1rem;
                  font-weight: 600;
                  text-align: center;
                  transition: all 0.2s ease;
                "
              />
              <div style="
                padding: 12px 16px;
                background: rgba(var(--color-warning-rgb), 0.15);
                border: 2px solid rgba(var(--color-warning-rgb), 0.3);
                border-radius: 8px;
                color: var(--color-warning);
                font-weight: 600;
                font-size: 0.9rem;
              ">
                GB
              </div>
            </div>
          </div>

          <!-- Storage info -->
          <div style="
            background: rgba(var(--color-info-rgb), 0.1); 
            border: 1px solid rgba(var(--color-info-rgb), 0.2); 
            border-radius: 8px; 
            padding: 12px 16px;
            text-align: center;
            margin-top: 16px;
          ">
            <div style="display: flex; align-items: center; justify-content: center; gap: 6px; margin-bottom: 4px;">
              <i class="fas fa-info-circle" style="color: var(--color-info); font-size: 0.8rem;"></i>
              <span style="font-weight: 600; font-size: 0.8rem; color: var(--color-info);">Recommended Range</span>
            </div>
            <div style="font-size: 0.75rem; color: rgba(255,255,255,0.6);">
              1.0 - 5.0 GB • Must be greater than 0.1 GB
            </div>
          </div>
        </div>
      </div>
      
      <div class="modal-footer" style="padding: 20px 24px; border-top: 1px solid rgba(255,255,255,0.1);">
        <button type="button" class="btn btn-outline" data-close-modal style="margin-right: 12px;">
          <i class="fas fa-times"></i>
          <span>Cancel</span>
        </button>
        <button type="button" id="btn-cache-size-save" class="btn" style="
          background: linear-gradient(135deg, var(--color-warning), var(--color-warning-dark));
          border: none;
          color: white;
          font-weight: 600;
          box-shadow: 0 4px 12px rgba(var(--color-warning-rgb), 0.3);
          transition: all 0.2s ease;
        ">
          <i class="fas fa-save"></i>
          <span>Save Changes</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Profile Photo Modal -->
  <div class="modal-overlay" id="modal-avatar" hidden>
    <div class="modal modal-sm" role="dialog" aria-modal="true" aria-labelledby="modal-avatar-title">
      <div class="modal-header">
        <div class="modal-title" id="modal-avatar-title"><i class="fas fa-image"></i> Profile Photo</div>
        <button class="modal-close" data-close-modal aria-label="Close"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body" style="text-align: center; padding: 24px;">
        
        <!-- Large centered avatar preview -->
        <div style="margin-bottom: 32px;">
          <div class="avatar-preview" id="avatar-preview" aria-live="polite" style="
            width: 120px; 
            height: 120px; 
            margin: 0 auto 16px auto; 
            border-radius: 50%; 
            overflow: hidden; 
            border: 4px solid rgba(255,255,255,0.1);
            box-shadow: 0 8px 24px rgba(0,0,0,0.3);
            position: relative;
            background: linear-gradient(135deg, var(--color-primary), var(--color-accent));
          ">
            <div class="avatar-initials" id="avatar-initials-fallback" style="
              position: absolute;
              top: 50%;
              left: 50%;
              transform: translate(-50%, -50%);
              font-size: 36px;
              font-weight: 700;
              color: white;
              text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            ">AD</div>
            <img id="avatar-image-preview" alt="Current profile photo" style="
              width: 100%;
              height: 100%;
              object-fit: cover;
              position: absolute;
              top: 0;
              left: 0;
            " />
          </div>
        </div>

        <!-- Upload section with modern design -->
        <div style="background: rgba(255,255,255,0.02); border-radius: 16px; padding: 24px; border: 1px solid rgba(255,255,255,0.06);">
          <div style="margin-bottom: 20px;">
            <div class="file-upload-area" style="
              border: 2px dashed rgba(255,255,255,0.2);
              border-radius: 12px;
              padding: 32px 16px;
              cursor: pointer;
              transition: all 0.2s ease;
              position: relative;
              background: rgba(255,255,255,0.01);
            " id="upload-drop-zone">
              <div style="margin-bottom: 16px;">
                <i class="fas fa-cloud-upload-alt" style="font-size: 32px; color: var(--color-primary); opacity: 0.8;"></i>
              </div>
              <button type="button" class="btn btn-primary btn-sm" id="avatar-file-trigger" style="margin-bottom: 12px;">
                <i class="fas fa-file-upload"></i><span>Choose Image</span>
              </button>
              <div style="font-size: 0.9rem; color: rgba(255,255,255,0.7); margin-bottom: 8px;">
                or drag and drop your image here
              </div>
              <div style="font-size: 0.8rem; color: rgba(255,255,255,0.5);">
                PNG, JPG, or WebP — up to 2 MB
              </div>
              <input type="file" id="avatar-file" accept="image/png,image/jpeg,image/webp" style="position:absolute;left:-9999px;opacity:0;pointer-events:none;" />
            </div>
            
            <!-- Selected file display -->
            <div id="selected-file-display" style="display: none; margin-top: 16px; padding: 12px; background: rgba(var(--color-success-rgb, 16, 185, 129), 0.1); border-radius: 8px; border: 1px solid rgba(var(--color-success-rgb, 16, 185, 129), 0.2);">
              <div style="display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-check-circle" style="color: var(--color-success);"></i>
                <span id="avatar-file-name" style="font-size: 0.9rem; color: var(--color-success);">No file selected</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="modal-footer" style="display: flex; gap: 12px; justify-content: flex-end; padding: 20px 24px;">
        <button type="button" class="btn btn-outline" data-close-modal style="min-width: 80px;">Cancel</button>
        <button type="button" class="btn btn-error" id="avatar-remove-btn" style="min-width: 90px;">
          <i class="fas fa-trash"></i><span>Remove</span>
        </button>
        <button type="button" class="btn btn-primary" id="avatar-upload-btn" style="min-width: 90px;">
          <i class="fas fa-upload"></i><span>Upload</span>
        </button>
      </div>
    </div>
  </div>

  <script src="/notify.js?v=20250906-1"></script>
  
  <!-- Notification Center (themed, matches theme-demo Device Management example) -->
  <div class="notify-center" id="notify-center" aria-live="polite" aria-label="Notifications panel">
    <div class="notify-header">
      <strong>Notifications</strong>
      <div style="display:flex; gap:8px; align-items:center;">
        <button class="btn btn-outline btn-sm" id="notify-mark-all" title="Mark all as read">
          <i class="fas fa-check-double"></i>
          Mark all
        </button>
        <button class="btn btn-icon btn-sm" id="notify-close" title="Close">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>
    <div class="notify-subheader">
      <div class="notify-filter" id="notify-min-level-icons" role="radiogroup" aria-label="Minimum level">
        <button class="nf-btn" data-level="info" role="radio" aria-checked="false" title="Info" aria-label="Info">
          <span class="ring"><i class="fas fa-circle-info" aria-hidden="true"></i></span>
        </button>
        <button class="nf-btn" data-level="warn" role="radio" aria-checked="false" title="Warn" aria-label="Warn">
          <span class="ring"><i class="fas fa-triangle-exclamation" aria-hidden="true"></i></span>
        </button>
        <button class="nf-btn" data-level="error" role="radio" aria-checked="true" title="Error" aria-label="Error">
          <span class="ring"><i class="fas fa-circle-exclamation" aria-hidden="true"></i></span>
        </button>
      </div>
      <!-- SR-only fallback select for accessibility and legacy binding -->
      <label for="notify-min-level" class="sr-only">Minimum level</label>
      <select id="notify-min-level" class="sr-only" tabindex="-1" aria-hidden="true">
        <option value="info">Info</option>
        <option value="warn">Warn</option>
        <option value="error" selected>Error</option>
      </select>
    </div>
    <div class="notify-list" id="notify-list"></div>
  </div>
    <!-- Generic Confirm Modal -->
    <div class="modal-overlay" id="modal-confirm" hidden>
      <div class="modal modal-sm" role="dialog" aria-modal="true" aria-labelledby="modal-confirm-title">
        <div class="modal-header">
          <div class="modal-title" id="modal-confirm-title"><i class="fas fa-question-circle"></i> Confirm</div>
          <button class="modal-close" data-close-modal aria-label="Close"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body" id="modal-confirm-body" style="padding: 16px 20px;">
          Are you sure?
        </div>
        <div class="modal-footer" style="display:flex; gap:10px; justify-content:flex-end; padding: 14px 20px;">
          <button type="button" class="btn btn-outline" data-close-modal>Cancel</button>
          <button type="button" class="btn btn-primary" id="modal-confirm-ok"><i class="fas fa-check"></i><span>Confirm</span></button>
        </div>
      </div>
    </div>
  <script src="/admin2.js?v=20250913-03"></script>
  <!-- PWA Service Worker Registration (admin2) -->
  <script>
    // Register SW without forcing immediate reloads. We'll prompt the user instead.
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker
          .register('/sw.js')
          .then(reg => {
            // Disable SW update toasts in Admin: end-users don't receive admin-only updates.
            // Keep registration for caching/offline benefits, but don't surface update messages.
            const swToast = () => {};
            // If there's already a waiting worker, do NOT force-activate.
            // We'll surface an unobtrusive update hint and let the user refresh.
            // Intentionally no notification when a waiting worker exists

            // When a new SW is found, wait until it installs, then hint the user.
            reg.addEventListener('updatefound', () => {
              const sw = reg.installing;
              if (!sw) return;
              sw.addEventListener('statechange', () => {
                // Intentionally suppress 'Update installed' notifications
              });
            });

            // Avoid auto-refresh on controller changes; only refresh if explicitly requested elsewhere.
            navigator.serviceWorker.addEventListener('controllerchange', () => {
              // Intentionally no automatic reload here to prevent disruptive bounces.
              // Advanced: if a future flow sets window.__swAllowReload = true, we can honor it.
              if (window.__swAllowReload) {
                try { window.location.reload(); } catch (_) { /* ignore */ }
              }
            });
          })
          .catch(() => { /* silent */ });
      });
    }
  </script>
</body>
</html>

