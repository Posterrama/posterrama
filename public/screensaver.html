<!doctype html>
<!-- posterrama.app | Author: Posterrama Team | License: GPL-3.0-or-later -->
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Posterrama - Screensaver</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
        <link rel="manifest" href="/manifest.json" />
        <link rel="icon" type="image/svg+xml" href="/icons/posterrama-icon.svg?v=3" />
        <link rel="icon" type="image/x-icon" href="/favicon.ico?v=3" />
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&family=Kalam:wght@400;700&display=swap"
            rel="stylesheet"
        />
        <!-- Preconnect to media server for faster poster loading -->
        <link rel="dns-prefetch" href="/image" />
        <link rel="preconnect" href="/image" crossorigin />
        <script src="/client-logger.js"></script>

        <!-- Critical CSS inline for instant FCP (~1KB) -->
        <style>*{box-sizing:border-box}body,html{background:linear-gradient(135deg,#1a1a1a 0,#2a2a2a 100%)}*,body,html{margin:0;padding:0}body,html{width:100vw;height:100vh;overflow:hidden;font-family:"Inter",-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;color:#e2e8f0;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.is-hidden{display:none!important}#poster{width:100%;height:100%;background-size:cover;background-position:center;background-repeat:no-repeat;position:relative}#error-message{position:fixed;top:20px;left:50%;transform:translateX(-50%);background:rgba(239,68,68,.95);color:#fff;padding:1rem 1.5rem;border-radius:8px;z-index:10000;max-width:90%;text-align:center}#branding-container,#promo-box{display:none!important}</style>

        <!-- Preload non-critical CSS (deferred) -->
        <link rel="preload" href="style.css?v={{ASSET_VERSION}}" as="style" onload="this.onload=null;this.rel='stylesheet'" />
        <link rel="preload" href="/screensaver/screensaver.css?v={{ASSET_VERSION}}" as="style" onload="this.onload=null;this.rel='stylesheet'" />
        
        <!-- Fallback for no-JS -->
        <noscript>
            <link rel="stylesheet" href="style.css?v={{ASSET_VERSION}}" />
            <link rel="stylesheet" href="/screensaver/screensaver.css?v={{ASSET_VERSION}}" />
        </noscript>
    
        <!-- Global Error Handler -->
        <script type="module" src="/error-handler.js"></script>
        
        <!-- Defense: Remove Next.js assets injected by extensions/cache -->
        <script>
            if (typeof MutationObserver !== 'undefined') {
                new MutationObserver(mutations => {
                    mutations.forEach(m => {
                        m.addedNodes.forEach(node => {
                            if (node.tagName === 'LINK' && node.href && node.href.includes('_next')) {
                                try { node.remove(); } catch(_) {}
                            }
                            if (node.tagName === 'SCRIPT' && node.src && node.src.includes('_next')) {
                                try { node.remove(); } catch(_) {}
                            }
                        });
                    });
                }).observe(document.documentElement, { childList: true, subtree: true });
            }
            document.addEventListener('DOMContentLoaded', () => {
                document.querySelectorAll('link[href*="_next"], script[src*="_next"]').forEach(el => {
                    try { el.remove(); } catch(_) {}
                });
            });
        </script>
    </head>
    <body data-mode="screensaver">
        <div id="error-message" class="is-hidden"></div>
        <div id="layer-a" class="screensaver-layer"></div>
        <div id="layer-b" class="screensaver-layer"></div>
        <div id="clock-widget-container">
            <div id="time-widget">
                <span id="time-hours">00</span>
                <span id="time-separator">:</span>
                <span id="time-minutes">00</span>
            </div>
        </div>
        <div id="clearlogo-container"><img id="clearlogo" src="" alt="ClearLogo" /></div>
        <div id="info-container">
            <div id="poster-wrapper">
                <a id="poster-link" href="#" target="_blank" rel="noopener noreferrer">
                    <div id="poster-a" class="poster-layer"></div>
                    <div id="poster-b" class="poster-layer"></div>
                    <div id="poster"></div>
                </a>
            </div>
            <div id="text-wrapper">
                <h1 id="title"></h1>
                <p id="tagline"></p>
                <div id="meta-info">
                    <span id="year"></span>
                    <span id="rating"></span>
                </div>
            </div>
        </div>
        <div id="controls-container">
            <button id="prev-button" aria-label="Previous">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
                </svg>
            </button>
            <button id="pause-button" aria-label="Pause/Resume">
                <svg class="icon-pause" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z" />
                </svg>
                <svg class="icon-play" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M8 5v14l11-7z" />
                </svg>
            </button>
            <button id="next-button" aria-label="Next">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z" />
                </svg>
            </button>
        </div>
        <div id="branding-container" style="display:none"></div>
    <script defer src="lazy-loading.js?v={{ASSET_VERSION}}"></script>
    <!-- Mode-based redirect: automatically redirect to mode-specific page -->
    <script type="module">
        import { checkModeRedirect, loadPromoOverlayIfEnabled, startPeriodicModeCheck } from './mode-redirect.js';
        import { initScreensaver } from './screensaver-bootstrap.js';
        
        // Check if we should redirect to another mode
        await checkModeRedirect('screensaver', '__screensaverModeVerified');
        
        // Mode verified - set hint to prevent further checks
        window.MODE_HINT = 'screensaver';
        
        // Start periodic mode checking (auto-navigate on config changes)
        startPeriodicModeCheck('screensaver');
        
        // Load promo overlay if enabled
        await loadPromoOverlayIfEnabled();
        
        // Start screensaver when DOM ready
        initScreensaver();
    </script>

    <script defer src="device-mgmt.js?v={{ASSET_VERSION}}"></script>
    <script defer src="/core.js?v={{ASSET_VERSION}}"></script>
    <script defer src="/screensaver/screensaver.js?v={{ASSET_VERSION}}"></script>
    <script>
                // Hint for SW stamping: server stamps this path in routed responses
        try { window.__swUrl = '/sw.js?v={{ASSET_VERSION}}'; } catch (e) {}
    </script>
    </script>
    <script>
        // start is now invoked by the bootstrap above
    </script>
        <script>
            try { window.PosterramaCore && window.PosterramaCore.startAutoExitPoll({ currentMode: 'screensaver', intervalMs: 15000 }); } catch (e) {}
        </script>
    </body>
</html>
