<!doctype html>
<!-- posterrama.app | Author: Posterrama Team | License: GPL-3.0-or-later -->
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Posterrama - Screensaver</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
        <link rel="manifest" href="/manifest.json" />
        <link rel="icon" type="image/svg+xml" href="/icons/posterrama-icon.svg?v=2" />
        <link rel="icon" type="image/x-icon" href="/favicon.ico?v=2" />
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap"
            rel="stylesheet"
        />
        <script src="/client-logger.js"></script>
    <link rel="stylesheet" href="style.css?v={{ASSET_VERSION}}" />
    <link rel="stylesheet" href="/screensaver/screensaver.css?v={{ASSET_VERSION}}" />
    </head>
    <body data-mode="screensaver">
        <div id="loader"><div class="poster-loader"></div></div>
        <div id="error-message" class="is-hidden"></div>
        <div id="layer-a" class="screensaver-layer"></div>
        <div id="layer-b" class="screensaver-layer"></div>
        <div id="clock-widget-container">
            <div id="time-widget">
                <span id="time-hours">00</span>
                <span id="time-separator">:</span>
                <span id="time-minutes">00</span>
            </div>
        </div>
        <div id="clearlogo-container"><img id="clearlogo" src="" alt="ClearLogo" /></div>
        <div id="info-container">
            <div id="poster-wrapper">
                <a id="poster-link" href="#" target="_blank" rel="noopener noreferrer">
                    <div id="poster-a" class="poster-layer"></div>
                    <div id="poster-b" class="poster-layer"></div>
                    <div id="poster"></div>
                </a>
            </div>
            <div id="text-wrapper">
                <h1 id="title"></h1>
                <p id="tagline"></p>
                <div id="meta-info">
                    <span id="year"></span>
                    <span id="rating"></span>
                </div>
            </div>
        </div>
        <div id="controls-container" style="display:none"></div>
        <div id="branding-container" style="display:none"></div>
    <script src="lazy-loading.js?v={{ASSET_VERSION}}"></script>
    <script src="device-mgmt.js?v={{ASSET_VERSION}}"></script>
    <script src="/core.js?v={{ASSET_VERSION}}"></script>
    <script src="/screensaver/screensaver.js?v={{ASSET_VERSION}}"></script>
    <script>
        (function () {
            async function ensureConfig() {
                try {
                    if (window.appConfig) return true;
                    const useCore = !!(window.PosterramaCore && window.PosterramaCore.fetchConfig);
                    const cfg = useCore
                        ? await window.PosterramaCore.fetchConfig()
                        : await (await fetch('/get-config', { cache: 'no-cache', headers: { 'Cache-Control': 'no-cache' } })).json();
                    try {
                        if (!Object.getOwnPropertyDescriptor(window, 'appConfig')) {
                            Object.defineProperty(window, 'appConfig', { value: cfg, writable: true });
                        } else {
                            window.appConfig = cfg;
                        }
                    } catch (_) { window.appConfig = cfg; }
                    return true;
                } catch (_) { return false; }
            }
            async function ensureMediaQueue() {
                try {
                    if (Array.isArray(window.mediaQueue) && window.mediaQueue.length > 0) return true;
                    const count = 12; // fetch multiple items so screensaver can rotate
                    const type = (window.appConfig && window.appConfig.type) || 'movies';
                    const url = `/get-media?count=${count}&type=${encodeURIComponent(type)}`;
                    const res = await fetch(url, { cache: 'no-cache', headers: { 'Cache-Control': 'no-cache' } });
                    if (!res.ok) return false;
                    const data = await res.json();
                    const items = Array.isArray(data) ? data : Array.isArray(data?.results) ? data.results : [];
                    if (!items.length) return false;
                    try {
                        if (!Object.getOwnPropertyDescriptor(window, 'mediaQueue')) {
                            Object.defineProperty(window, 'mediaQueue', { value: items, writable: true });
                        } else {
                            window.mediaQueue = items;
                        }
                    } catch (_) { window.mediaQueue = items; }
                    return true;
                } catch (_) { return false; }
            }
            async function startScreensaver() {
                try {
                    await ensureConfig();
                    await ensureMediaQueue();
                    if (window.PosterramaScreensaver && typeof window.PosterramaScreensaver.start === 'function') {
                        window.PosterramaScreensaver.start();
                        try { const loader = document.getElementById('loader'); if (loader) { loader.style.opacity='0'; loader.style.display='none'; } } catch(_) {}
                    }
                } catch (_) {}
            }
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', startScreensaver);
            } else {
                startScreensaver();
            }
        })();
    </script>
    <script>
        // start is now invoked by the bootstrap above
    </script>
        <script>
            window.MODE_HINT='screensaver';
            try { window.PosterramaCore && window.PosterramaCore.startAutoExitPoll({ currentMode: 'screensaver', intervalMs: 15000 }); } catch (e) {}
        </script>
    </body>
</html>
