<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Posterrama Admin Dashboard</title>
        <script>
        (function(){
            try {
                const t = Date.now();
                console.log('[ADMIN EARLY] inline preflight start', t);
                // Minimal CSS to ensure visibility if later CSS fails
                const st = document.createElement('style');
                st.id='early-minimal';
                st.textContent='body{background:#000;color:#0ff;font:14px monospace !important;} .section-content{border:1px dashed #0ff;margin:8px;padding:4px;}';
                document.head.appendChild(st);
                window.__ADMIN_EARLY_OK = true;
            } catch(e){
                console.log('[ADMIN EARLY] exception', e);
            }
        })();
        </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/admin.css?v=1.2.9">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* All styles moved to admin.css */
    </style>
</head>
<body>
    <div class="admin-layout">
        <!-- Header -->
        <header class="admin-header">
            <h1 class="logo-text">Admin Dashboard</h1>
            <nav>
                <a href="/" target="_blank">
                    <i class="fas fa-external-link-alt"></i>
                    View Screensaver
                </a>
                <a href="/api-docs" target="_blank">
                    <i class="fas fa-book"></i>
                    API Docs
                </a>
                <a href="/admin/logout">
                    <i class="fas fa-sign-out-alt"></i>
                    Logout
                </a>
            </nav>
        </header>

        <!-- Sidebar Navigation -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <button class="sidebar-toggle" id="sidebar-toggle">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="sidebar-logo">
                    <span class="logo-text">Posterrama</span>
                </div>
            </div>
            
            <div class="sidebar-nav">
                <button class="nav-item active" data-section="general" title="General Settings">
                    <i class="fas fa-cog nav-icon"></i>
                    <span class="nav-text">General</span>
                </button>
                
                <button class="nav-item" data-section="display" title="Display Settings">
                    <i class="fas fa-tv nav-icon"></i>
                    <span class="nav-text">Display</span>
                </button>
                
                <button class="nav-item" data-section="media" title="Media Servers">
                    <i class="fas fa-server nav-icon"></i>
                    <span class="nav-text">Media</span>
                </button>
                
                <button class="nav-item" data-section="authentication" title="Authentication">
                    <i class="fas fa-shield-alt nav-icon"></i>
                    <span class="nav-text">Auth</span>
                </button>
                
                <button class="nav-item" data-section="promobox" title="Promobox Site">
                    <i class="fas fa-globe nav-icon"></i>
                    <span class="nav-text">Promo</span>
                </button>
                
                <button class="nav-item" data-section="management" title="Management">
                    <i class="fas fa-tools nav-icon"></i>
                    <span class="nav-text">Manage</span>
                </button>
                
                <button class="nav-item" data-section="logs" title="Logs & Debug">
                    <i class="fas fa-file-alt nav-icon"></i>
                    <span class="nav-text">Logs</span>
                </button>
            </div>
        </nav>

        <!-- Sidebar overlay for mobile -->
        <div class="sidebar-overlay" id="sidebar-overlay"></div>

        <!-- Main Content Area -->
        <div class="main-content">
            <div id="admin-background-a" class="admin-background-layer"></div>
            <div id="admin-background-b" class="admin-background-layer"></div>
            <div class="admin-background-overlay"></div>

            <main class="admin-main">
                <div id="notification-area" class="notification-container"></div>

                <form id="config-form">
                    <!-- General Settings Section -->
                    <div class="section-content active" id="general-section">
                        <div class="section-main-content">
                            <div class="section-title">
                                <i class="fas fa-cog"></i>
                                General Settings
                            </div>
                        
                        <div class="form-section">
                            <div class="form-grid-2">
                                <div class="form-group">
                                    <label for="transitionIntervalSeconds" title="How many seconds each poster is visible.">Transition Interval (seconds)</label>
                                    <div class="number-input-wrapper">
                                        <input type="number" id="transitionIntervalSeconds" name="transitionIntervalSeconds" min="1" max="300" step="1" required>
                                        <div class="number-controls">
                                            <button type="button" class="number-btn" onclick="incrementValue('transitionIntervalSeconds')">
                                                <i class="fas fa-chevron-up"></i>
                                            </button>
                                            <button type="button" class="number-btn" onclick="decrementValue('transitionIntervalSeconds')">
                                                <i class="fas fa-chevron-down"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="backgroundRefreshMinutes">Background Refresh (minutes)</label>
                                    <div class="number-input-wrapper">
                                        <input type="number" id="backgroundRefreshMinutes" name="backgroundRefreshMinutes" min="0" max="1440" step="1">
                                        <div class="number-controls">
                                            <button type="button" class="number-btn" onclick="incrementValue('backgroundRefreshMinutes')">
                                                <i class="fas fa-chevron-up"></i>
                                            </button>
                                            <button type="button" class="number-btn" onclick="decrementValue('backgroundRefreshMinutes')">
                                                <i class="fas fa-chevron-down"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="SERVER_PORT">Application Port</label>
                                    <div class="number-input-wrapper">
                                        <input type="number" id="SERVER_PORT" name="SERVER_PORT" min="1024" max="65535" step="1" required>
                                        <div class="number-controls">
                                            <button type="button" class="number-btn" onclick="incrementValue('SERVER_PORT')">
                                                <i class="fas fa-chevron-up"></i>
                                            </button>
                                            <button type="button" class="number-btn" onclick="decrementValue('SERVER_PORT')">
                                                <i class="fas fa-chevron-down"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group checkbox-group">
                                    <input type="checkbox" id="DEBUG" name="DEBUG">
                                    <label for="DEBUG">Enable Debug Mode</label>
                                </div>
                            </div>
                        </div>
                        </div>
                    </div>

                    <!-- Display Settings Section -->
                    <div class="section-content" id="display-section">
                        <div class="section-main-content">
                            <div class="section-title">
                                <i class="fas fa-tv"></i>
                                Display Settings
                            </div>
                            
                            <!-- Cinema Mode -->
                            <div class="form-section">
                                <div class="subsection-title">
                                    <i class="fas fa-film"></i>
                                    Cinema Mode
                                </div>
                                
                                <div class="form-group checkbox-group">
                                    <input type="checkbox" id="cinemaMode" name="cinemaMode">
                                    <label for="cinemaMode">Enable Cinema Mode</label>
                                </div>
                                <div class="form-group" id="cinemaOrientationGroup" style="display: none;">
                                    <label for="cinemaOrientation">Cinema Display Orientation</label>
                                    <select id="cinemaOrientation" name="cinemaOrientation">
                                        <option value="auto">Auto (use device sensor)</option>
                                        <option value="portrait">Portrait</option>
                                        <option value="portrait-flipped">Portrait Flipped (180¬∞)</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-section">
                                <div class="subsection-title">
                                    <i class="fas fa-eye"></i>
                                    Visual Elements
                                </div>
                                
                                <div class="form-grid-2">
                                    <div class="form-group checkbox-group">
                                        <input type="checkbox" id="showClearLogo" name="showClearLogo">
                                        <label for="showClearLogo">Show ClearLogo</label>
                                    </div>
                                    <div class="form-group checkbox-group">
                                        <input type="checkbox" id="showRottenTomatoes" name="showRottenTomatoes">
                                        <label for="showRottenTomatoes">Show Rotten Tomatoes Badge</label>
                                    </div>
                                    <div class="form-group checkbox-group">
                                        <input type="checkbox" id="showPoster" name="showPoster">
                                        <label for="showPoster">Show Poster</label>
                                    </div>
                                    <div class="form-group checkbox-group">
                                        <input type="checkbox" id="showMetadata" name="showMetadata">
                                        <label for="showMetadata">Show Metadata (title, tagline, etc.)</label>
                                    </div>
                                    <div class="form-group full-width">
                                        <label for="rottenTomatoesMinimumScore">Minimum Rotten Tomatoes Score (0-10)</label>
                                        <input type="number" id="rottenTomatoesMinimumScore" name="rottenTomatoesMinimumScore" min="0" max="10" step="0.1">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-section">
                                <div class="subsection-title">
                                    <i class="fas fa-clock"></i>
                                    Clock Widget
                                </div>
                                
                                <div class="form-group checkbox-group">
                                    <input type="checkbox" id="clockWidget" name="clockWidget">
                                    <label for="clockWidget">Show Clock</label>
                                </div>
                            <div class="form-group" id="clockTimezoneGroup" style="display: none;">
                                <label for="clockTimezone">Clock Timezone</label>
                                <select id="clockTimezone" name="clockTimezone">
                                    <option value="auto">Auto (System Timezone)</option>
                                    <optgroup label="Common Timezones">
                                        <option value="Europe/Amsterdam">Europe/Amsterdam (CET/CEST)</option>
                                        <option value="Europe/London">Europe/London (GMT/BST)</option>
                                        <option value="Europe/Berlin">Europe/Berlin (CET/CEST)</option>
                                        <option value="Europe/Paris">Europe/Paris (CET/CEST)</option>
                                        <option value="America/New_York">America/New_York (EST/EDT)</option>
                                        <option value="America/Chicago">America/Chicago (CST/CDT)</option>
                                        <option value="America/Denver">America/Denver (MST/MDT)</option>
                                        <option value="America/Los_Angeles">America/Los_Angeles (PST/PDT)</option>
                                        <option value="Asia/Tokyo">Asia/Tokyo (JST)</option>
                                        <option value="Asia/Shanghai">Asia/Shanghai (CST)</option>
                                        <option value="Australia/Sydney">Australia/Sydney (AEST/AEDT)</option>
                                    </optgroup>
                                    <optgroup label="Additional Timezones">
                                        <option value="UTC">UTC (Coordinated Universal Time)</option>
                                        <option value="Africa/Cairo">Africa/Cairo (EET)</option>
                                        <option value="Africa/Johannesburg">Africa/Johannesburg (SAST)</option>
                                        <option value="America/Argentina/Buenos_Aires">America/Argentina/Buenos_Aires (ART)</option>
                                        <option value="America/Mexico_City">America/Mexico_City (CST/CDT)</option>
                                        <option value="America/Sao_Paulo">America/Sao_Paulo (BRT/BRST)</option>
                                        <option value="America/Toronto">America/Toronto (EST/EDT)</option>
                                        <option value="America/Vancouver">America/Vancouver (PST/PDT)</option>
                                        <option value="Asia/Bangkok">Asia/Bangkok (ICT)</option>
                                        <option value="Asia/Dubai">Asia/Dubai (GST)</option>
                                        <option value="Asia/Hong_Kong">Asia/Hong_Kong (HKT)</option>
                                        <option value="Asia/Jakarta">Asia/Jakarta (WIB)</option>
                                        <option value="Asia/Kolkata">Asia/Kolkata (IST)</option>
                                        <option value="Asia/Seoul">Asia/Seoul (KST)</option>
                                    <option value="Asia/Singapore">Asia/Singapore (SGT)</option>
                                    <option value="Asia/Taipei">Asia/Taipei (CST)</option>
                                    <option value="Australia/Brisbane">Australia/Brisbane (AEST)</option>
                                    <option value="Australia/Melbourne">Australia/Melbourne (AEST/AEDT)</option>
                                    <option value="Australia/Perth">Australia/Perth (AWST)</option>
                                    <option value="Europe/Athens">Europe/Athens (EET/EEST)</option>
                                    <option value="Europe/Istanbul">Europe/Istanbul (TRT)</option>
                                    <option value="Europe/Moscow">Europe/Moscow (MSK)</option>
                                    <option value="Europe/Rome">Europe/Rome (CET/CEST)</option>
                                    <option value="Europe/Stockholm">Europe/Stockholm (CET/CEST)</option>
                                    <option value="Europe/Zurich">Europe/Zurich (CET/CEST)</option>
                                    <option value="Pacific/Auckland">Pacific/Auckland (NZST/NZDT)</option>
                                    <option value="Pacific/Honolulu">Pacific/Honolulu (HST)</option>
                                </optgroup>
                            </select>
                        </div>
                        <div class="form-group" id="clockFormatGroup" style="display: none;">
                            <label for="clockFormat">Clock Format</label>
                            <select id="clockFormat" name="clockFormat">
                                <option value="24h">24-hour format (23:45)</option>
                                <option value="12h">12-hour format (11:45 PM)</option>
                            </select>
                        </div>
                        
                        <!-- UI Scaling Settings -->
                        <div class="form-section">
                            <div class="subsection-title">
                                <i class="fas fa-expand-arrows-alt"></i>
                                UI Element Scaling
                            </div>
                            
                            <!-- Scaling Templates -->
                            <div class="scaling-templates">
                                <label>Quick Templates:</label>
                                <div class="template-buttons">
                                    <button type="button" class="btn btn-secondary" onclick="applyScalingTemplate('fullhd')">Full HD</button>
                                    <button type="button" class="btn btn-secondary" onclick="applyScalingTemplate('4k')">4K</button>
                                    <button type="button" class="btn btn-secondary" onclick="applyScalingTemplate('widescreen')">Widescreen</button>
                                    <button type="button" class="btn btn-secondary" onclick="resetScalingToDefaults()">Reset</button>
                                </div>
                            </div>
                            
                            <!-- Compact Scaling Grid -->
                            <div class="scaling-grid">
                                <div class="scaling-item">
                                    <label for="uiScaling.poster">Poster</label>
                                    <div class="slider-container">
                                        <input type="range" id="uiScaling.poster" name="uiScaling.poster" min="50" max="200" value="100" step="5">
                                        <div class="slider-track"></div>
                                        <div class="slider-fill"></div>
                                        <div class="slider-thumb"></div>
                                        <span class="slider-value" data-target="uiScaling.poster">100%</span>
                                    </div>
                                </div>
                                <div class="scaling-item">
                                    <label for="uiScaling.text">Text</label>
                                    <div class="slider-container">
                                        <input type="range" id="uiScaling.text" name="uiScaling.text" min="50" max="200" value="100" step="5">
                                        <div class="slider-track"></div>
                                        <div class="slider-fill"></div>
                                        <div class="slider-thumb"></div>
                                        <span class="slider-value" data-target="uiScaling.text">100%</span>
                                    </div>
                                </div>
                                <div class="scaling-item">
                                    <label for="uiScaling.clearlogo">Clearlogo</label>
                                    <div class="slider-container">
                                        <input type="range" id="uiScaling.clearlogo" name="uiScaling.clearlogo" min="50" max="200" value="100" step="5">
                                        <div class="slider-track"></div>
                                        <div class="slider-fill"></div>
                                        <div class="slider-thumb"></div>
                                        <span class="slider-value" data-target="uiScaling.clearlogo">100%</span>
                                    </div>
                                </div>
                                <div class="scaling-item">
                                    <label for="uiScaling.clock">Clock</label>
                                    <div class="slider-container">
                                        <input type="range" id="uiScaling.clock" name="uiScaling.clock" min="50" max="200" value="100" step="5">
                                        <div class="slider-track"></div>
                                        <div class="slider-fill"></div>
                                        <div class="slider-thumb"></div>
                                        <span class="slider-value" data-target="uiScaling.clock">100%</span>
                                    </div>
                                </div>
                                <div class="scaling-item">
                                    <label for="uiScaling.global">Global</label>
                                    <div class="slider-container">
                                        <input type="range" id="uiScaling.global" name="uiScaling.global" min="50" max="200" value="100" step="5">
                                        <div class="slider-track"></div>
                                        <div class="slider-fill"></div>
                                        <div class="slider-thumb"></div>
                                        <span class="slider-value" data-target="uiScaling.global">100%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Effects & Transitions -->
                        <div class="form-section">
                            <div class="subsection-title">
                                <i class="fas fa-magic"></i>
                                Effects & Transitions
                            </div>
                            
                            <div class="form-group">
                                <label for="transitionEffect">Transition Effect</label>
                                <select id="transitionEffect" name="transitionEffect">
                                    <option value="kenburns">Ken Burns</option>
                                    <option value="fade">Fade In/Out</option>
                                    <option value="slide">Slide Transition</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="effectPauseTime">Effect Pause Time (seconds)</label>
                                <input type="number" id="effectPauseTime" name="effectPauseTime" min="0" max="10" step="0.5" value="2">
                            </div>
                        </div>
                        </div>
                        
                        <div class="section-sidebar">
                            <!-- Live Preview -->
                            <div class="form-section">
                                <div class="subsection-title">
                                    <i class="fas fa-eye"></i>
                                    Live Preview
                                </div>
                                <!-- Preview container moved to global scope -->
                            </div>
                        </div>
                    </div>

                    <!-- Media Servers Section -->
                    <div class="section-content" id="media-section">
                        <div class="section-main-content">
                            <div class="section-title">
                                <i class="fas fa-server"></i>
                                Media Servers
                            </div>
                            
                            <div class="form-section">
                                <div class="subsection-title">
                                    <i class="fab fa-plex"></i>
                                    Plex Media Server
                                </div>
                                
                                <div class="form-group checkbox-group">
                                    <input type="checkbox" id="mediaServers[0].enabled" name="mediaServers[0].enabled">
                                    <label for="mediaServers[0].enabled">Enable Plex Server</label>
                                </div>
                                <div class="form-group">
                                    <label for="mediaServers[0].hostname">Plex Hostname/IP</label>
                                    <input type="text" id="mediaServers[0].hostname" name="mediaServers[0].hostname" placeholder="192.168.1.10 or plex.local" pattern="^[a-zA-Z0-9\.\-]+$">
                                </div>
                                <div class="form-group">
                                    <label for="mediaServers[0].port">Plex Port</label>
                                    <input type="number" id="mediaServers[0].port" name="mediaServers[0].port" min="1" max="65535" placeholder="32400">
                                </div>
                                <div class="form-group">
                                    <label for="mediaServers[0].token">Plex Token</label>
                                    <input type="password" id="mediaServers[0].token" name="mediaServers[0].token">
                                </div>
                                <div class="form-group">
                                    <label>Movie Library Names</label>
                                    <div id="movie-libraries-container" class="library-container">
                                        <small>Test the connection to fetch the libraries.</small>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Show Library Names</label>
                                    <div id="show-libraries-container" class="library-container">
                                        <small>Test the connection to fetch the libraries.</small>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="mediaServers[0].movieCount">Number of Movies to Show</label>
                                    <input type="number" id="mediaServers[0].movieCount" name="mediaServers[0].movieCount" min="1" max="10000" placeholder="100">
                                </div>
                                <div class="form-group">
                                    <label for="mediaServers[0].showCount">Number of Shows to Show</label>
                                    <input type="number" id="mediaServers[0].showCount" name="mediaServers[0].showCount" min="1" max="10000" placeholder="50">
                                </div>
                                <div class="form-group">
                                    <button type="button" id="test-plex-button" class="btn btn-primary">
                                        <i class="fas fa-plug"></i>
                                        Test Plex Connection
                                    </button>
                                    <small id="plex-connection-status"></small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Authentication Section -->
                    <div class="section-content" id="authentication-section">
                        <div class="section-main-content">
                            <div class="section-title">
                                <i class="fas fa-shield-alt"></i>
                                Authentication & Security
                            </div>
                            
                            <div class="form-section">
                                <div class="subsection-title">
                                    <i class="fas fa-key"></i>
                                    Change Password
                                </div>
                                
                                <div id="password-form">
                                    <div class="form-group">
                                        <label for="currentPassword">Current Password</label>
                                        <input type="password" id="currentPassword" name="currentPassword" autocomplete="current-password">
                                    </div>
                                    <div class="form-group">
                                        <label for="newPassword">New Password</label>
                                        <input type="password" id="newPassword" name="newPassword" autocomplete="new-password">
                                    </div>
                                    <div class="form-group">
                                        <label for="confirmPassword">Confirm New Password</label>
                                        <input type="password" id="confirmPassword" name="confirmPassword" autocomplete="new-password">
                                    </div>
                                    <div class="form-actions">
                                        <button type="button" id="change-password-button" class="btn btn-primary">
                                            <i class="fas fa-lock"></i>
                                            Change Password
                                        </button>
                                    </div>
                                </div>
                            </div>
                        
                        <div class="form-section">
                            <h3>Two-Factor Authentication (2FA)</h3>
                            <div class="form-group checkbox-group">
                                <input type="checkbox" id="enable2FA" name="enable2FA">
                                <label for="enable2FA">Enable 2FA</label>
                                <div id="2fa-status-text" class="status-text disabled"></div>
                            </div>
                        </div>
                        
                        <div class="form-section">
                            <h3>API Access</h3>
                            <div class="form-group">
                                <p>Manage a permanent API key for use with external applications or scripts (like Swagger).</p>
                            </div>
                            <div class="form-group" id="api-key-status">
                                <p>Status: <span id="api-key-status-text" class="status-text">Loading...</span></p>
                            </div>
                            <div id="api-key-display-container" class="is-hidden form-group">
                                <label>Current API Key:</label>
                                <div style="display: flex; gap: 5px; align-items: center;">
                                    <input id="api-key-input" type="password" readonly style="flex-grow: 1;">
                                    <button id="toggle-api-key-visibility-button" type="button" class="btn btn-icon" title="Show/hide key" style="flex-shrink: 0;">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button id="copy-api-key-button" type="button" class="btn btn-icon" title="Copy to clipboard" style="flex-shrink: 0;">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="form-actions">
                                <button id="generate-api-key-button" type="button" class="btn btn-primary">
                                    <i class="fas fa-key"></i>
                                    Generate New Key
                                </button>
                                <button id="revoke-api-key-button" type="button" class="btn btn-danger" disabled>
                                    <i class="fas fa-trash-alt"></i>
                                    Revoke Key
                                </button>
                            </div>
                        </div>
                        </div>
                    </div>

                    <!-- Promobox Site Section -->
                    <div class="section-content" id="promobox-section">
                        <div class="section-main-content">
                            <div class="section-title">
                                <i class="fas fa-globe"></i>
                                Promobox Site
                            </div>
                            
                            <div class="form-section">
                                <div class="subsection-title">
                                    <i class="fas fa-server"></i>
                                    Site Configuration
                                </div>
                                
                                <div class="form-group checkbox-group">
                                    <input type="checkbox" id="siteServer.enabled" name="siteServer.enabled">
                                    <label for="siteServer.enabled">Enable Promobox Site</label>
                                </div>
                                <div class="form-group" id="siteServerPortGroup" style="display: none;">
                                    <label for="siteServer.port">Promobox Site Port</label>
                                    <input type="number" id="siteServer.port" name="siteServer.port" min="1024" max="65535" value="4001">
                                </div>
                                <div id="siteServerStatus" class="status-indicator" style="display: none;">
                                    <div class="status-badge">
                                        <span class="status-icon">üåê</span>
                                        <span class="status-text">Promobox site running on <a href="http://localhost:4001" target="_blank" class="status-link">http://localhost:4001</a></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Management Section -->
                    <div class="section-content" id="management-section">
                        <div class="section-main-content">
                            <div class="section-title">
                                <i class="fas fa-tools"></i>
                                Management & Tools
                            </div>
                            
                            <div class="form-section">
                                <div class="subsection-title">
                                    <i class="fas fa-cogs"></i>
                                    System Management
                                </div>
                                
                                <div id="debug-cache-action" class="management-action is-hidden">
                                <div class="action-description">
                                    <strong>View Plex Cache</strong>
                                    <p>Shows the raw JSON data of the currently cached media playlist. Only available in debug mode.</p>
                                </div>
                                <div class="action-button">
                                    <a href="/admin/debug" target="_blank" class="btn btn-primary">
                                        <i class="fas fa-database"></i>
                                        View Cache
                                    </a>
                                </div>
                            </div>
                            <div class="management-action">
                                <div class="action-description">
                                    <strong>Clear Image Cache</strong>
                                    <p>Deletes all cached images on the server, forcing them to be re-downloaded from your media server.</p>
                                </div>
                                <div class="action-button">
                                    <button type="button" id="clear-cache-button" class="btn btn-primary">
                                        <i class="fas fa-broom"></i>
                                        Clear Cache
                                    </button>
                                </div>
                            </div>
                            <div class="management-action">
                                <div class="action-description">
                                    <strong>Refresh Media</strong>
                                    <p>Forces a refetch of all media from the configured servers. Useful after adding new movies or shows.</p>
                                </div>
                                <div class="action-button">
                                    <button type="button" id="refresh-media-button" class="btn btn-primary" disabled>
                                        <i class="fas fa-sync-alt"></i>
                                        Refresh Media
                                    </button>
                                </div>
                            </div>
                            <div class="management-action">
                                <div class="action-description">
                                    <strong>Restart Application</strong>
                                    <p>Restarts the server. Necessary after changing the port or other critical settings.</p>
                                </div>
                                <div class="action-button">
                                    <button type="button" id="restart-app-button" class="btn btn-danger">
                                        <i class="fas fa-power-off"></i>
                                        Restart Application
                                    </button>
                                </div>
                            </div>
                            </div>
                        </div>
                    </div>

                    <!-- Logs & Debug Section -->
                    <div class="section-content" id="logs-section">
                        <div class="section-main-content">
                            <div class="section-title">
                                <i class="fas fa-file-alt"></i>
                                Logs & Debug
                            </div>
                            
                            <div class="form-section">
                                <div class="subsection-title">
                                    <i class="fas fa-bug"></i>
                                    Debug Tools
                                </div>
                                
                                <div class="management-action">
                                <div class="action-description">
                                    <strong>View Live Logs</strong>
                                    <p>Opens a new tab with a real-time view of the server logs for debugging.</p>
                                </div>
                                <div class="action-button">
                                    <a href="/admin/logs" target="_blank" class="btn btn-primary">
                                        <i class="fas fa-terminal"></i>
                                        View Live Logs
                                    </a>
                                </div>
                            </div>
                            
                            <h3>Live Log Viewer</h3>
                            <div class="log-viewer" id="live-logs">
                                <pre id="log-content">Loading logs...</pre>
                            </div>
                            <div class="form-actions">
                                <button type="button" id="refresh-logs-button" class="button-secondary">
                                    <span class="icon"><i class="fas fa-refresh"></i></span>
                                    <span>Refresh Logs</span>
                                </button>
                                <button type="button" id="clear-logs-button" class="button-secondary">
                                    <span class="icon"><i class="fas fa-trash"></i></span>
                                    <span>Clear Display</span>
                                </button>
                            </div>
                        </div>
                        </div>
                    </div>
                </form>

            </main>
            
            <!-- Save Button Footer -->
            <div class="admin-footer">
                <div class="footer-content">
                    <div class="footer-status">
                        <div id="config-status" class="status-message">
                            <i class="fas fa-check-circle"></i>
                            Ready to save
                        </div>
                    </div>
                    <div class="footer-actions">
                        <button type="button" onclick="toggleHelpPanel()" class="btn btn-secondary">
                            <i class="fas fa-question-circle"></i>
                            <span>Quick Help</span>
                        </button>
                        <button type="submit" id="save-config-button" class="btn" form="config-form">
                            <i class="fas fa-save"></i>
                            <span>Save Settings</span>
                        </button>
                    </div>
                </div>
            </div>
        </div> <!-- Close main-content -->
    </div> <!-- Close admin-layout -->

    <!-- Quick Help Panel -->
    <div id="quick-help-panel" class="quick-help-panel">
        <div class="help-header">
            <h3 id="help-title">General Settings Help</h3>
            <button class="help-close" onclick="toggleHelpPanel()">√ó</button>
        </div>
        <div class="help-content" id="help-content">
            <div class="help-section">
                <h4>Transition Interval</h4>
                <p>Controls how long each poster is displayed before switching to the next one. Set between 1-300 seconds. Shorter intervals create more dynamic displays, while longer intervals are better for reading metadata.</p>
            </div>
            <div class="help-section">
                <h4>Background Refresh</h4>
                <p>How often the system fetches new content from your media server. Set to 0 to disable automatic refresh. Regular refreshing ensures new content appears in the rotation.</p>
            </div>
            <div class="help-section">
                <h4>Application Port</h4>
                <p>The network port for the admin interface. Default is 4000. Changing this requires an application restart. Make sure the port isn't used by other applications.</p>
            </div>
            <div class="help-section">
                <h4>Debug Mode</h4>
                <p>Enables detailed logging for troubleshooting. Check the live logs to see debug information. Only enable when investigating issues as it can impact performance.</p>
            </div>
        </div>
    </div>

    <!-- 2FA Setup Modal -->
    <div id="2fa-modal" class="modal is-hidden">
        <div class="modal-background"></div>
        <div class="modal-content">
            <h2 id="2fa-modal-title">Set up 2FA</h2>
            <p id="2fa-modal-intro">Scan the QR code below with your authenticator app (like Google Authenticator, Authy, etc.).</p>
            <div id="qr-code-container">
                <!-- QR code will be inserted here by JS -->
            </div>
            <p>Then, enter the 6-digit code generated by the app to complete the setup.</p>
            <form id="2fa-verify-form">
                <div class="form-group">
                    <label for="2fa-token">Verification Code</label>
                    <input type="text" id="2fa-token" name="2fa-token" required pattern="\d{6}" maxlength="6" autocomplete="one-time-code" inputmode="numeric">
                </div>
                <div class="form-actions">
                    <button type="button" id="cancel-2fa-button" class="btn btn-secondary">Cancel</button>
                    <button type="submit" class="btn btn-primary">Verify and Enable</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Disable 2FA Confirmation Modal -->
    <div id="disable-2fa-modal" class="modal is-hidden">
        <div class="modal-background"></div>
        <div class="modal-content">
            <h2>Confirm 2FA Deactivation</h2>
            <p>Enter your current password to confirm that you want to disable Two-Factor Authentication.</p>
            <form id="disable-2fa-form">
                <div class="form-group">
                    <label for="disable-2fa-password">Current Password</label>
                    <input type="password" id="disable-2fa-password" name="password" required autocomplete="current-password">
                </div>
                <div class="form-actions">
                    <button type="button" id="cancel-disable-2fa-button" class="btn btn-secondary">Cancel</button>
                    <button type="submit" class="btn btn-danger">Disable 2FA</button>
                </div>
            </form>
        </div>
    </div>

    <script src="admin-help.js?v=1.2.9" defer></script>
    <script src="/admin.js?v=1.2.9" defer></script>
        <script>
        // Emergency fallback: after load, if no active section shows visible elements, dump raw sections sequentially.
        window.addEventListener('load', () => {
            try {
                const active = document.querySelector('.section-content.active');
                if (!active) return; 
                // Heuristic: count visible form groups
                const visibleGroups = active.querySelectorAll('.form-group, .management-action, .log-viewer, .form-section');
                if (visibleGroups.length === 0) {
                    const container = document.createElement('div');
                    container.style.cssText='position:relative;z-index:2000;padding:20px;background:#111;color:#fff;font:14px monospace;';
                    container.innerHTML = '<h2>EMERGENCY FALLBACK RENDER</h2>';
                    document.querySelectorAll('.section-content').forEach(sec => {
                        const clone = sec.cloneNode(true);
                        clone.style.display='block';
                        clone.classList.add('force-visible');
                        container.appendChild(clone);
                    });
                    document.body.appendChild(container);
                }
            } catch(e) { console.warn('Fallback render error', e); }
        });
        </script>
        <style>
            /* Fallback inline override to ensure visibility after cache bust */
            .section-content.active {opacity:1 !important; visibility:visible !important;}
        </style>
        <script>
        window.addEventListener('load', ()=>{
            try {
                console.log('[ADMIN LATE] window load diagnostics');
                const secs = document.querySelectorAll('.section-content');
                secs.forEach(s=>{
                    const r = s.getBoundingClientRect();
                    console.log('[ADMIN LATE] rect', s.id, r.width, r.height);
                });
                const anyVisible = Array.from(secs).some(s=>{
                    const r=s.getBoundingClientRect();
                    return r.width>5 && r.height>5;
                });
                if(!anyVisible){
                    const dbg=document.createElement('div');
                    dbg.style.cssText='white-space:pre;background:#111;color:#fff;padding:12px;border:2px solid #f00;';
                    dbg.textContent='FALLBACK PLAIN TEXT LIST:\n'+Array.from(secs).map(s=>s.id+':'+s.innerHTML.slice(0,120).replace(/\n+/g,' ')).join('\n');
                    document.body.prepend(dbg);
                }
            }catch(e){console.log('[ADMIN LATE] error',e);}
        });
        </script>
</body>
</html>